---
layout: post
title: "31 Days of iOS: Day 14-The UIWebView"
date: Mon Jan 14 2013 10:00:00 GMT-0800 (PST)
comments: true
status: publish
type: post
published: true
categories: [Mobile, Objective-C, iOS, XCode]
excerpt: "This is day 14 in the 31 Days of iOS.  This article covers using the UIWebView.  The UIWebView can be used to load html pages from the internet as well as to load local HTML pages.  We'll also talk about interacting with objective-c from the javascript in these pages and vice versa."
logoUrl: null
keywords: iOS,31 days of iOS,Apple,Apple iOS,UIWebView,Web View,loadRequest,NSURLRequest,scalePagesToFit,loadHtmlString,UIWebViewDelegate,shouldStartLoadWithRequest,stringByEvalutingJavascriptFromString,How to develop iOS,iOS intro,iOS Introduction,iOS Tutorial,iOS for Beginners,Beginners,walkthrough
filepath: 2013-01-14-31-Days-of-iOS--Day-14-The-UIWebView.html
disqus_identifier: 31-Days-of-iOS--Day-14–The-UIWebView
redirect_from:
  - /2013-01-14-31-Days-of-iOS--Day-14%E2%80%93The-UIWebView/
  - /2013-01-14-31-Days-of-iOS--Day-14–The-UIWebView/
---
<p align="left"><img style="margin: 0px 0px 5px 5px; display: inline; float: right" align="right" src="http://chrisrisner.com/upload/200px-Apple-logo.png" width="170" height="208" />Welcome to Day 14 in the <a title="31 Days of iOS" href="http://chrisrisner.com/31-Days-of-iOS">31 Days of iOS</a>.&#160; <a title="Day 13: The TableView" href="http://chrisrisner.com/31-Days-of-iOS--Day-13%E2%80%93The-TableView">Yesterday</a>, we focused on how to display lists of data using the <strong>TableView</strong>.&#160; Today we’re going to move on to something new and talk about using <strong>UIWebView</strong>s.&#160; At first glance, you might think that a web view is only useful for loading websites on the internet within your application.&#160; However, web views can be used for much more than JUST the internet.&#160; You can load local html files as well.&#160; That may not seem like much but, this is how popular frameworks like <a title="PhoneGap" href="http://phonegap.com/">PhoneGap</a> work.&#160; When you load a web view in your view controller, you have the ability to inject javascript and call back to your objective-C code from that javascript.&#160; This means that you can use a webpage to interact with hardware functionality if you choose to.&#160; We’ll take a look at a few different things that we can do with web views today.&#160; We’ll be starting with a brand new project, but if you’d like to <a title="iOS Day 14 source code" href="https://crcomcstorage.blob.core.windows.net/codesamples/iOSDayFourteen.zip">follow along with the completed code, you can access it here</a>.</p>  <p align="left"><strong>Creating our project and handling the UI</strong></p>  <p align="left">Open up Xcode and choose <strong>File</strong>, <strong>New</strong>, <strong>Project</strong>.&#160; We’ll use a <strong>Single View Application</strong> and name it <strong>DayFourteen</strong>:</p>  <p align="center"><img title="new iOS Project for day 14" alt="new iOS Project for day 14" src="https://crcomcstorage.blob.core.windows.net/images/31iosday14-new-project.jpg" width="440" height="369" /></p>  <p align="left">Next, open up the <strong>MainStoryboard.storyboard</strong> file.&#160; In the UI element selector in the bottom right of Xcode, find <strong>Web View</strong> and drag it onto your UI so it takes up the whole view:</p>  <p align="center"><img title="adding a web view" alt="adding a web view" src="https://crcomcstorage.blob.core.windows.net/images/31iosday14-web-view.png" width="251" height="474" /></p>  <p align="left">Now we just need to wire this up with our code behind.&#160; To do this, open the <strong>Assistant Editor</strong> in the top right of Xcode.&#160; Next <strong>control + click and drag</strong> from the <strong>UIWebView</strong> to your code behind and create an outlet.&#160; While you are in the <strong>ViewController.h</strong> class, go ahead and make it implement <strong>UIWebViewDelegate</strong>.&#160; When you’re done, the class should look like this:</p>  <p align="left"><script src="https://gist.github.com/4047216.js?file=viewcontroller.h"></script></p>  <p align="left">Now we’re ready to start loading web pages.</p>  <p><strong>Loading an internet webpage</strong></p>  <p>Switch over to <strong>VIewController.m</strong> and change your <strong>viewDidLoad</strong> method to this:</p>  <p><script src="https://gist.github.com/4047216.js?file=loadingwebsite.m"></script></p>  <p>Here we’re generating a <strong>NSURL</strong> and using that to generate a <strong>NSURLRequest</strong>.&#160; We can then pass the request into our web view’s <strong>loadRequest</strong> method.&#160; Now if you run your app, we should see my website load:</p>  <p align="center"><img title="loading a website" alt="loading a website" src="https://crcomcstorage.blob.core.windows.net/images/31iosday14-loading-website-1.jpg" width="227" height="334" /></p>  <p>The first thing you might notice is that the site loads and it looks awful.&#160; Even more awful than it looks if you load it in Safari.&#160; The reason for this is that the <strong>UIWebView</strong> doesn’t handle many things that Safari does by default.&#160; In this case, you can’t even pinch and zoom out (or zoom in).&#160; Let’s tackle fixing that problem next.</p>  <p><strong>Scaling pages</strong></p>  <p>Telling the <strong>UIWebView </strong>to scale pages is actually remarkably easy.&#160; We can do it by adding one line of code to our <strong>viewDidLoad</strong> method:</p>  <p><script src="https://gist.github.com/4047216.js?file=resizewebview.m"></script></p>  <p>Here, setting the <strong>scalePagesToFit</strong> property of the web view to <strong>YES</strong> tells it that it should scale every page it loads.&#160; Now when we run the application, we can see that my site looks a little less awful:</p>  <p align="center"><img title="Scaled web page" alt="Scaled web page" src="https://crcomcstorage.blob.core.windows.net/images/31iosday14-scaled-webview.jpg" width="273" height="402" /></p>  <p>You’ll also notice that you can now pinch to zoom in and out.&#160; If you’re running this on the simulator, you can perform a pinch by holding down the <strong>alt / option</strong> key and then click and drag in the simulator.&#160; </p>  <p><strong>Loading a local webpage</strong></p>  <p>Let’s move on from loading internet web pages and look at how to load a local html file.&#160; This is useful for many different things including reusing static HTML content, building a <a title="PhoneGap" href="http://phonegap.com/">PhoneGap</a> style “web” iOS app, and more.&#160; We first need to add an HTML file to our project.&#160; Right click on your project folder and choose <strong>New File</strong>.&#160; In the template windows, select <strong>Other </strong>beneath <strong>iOS</strong> and pick the <strong>Empty </strong>template:</p>  <p align="center"><img title="new empty file" alt="new empty file" src="https://crcomcstorage.blob.core.windows.net/images/31iosday14-new-empty-file.jpg" /></p>  <p>In the next window, name your file <strong>LocalPage.html </strong>then create it.&#160; You should see a new html file added to your project in the <strong>Project Navigator</strong>.&#160; Next, open <strong>LocalPage.html</strong> and edit it to have the following content:</p>  <p><script src="https://gist.github.com/4047216.js?file=localpage1.html"></script></p>  <p>Our page is very simple but will serve our uses.&#160; Now let’s return to <strong>ViewController.m</strong> and make it load the page.&#160; Change the <strong>viewDidLoad </strong>to match the following:</p>  <p><script src="https://gist.github.com/4047216.js?file=loadlocalfile.m"></script></p>  <p>First we get a <strong>NSString </strong>which contains the path to our local file.&#160; Notice that we use the <strong>NSBundle mainBundle</strong> to actually get the path for the file since we don’t know what it is.&#160; If we had put the html file in a subgroup in our project, we could pass the name of it in as the directory.&#160; Since we didn’t we’re passing in <strong>nil</strong>.&#160; We then use <strong>NSString’s</strong> <strong>stringWithContentsOfFile</strong> method to open that file and dump it’s contents into a <strong>NSString</strong>.&#160; We then use the web view’s <strong>loadHtmlString </strong>method to load the <strong>NSString</strong>.&#160; Now when we load our app, it will look like this:</p>  <p align="center"><img title="Loading a local page" alt="Loading a local page" src="https://crcomcstorage.blob.core.windows.net/images/31iosday14-loading-local.jpg" /></p>  <p><strong>Injecting javascript</strong></p>  <p>Now that we’ve seen how to load a local file, let’s take this a step further and see how we can inject javascript.&#160; We’ll do this with our local page though it should also work on a remote page as well (you’d need to use a <strong>NSURLConnection </strong>to request the web page and get it’s content and then load it into web view, but the concept is the same).&#160; Again we’re going to make some modifications to the <strong>viewDidLoad</strong> method:</p>  <p><script src="https://gist.github.com/4047216.js?file=injectJavascript.m"></script></p>  <p>Here we’re creating a <strong>NSString </strong>with our javascript in it.&#160; We then use the <strong>stringByAppendingString </strong>method on our html string and append the javascript string to it.&#160; We could just as easily prepend the javascript so it was before the html if we wanted.&#160; Then, we load our web view in the same way.&#160; Now when we run our app, we get an alert window right away:</p>  <p align="center"><img title="Javascript alert showing up in UIWebView" alt="Javascript alert showing up in UIWebView" src="https://crcomcstorage.blob.core.windows.net/images/31iosday14-javascript-alert.jpg" width="229" height="277" /></p>  <p>We’ll next use this to do something a little more advanced and actually hook back into our iOS code!</p>  <p><strong>Handling callbacks</strong></p>  <p>The first thing we need to do is change up our html:</p>  <p><script src="https://gist.github.com/4047216.js?file=localpage2.html"></script></p>  <p>As you can see, we’ve added an html input of type button that has an <strong>onclick</strong> method.&#160; In that method we are setting the <strong>window.location </strong>variable on the <strong>DOM</strong>.&#160; Whenever the location is changed, a method is fired against the <strong>UIWebView</strong>.&#160; This is a method we can intercept by implementing the <strong>UIWebViewDelegate</strong>.&#160; Hop over to the <strong>ViewController.m</strong>.&#160; Before we can implement the delegate method, we need to tell the web view that <strong>ViewController</strong> will act as it’s delegate:</p>  <p><script src="https://gist.github.com/4047216.js?file=viewDidLoad3.m"></script></p>  <p>I’ve commented out the javascript we were adding for now just so we won’t see that when our webview loads.&#160; Now, we can add the <strong>shouldStartLoadWIthRequest</strong> method:</p>  <p><script src="https://gist.github.com/4047216.js?file=shouldStartLoadWithRequest.m"></script></p>  <p>If you put a breakpoint at the start of this method, you’ll see that it’s called right when you load the web view from the <strong>viewDidLoad</strong> method.&#160; In this method, we’re getting the URL from the request and then we’re checking the schema of that URL.&#160; If it matches what we are setting the location property to (<strong>callmycode</strong>) then we know that we can do some special processing.&#160; Here, we’re pulling out the additional query string params and then using them to populate a <strong>NSString </strong>which is used to show a <strong>UIAlertView</strong>.&#160; I’m not actually pulling out the individual parameter values here and you could probably find a better way to parse them, but this works for what we want to show.&#160; Now when we run our app and tap the button in our web view, we should see this:</p>  <p align="center"><img title="calling objective-c from js" alt="calling objective-c from js" src="https://crcomcstorage.blob.core.windows.net/images/31iosday14-calling-objc-from-js.jpg" width="223" height="278" /></p>  <p align="left"><strong>Calling javascript from Objective-c</strong></p>  <p align="left">The last thing we will look at is how to call javascript from your objective-c.&#160; This is very easy to accomplish by calling the <strong>stringByEvaluatingJavaScriptFromString</strong> method on your web view.&#160; You’ll want to do this somewhere other than in the <strong>viewDidLoad </strong>method or your web view won’t load properly.&#160; Here is an example of calling that method which you could put in to the <strong>shouldStartLoadWithRequest</strong> instead of showing the <strong>UIAlertView</strong> if you wanted to:</p>  <p align="left"><script src="https://gist.github.com/4047216.js?file=triggerJSfromObjc.m"></script></p>  <p align="left"><strong>Conclusion</strong></p>  <p>Today we covered a lot of ground with how to use <strong>UIWebView</strong>’s in your application.&#160; As you’ve seen, there is a lot more you can do with a web view then just load a page from the internet.&#160; Many applications use this capability to do some very cool things.&#160; You can <a title="iOS Day 14 source code" href="https://crcomcstorage.blob.core.windows.net/codesamples/iOSDayFourteen.zip">access the completed source code from today here</a>.</p>