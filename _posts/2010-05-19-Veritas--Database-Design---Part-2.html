---
layout: post
title: "Veritas: Database Design - Part 2"
date: Tue May 18 2010 17:56:00
commentsOn: true
status: publish
type: post
published: true
categories: [.Net, Programming, Veritas, Web]
excerpt: "Vertias,Blog,Blog Engine,MVC,ASP,ASP .Net 4, .Net 4, Blog Series, How to, Make Blog,Database,SQL,Database Design,DBA"
logoUrl: null
keywords: Vertias,Blog,Blog Engine,MVC,ASP,ASP .Net 4, .Net 4, Blog Series, How to, Make Blog,Database,SQL,Database Design,DBA
filepath: 2010-05-19-Veritas--Database-Design---Part-2.html
disqus_identifier: Veritas--Database-Design---Part-2
redirect_from:
  - /Veritas--Database-Design---Part-2/
---
<p><a onclick="return hs.expand(this)" class="highslide" href="http://chrisrisner.com/upload/634003144233522332.jpg"><img style="border-right-width: 0px; margin: 0px 0px 10px 10px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="634003144233522332[1]" border="0" alt="Veritas" align="right" src="http://chrisrisner.com/upload/634003144233522332.jpg" width="195" height="36" /></a> Now that we’ve <a title="Vertias Part 1" href="http://chrisrisner.com/Veritas--Creating-a-Blog-Engine-with-MVC-2-and--Net-4-0-%E2%80%93-Part-1" target="_blank">covered what this project is all about</a>, we’ll get into the database design for our blog engine, Veritas.&#160; So when you think of a blog, what are some of the things you see across the board?</p>  <ul>   <li>Blog entries </li>    <li>Categories </li>    <li>Images </li>    <li>Comments </li> </ul>  <p>Chances are good those would be on everyone’s list.&#160; These are certainly the minimum of what we’d need to track in the database.&#160; However, since we’re not JUST making a site that’s going to display information from a database (it does have to provide functionality too) we have to go a bit deeper.&#160; Instead of just those 4 things, our database will need to track these things as well:</p>  <ul>   <li>Configuration settings </li>    <li>Number of views </li>    <li>Error / audit logs </li>    <li>Users </li>    <li>Roles </li>    <li>Content Pages </li> </ul>  <p>The last one, “Content Pages”, might not sound familiar.&#160; In addition to just putting up blog entries we’re going to want to give authors the ability to add pages with html content without having to go into the code base to add something.&#160; We’re going to split this into two separate entries: the support tables and the entry tables.&#160; So let’s get into our database!</p>  <p>Everything starts with our Configuration table “BlogConfig”:&#160; <br /><a onclick="return hs.expand(this)" class="highslide" href="http://chrisrisner.com/upload/634098159108830000.jpg"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="BlogConfig" border="0" alt="BlogConfig" src="http://chrisrisner.com/upload/634098159108830000.jpg" width="343" height="143" /></a> </p>  <p>This table stores a undetermined amount of configuration settings in it’s ConfigXml column, the config ID, and a host name.&#160; We’re going to use an XML column so that we don’t have to make a database change every time we realize there is another configuration option we want to store.&#160; The config ID is going to be used in a Foreign Key (FK) constraint in nearly all of our other tables.&#160; Finally, the host will specify what website the config is for.&#160; So for this site, the host would be “ChrisRisner.com”.&#160; Now you might be wondering, what’s the point of the FK constraint back to config ID and the host name being here.&#160; Well, if we wanted to host multiple sites using the same database, this set up allows us to do so.&#160; This comes in very handy when you’re web host only gives you 1 (or few) SQL databases but you want to host multiple blogs.</p>  <p>Next up, we’ll look at users and roles.&#160; While you don’t necessarily need users and roles in your blog (you could always just manually insert entries into the database) it will help us with everything from connecting with Live Writer to setting up our admin section and more.&#160; So here is BlogUser:</p>  <p><a onclick="return hs.expand(this)" class="highslide" href="http://chrisrisner.com/upload/634098159938700000.jpg"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="BlogUser" border="0" alt="BlogUser" src="http://chrisrisner.com/upload/634098159938700000.jpg" width="325" height="202" /></a> </p>  <p>So most of these columns should make sense.&#160; The Config ID is an FK back to our Config table.&#160; About will be used if we want to have a page that talks about the Blog User (on an About Us page for instance).&#160; NotifyForFeedback will be checked when someone comments on the user’s post (if it’s true, then we’d notify the user on a comment).&#160; Next we have BlogRole:</p>  <p><a onclick="return hs.expand(this)" class="highslide" href="http://chrisrisner.com/upload/634098160859100000.jpg"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="BlogRole" border="0" alt="BlogRole" src="http://chrisrisner.com/upload/634098160859100000.jpg" width="335" height="102" /></a> </p>  <p>This table just stores the names of roles we’ve got.&#160; It’s pretty simple so we won’t go over things.&#160; Next we have the mapping table between those two, BlogUserRole:</p>  <p><a onclick="return hs.expand(this)" class="highslide" href="http://chrisrisner.com/upload/634098161634760000.jpg"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="BlogUserRole" border="0" alt="BlogUserRole" src="http://chrisrisner.com/upload/634098161634760000.jpg" width="346" height="102" /></a> </p>  <p>Continuing along with our “Support tables” we’ve got the log table, BlogLog.&#160; This will be used to store exception information, security audits, etc:</p>  <p><a onclick="return hs.expand(this)" class="highslide" href="http://chrisrisner.com/upload/634098162539260000.jpg"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="BlogLog" border="0" alt="BlogLog" src="http://chrisrisner.com/upload/634098162539260000.jpg" width="339" height="199" /></a> </p>  <p></p>  <p>Again, nothing really important or surprising here.&#160; Next we have a table we’ll use to store our menu items, BlogMenuItem:</p>  <p><a onclick="return hs.expand(this)" class="highslide" href="http://chrisrisner.com/upload/634098163172320000.jpg"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="BlogMenuItem" border="0" alt="BlogMenuItem" src="http://chrisrisner.com/upload/634098163172320000.jpg" width="337" height="261" /></a> </p>  <p>Some of the columns here might need an explanation.&#160; Basically, each menu item can link to one of our MVC views, a specific URL, or can contain it’s own content.&#160; So if down the road we want to add a quick link with static html, we could place that in the PageContent of the menu item.&#160; Lastly (for now) is our BlogMedia table:</p>  <p><a onclick="return hs.expand(this)" class="highslide" href="http://chrisrisner.com/upload/634098163666640000.jpg"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="BlogMedia" border="0" alt="BlogMedia" src="http://chrisrisner.com/upload/634098163666640000.jpg" width="335" height="169" /></a> </p>  <p>This table will store records of any files we upload using our upload page.&#160; The file is the actual path of the file on the hosting computer.&#160; So it would probably be something like “D:\hosting\myaccountname\something\filename.type”.&#160; The ServerPath is the web path to the file.&#160; So now we’ve covered the all of our Support tables.&#160; In the next entry we’ll go over all of the tables that actually store stuff related to our Blog Entries.</p>