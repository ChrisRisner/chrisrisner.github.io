---
layout: post
title: "Using Existing Databases with Windows Azure Mobile Services without changing the Schema"
date: Tue Dec 18 2012 09:56:00 GMT-0800 (PST)
comments: true
status: publish
type: post
published: true
categories: [Azure, Mobile Services, SQL]
excerpt: "This article walks you through connecting an existing database to Windows Azure Mobile Services.  This is the second technique for doing so and allows us to do this without changing the schema or any columns in our database.  Instead we'll make use of SQL views."
logoUrl: http://storage.chrisrisner.com/images/WAMobileServicesblue.png
keywords: Mobile Services,Windows Azure,Azure,Windows Azure Mobile Services,SQL,Existing database,SQL Database,Schema,Columns,View,SQL View,walkthrough,tutorial
filepath: 2012-12-18-Using-Existing-Databases-with-Windows-Azure-Mobile-Services-without-changing-the-Schema.html
disqus_identifier: Using-Existing-Databases-with-Windows-Azure-Mobile-Services-without-changing-the-Schema
---
{% include special/mobile_services_to_apps.html %}

<p><img style="margin: 0px 0px 5px 5px; display: inline; float: right" align="right" src="http://storage.chrisrisner.com/images/WAMobileServicesblue.png" width="114" height="169" />A little while ago, I <a title="Connecting an existing database to Windows Azure Mobile Services" href="http://chrisrisner.com/Connecting-an-Existing-Database-to-Windows-Azure-Mobile-Services">posted about how to use Windows Azure Mobile Services with an existing database</a>.&#160; One of the shortcomings of the method I described was that you have to change the schema name of the tables in your database.&#160; If you are just uploading the database to Windows Azure to only be used by Mobile Services, this isn’t really a problem.&#160; However, if you have a code base that already talks to the database, you may not want to change the schema because that would require you to change the codebase.&#160; This actually happened to me when I started looking at connecting this site to Mobile Services.&#160; I didn’t want to change the schema name because I didn’t want to change the <a title="Veritas Source Code" href="https://github.com/ChrisRisner/Veritas">codebase for my site</a> to use the new schema name.&#160; Thankfully, after a little playing around, I was able to figure out a way around changing the schema:&#160; <a title="SQL Views" href="http://msdn.microsoft.com/en-us/library/aa214068(v=sql.80).aspx">SQL Views</a>.&#160; </p>  <p><strong>SQL Views</strong></p>  <p>A SQL view is kind of like a virtual table.&#160; You can use them to create something like a table using any query you want.&#160; So for example, if you had many different columns in a table but only wanted to select a subset of them, you could create a view which only pulled the data for those columns instead of having to do a SELECT on the whole table.&#160; Alternatively if you wanted to JOIN multiple tables, you could do so in a view.&#160; What this means for us is that we can create a view whose name and schema match up with what Mobile Services would expect it to be and then Mobile Services will treat the view like a table.&#160; As we’ll see, this will actually work for all CRUD operations so we can still do all our normal operations on the data.&#160; </p>  <p><strong>Our database</strong></p>  <p>For today’s walkthrough we’re going to create a database with a single table in it that lines up with the TodoItem sample you can pull from Mobile Services’ quick start.&#160; Specifically, we’ll have three columns:&#160; <strong>TodoItemID</strong>, <strong>text</strong>, and <strong>complete</strong>.&#160; The <strong>text</strong> and <strong>complete</strong> columns match up with what we’d get with the quick start.&#160; However, while the <strong>TodoItemID</strong> is the same type and is an identity column, it doesn’t match the required <strong>id </strong>column needed by Mobile Services.&#160; This will end up being fine though due to how we create our view.&#160; Here’s a screenshot of our table in the SQL designer:</p>  <p align="center"><img title="existing database table" alt="existing database table" src="http://storage.chrisrisner.com/images/wams-existing-db.jpg" /></p>  <p>The next thing we need to do is create a new schema.&#160; This schema should match the name of your mobile service.&#160; Today, I’m creating a mobile service named <strong>existingdb</strong> so my schema name will be <strong>existingdb</strong>.&#160; To create this, open a new query window for your database and execute the <strong>CREATE SCHEMA </strong>command:</p>  <blockquote>   <p>CREATE SCHEMA existingdb;</p> </blockquote>  <p>With that done, we can generate our view.&#160; We’ll do this by running another SQL query against our database:</p>  <p><script src="https://gist.github.com/4329928.js?file=CreateView.sql"></script></p>  <p>There are a couple things worth pointing out about our view.&#160; First the view name is <strong>[existingdb].[TodoItem]</strong>.&#160; This means that we’re creating the view in the <strong>existingdb</strong> schema.&#160; This is how we can get the mobile service to recognize it.&#160; Secondly, we’re setting the alias of <strong>TodoItemID</strong> to <strong>id</strong>.&#160; This is so that things line up with Mobile Service’s required <strong>id</strong> column.&#160; Now, if we go to the portal for our mobile service and go to the data tab, we’ll see that it doesn’t show any tables:</p>  <p align="center"><img title="no data in our mobile service" alt="no data in our mobile service" src="http://storage.chrisrisner.com/images/wams-existing-db-no-records.jpg" /></p>  <p>We still need to tell Mobile Services about our <strong>TodoItem</strong> table so click on <strong>Add a Table</strong> and create a <strong>TodoItem</strong> table.&#160; Now, go ahead and pull down the quick start application in your preferred platform.&#160; After adding a new item in your todo list you can return to the SQL Management Portal (or SQL Management Studio) and run a select query on your table and your view.&#160; Here are the results from the select query was ran on our actual table (SELECT * from TodoItem):</p>    <p align="center"><img title="Todo item table select results" alt="Todo item table select results" src="http://storage.chrisrisner.com/images/wams-existing-db-todo-table.jpg" /></p>  <p>And if we run the same query on our view (SELECT * FROM existingdb.TodoItem) we get this:</p>  <p align="center"><img title="todo view select results" alt="todo view select results" src="http://storage.chrisrisner.com/images/wams-existing-db-todo-view.jpg" /></p>  <p>This is exactly what we want to see.&#160; The same data is showing up in the “original” format and in the Mobile Services format in my view.&#160; When Mobile Services did it’s insert on the view, that was translated to an insert against the actual <strong>TodoItem </strong>table instead.&#160; Curiously, if we return to the data tab in the portal, we still won’t see any data in our table:</p>  <p align="center"><img title="no data in portal with view" alt="no data in portal with view" src="http://storage.chrisrisner.com/images/wams-existing-db-still-no-records.jpg" /></p>  <p>This has to do with how the portal looks up the data for each table.&#160; Even though the code that handles the CRUD for Mobile Services works, the portal is looking for the actual table with the matching schema, which doesn’t exist.</p>  <p><strong>Conclusion</strong></p>  <p>Today we looked at how you can connect an existing database into Mobile Services.&#160; There is <a title="Connecting to an existing db by changing schema" href="http://chrisrisner.com/Connecting-an-Existing-Database-to-Windows-Azure-Mobile-Services">another technique for doing so that requires you to make changes to your database tables</a>, however, today we looked at how to get around that.&#160; This means that if you already have a codebase talking to your database and don’t want to change your database and your codebase, you can do so.&#160; This should open up some great opportunities for people that already have a database hosted in Windows Azure SQL Database or want to move a database and a connected app into Windows Azure.&#160; You can <a title="Free Windows Azure Trial" href="http://aka.ms/WA-MobileServices">sign up for a free trial for Windows Azure and start using Mobile Services today by going here</a>.</p>