---
layout: post
title: "31 Days of iOS: Day 12-Core Data"
date: Sat Jan 12 2013 13:54:00 GMT-0800 (PST)
comments: true
status: publish
type: post
published: true
categories: [Mobile, Objective-C, iOS, XCode]
excerpt: "This is day 12 in the 31 Days of iOS.  In this article we talk about saving data using CoreData.  CoreData is the most robust system in iOS for storing and retrieving data and is normally powered by SQLite."
logoUrl: null
keywords: iOS,31 days of iOS,Apple,Apple iOS,CoreData,Saving data,SQLite,iOS Database,database,object graph,How to develop iOS,iOS intro,iOS Introduction,iOS Tutorial,iOS for Beginners,Beginners,walkthrough
filepath: 2013-01-12-31-Days-of-iOS--Day-12-Core-Data.html
disqus_identifier: 31-Days-of-iOS--Day-12–Core-Data
redirect_from:
  - /2013-01-12-31-Days-of-iOS--Day-12%E2%80%93Core-Data/
---
<p align="left"><img style="margin: 0px 0px 5px 5px; display: inline; float: right" align="right" src="http://chrisrisner.com/upload/200px-Apple-logo.png" width="170" height="208" />Welcome to Day 12 in the <a title="31 Days of iOS" href="http://chrisrisner.com/31-Days-of-iOS">31 Days of iOS</a>.&#160; Today we’re continuing a subset of articles that deal with data storage.&#160; The <a title="Day 11: Saving Data using NSUserDefaults" href="http://chrisrisner.com/31-Days-of-iOS--Day-11-Saving-data-using-NSUserDefaults">last article</a> focused on persisting data to the file system using <strong>NSUserDefaults</strong>.&#160; The defaults act like an <strong>NSDictionary</strong> which has the ability to save and load itself for you.&#160; Today we’ll look at using <strong>Core Data</strong>.&#160; <strong>Core Data</strong> let’s you use a <strong>SQLite </strong>database inside of your iOS application.&#160; Instead of having to execute SQL statements to create tables and query them, Apple has wrapped all of this functionality (as well as a few other things) inside of something called <strong>Core Data</strong>.&#160; We’ll be starting with a brand new project, but if you’d like to <a title="iOS Day 12" href="https://crcomcstorage.blob.core.windows.net/codesamples/iOSDayTwelve.zip">follow along with the completed code, you can access it here</a>.</p>  <p><strong>Creating our project and handling the UI</strong></p>  <p>Open up Xcode and choose <strong>File</strong>, <strong>New</strong>, <strong>Project</strong>.&#160; We’ll use a <strong>Single View Application</strong> and name it <strong>DayTwelve</strong>:</p>  <p align="center"><img title="iOS Day 12 New Project" alt="iOS Day 12 New Project" src="https://crcomcstorage.blob.core.windows.net/images/31iosday12-new-project.jpg" width="401" height="332" /></p>  <p>Let’s start by putting some simple controls on our UI for testing.&#160; Open <strong>MainStoryboard.storyboard</strong> next.&#160; If you’ve been following along in the series, then the UI we’re going to use for this project is going to be fairly complicated.&#160; The reason for this is because of the complicatedness of using <strong>Core Data</strong>.&#160; We are going to need someway to save data, load data, update data, cycle through records, and delete them.&#160; We’re going to add a few different labels, text fields, and buttons.&#160; When we’re done, our UI will look like this:</p>  <p align="center"><img title="iOS Day 12 UI" alt="iOS Day 12 UI" src="https://crcomcstorage.blob.core.windows.net/images/31iosday12-project-ui.jpg" width="272" height="367" /></p>  <p>The idea here is that each record we save will store two strings (Name and Info), a number (Number), and two dates.&#160; Switch to the <strong>Assistant Editor</strong> and <strong>control+click and drag</strong> from the text fields and the labels (on the right) to your view controller to create outlets.&#160; Do the same for all of the buttons and create actions.&#160; When you’re done, the code will look like this:</p>  <p><script src="https://gist.github.com/4022579.js?file=ViewControllerUI.h"></script></p>  <p>We have one last step to handle for our UI.&#160; If you run the application right now, you’ll see that once the keyboard is up, you’re unable to see the buttons at the bottom.&#160; We’re going to address this by making the keyboard dismiss whenever the return key is tapped.</p>  <p><strong>Dismissing the Keyboard</strong></p>  <p>Open up <strong>ViewController.h </strong>and make it implement the <strong>UITextFieldDelegate</strong>:</p>  <p><script src="https://gist.github.com/4022579.js?file=ViewControllerTextD.h"></script></p>  <p>With that done, we can move to the <strong>ViewController.m</strong> file.&#160; We need to do two things here: set our text field’s delegate to be the view controller and add a method to handle when the return is tapped:</p>  <p><script src="https://gist.github.com/4022579.js?file=ViewControllerText.m"></script></p>  <p>The <strong>textFieldShouldReturn </strong>is where we’re hiding the keyboard.&#160; Now that we have a usable UI, we can start to look at <strong>Core Data</strong>.</p>  <p><strong>Defining our data model</strong></p>  <p>Right click on your project in the <strong>Project Navigator </strong>(the panel on the left) and go to <strong>New File</strong>.&#160; On the left of the new file dialog, select <strong>Core Data </strong>from under <strong>iOS</strong> and then pick <strong>Data Model</strong> as the template:</p>  <p align="center"><img title="New Data Model" alt="New Data Model" src="https://crcomcstorage.blob.core.windows.net/images/31iosday12-new-data-model.jpg" /></p>  <p>We’ll name our data model <strong>DayTwelveData</strong>.&#160; This will generate a new type of file named a <strong>xcdatamodel</strong>.&#160; Opening the data model will present to you the data model editor:</p>  <p align="center"><img title="Data Model Editor" alt="Data Model Editor" src="https://crcomcstorage.blob.core.windows.net/images/31iosday12-data-model-editor.jpg" width="485" height="313" /></p>  <p>This is the window we’ll use to define our data model.&#160; Click the <strong>Add Entity</strong> button at the bottom of the editor and name your new entity <strong>DataRecord</strong>.&#160; Next, in the <strong>Attribute</strong> pane, click the <strong>+</strong> and name it <strong>name</strong> and set it’s type to be <strong>String</strong>.&#160; Do the same thing and create another <strong>String </strong>named <strong>info</strong>, an <strong>Integer32</strong> named <strong>number</strong>, and two <strong>Date</strong>s named <strong>createDate</strong> and <strong>updateDate</strong>.&#160; When you’re done, the attributes pane should look like this:</p>  <p align="center"><img title="Completed attributes" alt="Completed attributes" src="https://crcomcstorage.blob.core.windows.net/images/31iosday12-attributes-pane.jpg" /></p>  <p>Notice that if you have an attribute selected, you can change settings for each attribute by opening the <strong>Data Model Inspector</strong> in the right <strong>Utilities </strong>panel.&#160; This will allow you to set whether or not attributes are optional or not, if they should be indexed (to improve querying by that attribute), min, max, and default values, and a few other options.&#160; For today, we won’t look at those options.&#160; We’re done with our data model for now and we can go back to the code.</p>  <p><strong>Creating the Context in the AppDelegate</strong></p>  <p>If we had created a project type that supported a quickstart with <strong>CoreData</strong>, we could have skipped this step.&#160; Unfortunately, the only project that does support starting with <strong>CoreData </strong>support built in, is the <strong>Master Detail Application</strong>.&#160; Therefore, we’ll be adding the necessary code manually.&#160;&#160; Before we can use <strong>CoreData</strong> code, we need to add new library to our project. In the <strong>Project Navigator</strong>, click your project to open the project properties. Select the <strong>Target</strong> and open the <strong>Build Phases </strong>tab. From there, expand the <strong>Link Binary With Libraries </strong>section:</p>  <p align="center"><img src="https://crcomcstorage.blob.core.windows.net/images/31iosday12-add-library.jpg" width="675" height="186" /></p>  <p>Click on the <strong>+</strong> in the bottom left of the section, choose <strong>CoreData.framework</strong> and click <strong>Add</strong>. Now open up <strong>AppDelegate.h</strong>.&#160; We’ll first add properties and methods here:</p>  <p><script src="https://gist.github.com/4022579.js?file=AppDelegate.h"></script></p>  <p>We’ll see what all of these do when we switch over to the <strong>AppDelegate.m</strong> file.&#160; Start by adding the import for <strong>CoreData</strong> at the top of your file:</p>  <blockquote>   <p>#import &lt;CoreData/CoreData.h&gt;</p> </blockquote>  <p>Next we need to drop some property synthesis in:</p>  <p><script src="https://gist.github.com/4022579.js?file=AppDelegateVars.m"></script></p>  <p>We’re doing this because those properties were marked read only but we need to modify them inside of the <strong>AppDelegate</strong>.&#160; After that, let’s implement the <strong>saveContext</strong> and <strong>applicationDocumentsDirectory</strong> methods:</p>  <p><script src="https://gist.github.com/4022579.js?file=AppDelegateMethods.m"></script></p>  <p>The <strong>saveContext</strong> method will attempt to write changes if it has any.&#160; The <strong>applicationDomainsDirectory</strong> gets the URL to the document directory for the running app.&#160; The next few method will handle creating our context and accessing the data model we defined earlier:</p>  <p><script src="https://gist.github.com/4022579.js?file=AppDelegateCoreData.m"></script></p>  <p>Now we’re read to use the context in our view controller and start doing stuff with data.</p>  <p><strong>Saving records</strong></p>  <p>Open the <strong>ViewController.h</strong> first.&#160; We need to add a new property for a <strong>NSManagedObjectContext</strong>:</p>  <p><script src="https://gist.github.com/4022579.js?file=ViewControllerContext.h"></script></p>  <p>We’ll use this context to access our data.&#160; Now let’s implement the <strong>tappedSaveAsNew</strong> method and make it save a record:</p>  <p><script src="https://gist.github.com/4022579.js?file=ViewControllerSave.m"></script></p>  <p>The first thing we’re doing is getting a reference to the <strong>AppDelegate</strong>.&#160; We then use that to get a reference to the <strong>NSManagedObjectContext</strong>.&#160; We use the context to get an <strong>NSManagedObject</strong> (notice that we use the name of the entity we created earlier here).&#160; We set the values to the text fields on our UI and then call <strong>save</strong> on the context.&#160; Run your app and fill out the text fields and tap the <strong>Save as New</strong> button and if all goes well, you’ll see the text <strong>Data saved</strong> in the debug console.</p>  <p><strong>Loading data</strong></p>  <p>Loading our data ends up being very easy to accomplish.&#160; The first thing we’ll do is add a couple of private variables to our <strong>ViewController</strong>:</p>  <blockquote>   <p>NSArray *fetchedObjects;      <br />NSManagedObject *selectedObject;       <br /></p> </blockquote>  <p>We’ll use these to store a reference to the data pulled back as well as the currently selected value.&#160; Now let’s implement the <strong>tappedLoadData</strong> method:</p>  <p><script src="https://gist.github.com/4022579.js?file=tappedLoadData.m"></script></p>  <p>Again, we get a reference to the context from the <strong>AppDelegate</strong>.&#160; We then generate a <strong>NSFetchRequest</strong> which we use on the entities.&#160; We can then iterate through the fetched results and log them.&#160; Last, we’ll pass the first fetched object to the <strong>displayManagedObject</strong> method and set it to the <strong>selectedObject</strong>.&#160; </p>  <p><script src="https://gist.github.com/4023100.js?file=displayManagedObject.m"></script></p>  <p>This method just sets the UI elements to the appropriate data fields from the fetched request.</p>  <p><strong>Moving through fetched entities</strong></p>  <p>Since we’ve already pulled the data back and put it into a private <strong>NSArray</strong>, we have a very easy time of moving forward and back through our data:</p>  <p><script src="https://gist.github.com/4023100.js?file=tappedNextPrevious.m"></script></p>  <p>As we know what the currently selected variable is, we can just loop forward or back to find the next or previous item.</p>  <p><strong>A Couple Other Things</strong></p>  <p>I somewhat glazed over / summarized what CoreData is and how it works at the beginning of the article by saying that it wraps SQLite.&#160; This is true and it isn’t true.&#160; CoreData is really an object graph and persistence mechanism that is created using SQLite.&#160; Additionally, you can actually use CoreData in a way that does NOT use SQLite.&#160; This is done by passing something other than <strong>NSSQLiteStoreType</strong> into the <strong>addPersistentStoreWithType</strong> method.&#160; For example, you can use <strong>NSInMemoryStoreType</strong> to store your data in memory (probably a bad idea considering the memory restrictions in iOS applications) to persist the data in memory.</p>  <p><strong>Conclusion</strong></p>  <p>Today we took a look at using <strong>CoreData</strong> which is a very powerful way of storing data.&#160; We’ve just scratched the surface of what you can do with <strong>CoreData</strong> as well.&#160; There is much more one can do including relationships, versioning, and more.&#160; We may touch on some of those topics in future articles but it will depend on what else we have to cover.&#160; You can <a title="iOS Day 12 Source Code" href="https://crcomcstorage.blob.core.windows.net/codesamples/iOSDayTwelve.zip">look at the finished source code from today here</a>.</p>