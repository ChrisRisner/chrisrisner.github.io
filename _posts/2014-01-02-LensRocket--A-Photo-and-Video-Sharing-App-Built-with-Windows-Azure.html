---
layout: post
title: "LensRocket: A Photo and Video Sharing App Built with Azure"
date: Thu Jan 02 2014 14:03:00
commentsOn: true
status: publish
type: post
published: true
categories: [Android, Azure, Mobile Services]
excerpt: "LensRocket is an Android application that allows users to share pictures and videos with their friends.  This app was built using Windows Azure Mobile Services, Notification Hubs, and Blob Storage."
logoUrl: null
keywords: azure,android,mobile services,blob storage,notification hubs,push notifications,java,snapchat
filepath: 2014-01-02-LensRocket--A-Photo-and-Video-Sharing-App-Built-with-Windows-Azure.html
disqus_identifier: LensRocket--A-Photo-and-Video-Sharing-App-Built-with-Windows-Azure
redirect_from: 
  - /PikShare--A-Photo-and-Video-Sharing-App-Built-with-Windows-Azure.html
  - /PikShare--A-Photo-and-Video-Sharing-App-Built-with-Windows-Azure/
  - /LensRocket/
---
{% include special/mobile_services_to_apps.html %}

<p><img title="SplashScreen for LensRocket" style="float: right; margin: 0px 0px 5px 5px; display: inline" alt="SplashScreen for LensRocket" src="https://crcomcstorage.blob.core.windows.net/images/lensrocket-splashscreen.png" width="233" align="right" height="462" />
<strong>Update 2/20/2014: Due to a few issues, the app formally known as PikShare has been renamed LensRocket.  Everything except some names remains the exact same as the originally released source code and application.</strong>
<br /><br />
Today I’m happy to announce I’ve released the source code for <a title="LensRocket on GitHub" href="http://aka.ms/androidlensrocket">LensRocket</a>.&#160; LensRocket is an Android app which allows users to share photos and videos with each other.&#160; The sender can also select how long the recipients have to view the pictures and videos.&#160; This probably sounds familiar because it’s how the very popular app <a title="SnapChat" href="http://www.snapchat.com/">SnapChat</a> works.&#160; LensRocket was built to demonstrate that <a title="Windows Azure" href="http://www.windowsazure.com">Windows Azure</a>, and more specifically <a href="http://www.windowsazure.com/en-us/develop/mobile/">Windows Azure Mobile Services</a>, could be used to quickly get a mobile application off the ground and running.&#160; More so, it shows that Mobile Services is fully capable of working as the backend for a serious mobile application and in this case, a social app.&#160; You can easily set up this demo yourself by <a href="http://www.windowsazure.com/en-us/pricing/free-trial/?WT.mc_id=A3F51C28C" title="Free Windows Azure Trial">signing up for a free trial for Windows Azure here</a>.</p>  


<p><strong>What does the app do</strong></p>  <p>If you think about the core capabilities of an app like this, there really isn’t that much to it.&#160; First, users need to be able to register for an account and then later they need to be able to log into that same account.&#160; From there, users should be able to find other users and become “friends” with them.&#160; Lastly, users should be able to record media, whether it’s pictures or video, and send them to those “friends”.&#160; Now, if that was all an app like SnapChat allowed you to do, it would be hard to imagine it having become so popular.&#160; The real reason SnapChat’s took off was that it makes the media ephemeral (a fancy way of saying it only lives for a short time).&#160; Specifically, users have the ability to decide for how many seconds that image or video is available for their friends to see.&#160; If you think about what that feature means, it makes sense how it’s made SnapChat so popular.&#160; In today’s world of “once it’s on the internet, you can’t get it off”, having some degree of assurance that things will actually be deleted <a title="A more erasable internet" href="http://online.wsj.com/news/articles/SB10001424052702304773104579272723222788620">feels pretty good</a>.&#160; That being said, there certainly has been some controversy over whether or not SnapChat <a title="SnapChat deleting files" href="http://www.theguardian.com/media-network/partner-zone-infosecurity/snapchat-photos-not-deleted-hidden">actually deletes the files</a> in addition to other apps being made that attempt to <a href="https://play.google.com/store/search?q=snapchat">grab the files off your device</a>.</p>  <p><strong>How does Azure help us</strong></p>  <p>If I have a great app idea, I definitely want to get my app out there and fast.&#160; Any delay means someone else can beat me to market and my app won’t become popular.&#160; Thankfully Windows Azure has a number of features that make it super simple to get all of the backend features I need but don’t have to spend the time designing, developing, testing, and maintaining them.&#160; For LensRocket we need to be able to authenticate users, store information for users, friend connections, and the files they want to share, actually store the files, as well as push notifications down to our users.&#160; Now, like I said before, this really isn’t a huge amount of stuff.&#160; However, if you think about the time it would take to design systems to handle all of these capabilities, then develop them, then test them, then load test them to make sure they can scale, and then maintain them as my app grows, that is a LOT of time.&#160; Not to mention that is all stuff that will take away from building a really great client experience.&#160; Thanks to the different pieces of Windows Azure, I get the ability to do all of that stuff with very little work on my side.</p>  <p><strong>What parts of Azure does LensRocket use</strong></p>  <p>First and foremost, LensRocket is using <a title="Windows Azure Mobile Services" href="http://www.windowsazure.com/en-us/develop/mobile/">Windows Azure Mobile Services</a>.&#160; Mobile Services is what’s known as a Backend-as-a-Service (or BaaS).&#160; The idea is that you spin it up and get access to a ton of features without having to do much work.&#160; If you haven’t looked at Mobile Services before, I highly advise taking a look through some of the <a title="Mobile Services Android Getting Started" href="http://www.windowsazure.com/en-us/develop/mobile/tutorials/get-started-android/">tutorials</a> or <a title="Mobile Services on Channel 9" href="http://channel9.msdn.com/Series/Windows-Azure-Mobile-Services">videos</a> to understand how it works.&#160; For our Mobile Service we’re using both the built in data storage (using SQL Database) as well as the Custom APIs.&#160; We’re also making heavy use of the scripting layer to put in custom logic as well as to handle our own user registration / authentication system (Mobile Services has built in authentication with Facebook, Google, Microsoft, and Twitter accounts but we’re rolling our own).&#160; Mobile Services has us completely covered for all of the relational data we need to store.&#160; For our file storage, we’re going to use <a title="Windows Azure Storage" href="http://www.windowsazure.com/en-us/documentation/services/storage/">Windows Azure Blob Storage</a>.&#160; Blob storage allows us to store both photos and videos extremely cheaply and gives us a way to secure those files so we can make sure only the appropriate people have access to them and only for the appropriate amount of time.&#160; Lastly, we’ll use <a title="Notification Hubs" href="http://www.windowsazure.com/en-us/documentation/services/notification-hubs/">Windows Azure Notification Hubs</a> to handle push notifications.&#160; Mobile Services has the ability to handle push notifications built into it, however, using Notification Hubs means I can easily set up templates for my pushes (for when I have this app running on more than just Android), do tag based pushes (i.e. easily perform a push notification to all of a user’s devices), as well as many other things.&#160; All of this without me having to build anything into my backend (i.e. keeping track of each user’s devices and what OS they are on and whether or not they want to get pushes, etc).&#160; One thing that is phenomenal about both Mobile Services and Notification Hubs is that they have a free tier.&#160; While storage does not have a free tier, storage is so cheap that I’d have to be storing several gigabytes of picture / video data before I’d even have to pay a dollar a month (Storage has two costs, the actual storage and transactions, however both are cheap).&#160; What this all means is that I can easily develop my app against Windows Azure for nearly free and then, when my app is released and usage goes through the roof, I just need to drag a slider to scale up my Mobile Service and Notification Hub (Storage doesn’t need to be told you want to scale, you just put more data in when you want to).&#160; </p>  <p><strong>Tell me about the code</strong></p>  <p>The <a title="Android LensRocket Source Code" href="http://aka.ms/androidlensrocket">source code which is available on GitHub</a> under the Apache V2 license, includes both the Android client java source code as well as the Mobile Services scripts (which are javascript).&#160; Once you’ve pulled the code down, you’ll find the Android code in <strong>source/client</strong> and the scripts in <strong>source/server</strong>.&#160; The <a title="LensRocket Readme" href="https://github.com/WindowsAzure-Samples/Android-LensRocket/blob/master/README.md">Readme file</a> includes instructions for how to set up your Mobile Service, Notification Hub, and Storage account as well as where to put the different account names and keys in the client and server code.&#160; I’m going to have several different blog posts talking about different pieces of the app (from both a client and server side) which will go into more detail about what’s going on in the source code but it should be pretty easy to dig around and understand what’s going on.&#160; </p>  <p><strong>WARNING!</strong></p>  <p>This is where I’d like to spell out a few caveats and warnings about the code.&#160; I put this application together quite quickly and therefore, it’s far from what I would consider a golden example of Android source code.&#160; If I had more time, things would be better refactored and cleaned up, I’d move more things to background threads, and the camera code would be much better.&#160; Specifically on the camera point, I ran into some serious issues while testing.&#160; While I think a lot of the “Android Fragmentation” talk is overblown, working with the camera to do photos and videos is one solid example of where this is a serious issue.&#160; I tested the application with a LG Nexus 4, a Samsung Galaxy Nexus, and a Samsung Galaxy S3 and the only area I ran into any real issues with one device working one way and the others working differently was with the camera (with a slight mention for the Action Bar / Status Bar).&#160; I’ll probably detail it in a full post because it was quite complicated to work through but, suffice to say, I actually had to put code in the application specifically for the Galaxy S3 (pictures taken with the camera weren’t properly rotated and I had to do it manually with bitmaps) and the Galaxy Nexus.&#160; Now I’m sure I could find more elegant and MUCH more efficient ways of handling the issues I ran into, but at the end of the day, this is not meant to be a shining example of how to build a perfect Android app, but how to build a really solid app that is based off of something insanely popular and&#160; is using a scalable backend based in the cloud.&#160; As time allows I’ll continue to refine and improve the code for this app.&#160; if anyone would like to walk through it and provide feedback or suggestions, I’d happily hear them (or you can <a title="Filing issues with LensRocket" href="https://github.com/WindowsAzure-Samples/Android-LensRocket/issues">file issues in GitHub</a>).</p>  <p><strong>Can I use this code for my own app?</strong></p>  <p>As the source code for this app is licensed under the <a title="Apache 2 License" href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache 2 license</a>, you’re free to do anything allowed therein, except hold me liable for it.&#160; I would highly recommend testing the client side code on more devices before launching anything in a public market though.&#160; The same goes for the server side scripts.</p>  <p><strong>What’s next?</strong></p>  <p>I’m hoping to release a version of this to the Google Play Store so that you can test it out without having to set everything up yourself.&#160; That should happen in early January and I’ll be sure to let people know (via this blog and <a title="Chris Risner on Twitter" href="https://twitter.com/chrisrisner">Twitter</a>) when it does.&#160; I’d also like to go back and test the client side code on more devices as well as clean a few things up when time allows.&#160; As I said above, there is a lot of code that touches the camera that I feel could be more efficient and I know there are a few things I could move over to background tasks.&#160; Additionally, there are steps that could be taken to make the app run a little better for the user like prefetching the media files.&#160; However, I think the next step for this will be to build an iOS version.&#160; I had started the ground work some time back (at one point I was trying to build the iOS and Android versions at the same time but quickly abandoned that idea).&#160; Now that I’ve tested my backend with the Android version, I can focus 100% on the client side while doing the iOS version.</p>  <p><strong>Summary</strong></p>  <p>LensRocket is a pretty powerful example of how Windows Azure can help you not worry about everything that goes into building a backend and instead focus on making a good client experience.&#160; In time this should become a great cross-platform example as well.&#160; For now, take a look at the <a title="LensRocket on GitHub" href="http://aka.ms/androidlensrocket">Android and server side source code on GitHub</a>.</p>