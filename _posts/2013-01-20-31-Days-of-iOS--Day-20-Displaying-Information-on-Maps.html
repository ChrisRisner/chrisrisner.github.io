---
layout: post
title: "31 Days of iOS: Day 20-Displaying Information on Maps"
date: Sun Jan 20 2013 00:11:00 GMT-0800 (PST)
comments: true
status: publish
type: post
published: true
categories: [Mobile, Objective-C, XCode, iOS]
excerpt: "This is day 20 in the 31 Days of iOS.  Today we continue talking about how to use maps in iOS applications and focus on how to display information with maps using annotations."
logoUrl: null
keywords: iOS,31 days of iOS,Apple,Apple iOS,UIMapView,Map view,map,MKMapView,MapKit,ShowUserLocation,current,longitude,latitude,CoreLocation,CLLocation,CoreLocationController,MKAnnotationView,How to develop iOS,iOS intro,iOS Introduction,iOS Tutorial,iOS for Beginners,Beginners,walkthrough
filepath: 2013-01-20-31-Days-of-iOS--Day-20-Displaying-Information-on-Maps.html
disqus_identifier: 31-Days-of-iOS--Day-20–Displaying-Information-on-Maps
redirect_from:
  - /2013-01-20-31-Days-of-iOS--Day-20%E2%80%93Displaying-Information-on-Maps/
  - /2013-01-20-31-Days-of-iOS--Day-20–Displaying-Information-on-Maps/
  - /31-Days-of-iOS--Day-20–Displaying-Information-on-Maps/
  - /31-Days-of-iOS--Day-20–Displaying-Information-on-Maps
---
<p><img style="margin: 0px 0px 5px 5px; display: inline; float: right" align="right" src="http://chrisrisner.com/upload/200px-Apple-logo.png" width="170" height="208" />Welcome to Day 20 of the <a title="31 Days of iOS" href="http://chrisrisner.com/31-Days-of-iOS">31 Days of iOS</a>.&#160; <a title="Day 19: Showing the Current Location on Maps" href="http://chrisrisner.com/31-Days-of-iOS--Day-19%E2%80%93Showing-the-User%27s-Location-with-Maps">Yesterday</a>, we started discussion how to use maps inside your iOS applications.&#160; We reviewed how to display a map, how to show the user’s current location, and how to subscribe to updates that are triggered when the user’s location changed.&#160; Lastly, we looked at how to pull the current longitude and latitude out and display it.&#160; Today, we’re going to take the next step and go over how to display additional information on the map.&#160; This is known an annotating a map and is how you’d handle displaying landmarks, points of interest, or any other information on the map.&#160; We’re going to <a title="iOS Day 19 Source Code" href="http://storage.chrisrisner.com/codesamples/iOSDayNineteen.zip">start with the source code from day 19</a> and add on to it.&#160; However, if you’d like to follow along with the <a title="iOS Day 20 source code" href="http://storage.chrisrisner.com/codesamples/iOSDayTwenty.zip">completed code, you can access it here</a>.</p>  <p><strong>Handling the UI</strong></p>  <p>As a reminder, if we run our application, it will currently display a map with our location on it.&#160; At the top of the application we have the longitude and latitude printed out:</p>  <p align="center"><img title="iOS Day 20 Initial" alt="iOS Day 20 Initial" src="http://storage.chrisrisner.com/images/31iosday20-initial-ui.jpg" width="277" height="289" /></p>  <p>Before we make changes to our actual map, we are going to add a few buttons to our UI so we have something to trigger adding and removing items to the map.&#160; Open <strong>MainStoryboard.Storyboard</strong> and drag two round rect buttons over so they are to the right of the labels.&#160; When you’re done, the UI should look like this:</p>  <p align="center"><img title="new UI for day 20" alt="new UI for day 20" src="http://storage.chrisrisner.com/images/31iosday20-new-ui.jpg" /></p>  <p>Now switch to the <strong>Assistant Editor</strong> in the top right of Xcode and <strong>control + click and drag</strong> from each button to your view controller and create new actions for each button.&#160; While we’re editing the <strong>ViewController.h </strong>file, let’s also set it to implement the <strong>MKMapViewDelegate</strong> class.&#160; When we’re done, our header should look like this:</p>  <p><script src="https://gist.github.com/4273903.js?file=ViewController.h"></script></p>  <p>Now we can implement the annotations.</p>  <p><strong>MapView delegates</strong></p>  <p>Before we start adding annotations, we need to set the <strong>mapView</strong>’s delegate.&#160; Switch over to <strong>ViewController.m</strong>.&#160; In the <strong>viewDidLoad </strong>method, right after setting the <strong>showUserLocation</strong> property on the <strong>mapView</strong> we are going to add a line to set the <strong>mapView</strong>’s <strong>delegate</strong> to be the <strong>ViewController </strong>(<strong>self</strong>):</p>  <p><script src="https://gist.github.com/4273903.js?file=ViewDidLoad.h"></script></p>  <p>Now we can implement the <strong>Add</strong> button to put some annotations on the map.</p>  <p><strong>Adding annotations</strong></p>  <p>Today, we’re going to hardcode the location of the annotation we’re going to add to the map.&#160; If we wanted to, we could implement the <strong>update: Location</strong> method to save the current latitude and longitude to a local variable so we could add our annotation at the same point.&#160; Alternatively, we could pull a list of longitudes and latitudes from somewhere and use that to put annotations on the map.&#160; Since both of those involve the same logic (just replacing how we get the longitude and latitude) we’re going to skip over and just use static values.&#160; The first thing we’re going to do is create a new <strong>CLLocationCoordinate2D</strong>.&#160; We’ll set the longitude and latitude properties for this value and then use that to generate a <strong>MKPointAnnotation</strong>.&#160; Finally, this object is passed into the <strong>mapView</strong>’s <strong>addAnotation </strong>method.&#160; Our <strong>tappedAdd</strong> method will look like this:</p>  <p><script src="https://gist.github.com/4273903.js?file=tappedAdd.m"></script></p>  <p>Before we can run our app, we need to implement one method from the <strong>MKMapViewDelegate</strong> class.&#160; This method is the <strong>mapView: viewForAnnotation</strong> method.&#160; This method is called on a map view for any annotations on a map.&#160; One thing to consider is that the blue indicator that shows the device’s location is also an annotation and therefore this method is called for it.&#160; Since this is where we handle what the annotation will look like, we don’t want to “intercept” the call for the current location indicator.&#160; The first thing we’ll do is check and see if the <strong>MKAnnotation</strong> sent into the method is of the type <strong>MKUserLocation</strong>.&#160; If it is, we just return <strong>nil </strong>from our method.&#160; If not, we continue on and attempt to dequeue a <strong>MKPinAnnotationView</strong>.&#160; If we’re unable to do that, then we generate a new <strong>MKPinAnnotationView</strong>.&#160; We could create our own annotation view but we’re going to use the default which will result in a red pin being dropped on the map.&#160; After that, we set properties on the annotation view and return it.&#160; The method will end up looking like this:</p>  <p><script src="https://gist.github.com/4273903.js?file=mapViewForAnnotation.m"></script></p>  <p>Now when we run our application and tap the <strong>Add </strong>button, we should see a pin dropped on the map (the pin is going to show up in Washington state in the United States since we hard coded the location of our annotation):</p>  <p align="center"><img title="map view with annotation" alt="map view with annotation" src="http://storage.chrisrisner.com/images/31iosday20-map-annotation.jpg" /></p>  <p>Since we set the <strong>canShowCallout</strong> to <strong>YES</strong> in the <strong>mapView: viewForAnnotation</strong> method, we can tap on our annotation and see the description and subtitle we had set earlier:</p>  <p align="center"><img title="Annotation Details" alt="Annotation Details" src="http://storage.chrisrisner.com/images/31iosday20-annotation-details.jpg" /></p>  <p><strong>Removing annotations</strong></p>  <p>Removing annotations is easy to do by accessing the <strong>mapView</strong>’s <strong>annotations</strong> property.&#160; We could call the <strong>removeAnnotations</strong> method on the <strong>mapView</strong> and passing in the <strong>mapView</strong>’s <strong>annotations</strong> property.&#160; However, the same issue arises that we saw in the <strong>mapView: viewForAnnotation</strong>.&#160; That being that the user’s location is an annotation on the map view.&#160; So instead of calling <strong>removeAnnotations</strong> and removing an array, we’ll loop through the <strong>annotations</strong> and remove them if they aren’t a <strong>MKUserLocation</strong>.&#160; Our <strong>tappedRemove</strong> will look like this:</p>  <p><script src="https://gist.github.com/4273903.js?file=tappedRemove.m"></script></p>  <p>Now when you run the app and tap <strong>Add</strong> and then <strong>Remove</strong>, you should see the annotations go away.</p>  <p><strong>Conclusion</strong></p>  <p>Today we looked at how to add additional information into a map view.&#160; This is done by creating annotations and specifying a longitude and latitude that they should appear at.&#160; Additionally we looked at how to remove annotations.&#160; While we hard coded things like the description and the location of the annotation, you should be able to use this knowledge to handle putting annotations on a map programmatically after pulling the location from the internet or anywhere else.&#160; You can <a title="iOS Day 20 source code" href="http://storage.chrisrisner.com/codesamples/iOSDayTwenty.zip">download the completed code from today’s walkthrough here</a>.</p>