---
layout: post
title: "31 Days of iOS: Day 30-Adding Google Analytics to your App"
date: Wed Jan 30 2013 07:46:00 GMT-0800 (PST)
comments: true
status: publish
type: post
published: true
categories: [Google, Mobile, Objective-C, XCode, iOS]
excerpt: "Day 30 in the 31 Days of iOS talks about how to measure your apps usage using Google Analytics.  We'll review how to set up a new app in the analytics portal as well as how to implement it in your apps."
logoUrl: null
keywords: iOS,31 days of iOS,Apple,Apple iOS,analytics,google analytics,metrics,SDK,GAI,GAITracker,libGoogleAnalytics,trackUncaughtExceptions,iOS Introduction,iOS Tutorial,iOS for Beginners,Beginners,walkthrough
filepath: 2013-01-30-31-Days-of-iOS--Day-30-Adding-Google-Analytics-to-your-App.html
disqus_identifier: 31-Days-of-iOS--Day-30–Adding-Google-Analytics-to-your-App
redirect_from:
  - /2013-01-30-31-Days-of-iOS--Day-30%E2%80%93Adding-Google-Analytics-to-your-App/
  - /2013-01-30-31-Days-of-iOS--Day-30–Adding-Google-Analytics-to-your-App/
---
<p><img style="margin: 0px 0px 5px 5px; display: inline; float: right" align="right" src="http://chrisrisner.com/upload/200px-Apple-logo.png" width="170" height="208" />Welcome to Day 30 of the <a title="31 Days of iOS" href="http://chrisrisner.com/31-Days-of-iOS">31 Days of iOS</a>.&#160; <a title="Day 29: Advertising with iAd" href="http://chrisrisner.com/31-Days-of-iOS--Day-29%E2%80%93Advertising-with-iAd">Yesterday</a>, we talked about putting advertisements into iOS applications using iAd.&#160; Today we’re going to look at an important way of understanding how your app is used:&#160; adding analytics.&#160; Specifically we’ll be looking at adding <a title="Google Analytics for iOS" href="https://developers.google.com/analytics/devguides/collection/ios/">Google Analytics</a> into your applications.&#160; Analytics allow you to log the usage of your apps so, without asking the people using your app, you can know what features they’re using, how often, and much much more.&#160; We’ll be starting with a brand new project, but if you’d like to <a title="iOS Day 30" href="http://storage.chrisrisner.com/codesamples/iOSDayThirty.zip">follow along with the completed code, you can access it here</a>.&#160; You’ll need to change the tracking ID in the <strong>AppDelegate.h</strong> to one of your own (which will make more sense as you read along) before it will work correctly.</p>  <p><strong>Creating our project and handling the UI</strong></p>  <p>Open up Xcode and choose <strong>File</strong>, <strong>New</strong>, <strong>Project</strong>.&#160; We’ll use a <strong>Single View Application</strong> and name it <strong>DayThirty</strong>:</p>  <p align="center"><img title="New project for Day 30" alt="New project for Day 30" src="http://storage.chrisrisner.com/images/31iosday30-new-project.jpg" /></p>  <p>For today’s project, we’re going to add a few things to our user interface.&#160; Open up <strong>MainStoryboard.storyboard</strong>.&#160; The first thing we’re going to do is click on your view and go to the <strong>Editor</strong> menu and choose <strong>Embed In </strong>and selected <strong>Navigation Controller</strong>.&#160; Afterwards, your storyboard should look like this:</p>  <p align="center"><img title="Adding a Nav Controller" alt="Adding a Nav Controller" src="http://storage.chrisrisner.com/images/31iosday30-nav-controller.jpg" /></p>  <p>The next thing we’ll do is drop a few things into our UI including a<strong> text field</strong>, and two<strong> round rect buttons</strong>.&#160; Afterwards, the UI will look like this:</p>  <p align="center"><img title="Day 30 UI with buttons" alt="Day 30 UI with buttons" src="http://storage.chrisrisner.com/images/31iosday30-ui-with-buttons.jpg" /></p>  <p>Open the <strong>Assistant Editor</strong> in the top right of Xcode and <strong>control + click and drag</strong> from the <strong>text field </strong>and first button to your code behind.&#160; For the <strong>text field</strong>, you’ll want to create an outlet and for the button, an action.&#160; When you’re done, the code will look like this in <strong>ViewController.h</strong>:</p>  <p><script src="https://gist.github.com/4583489.js?file=ViewController.h"></script></p>  <p>Now, close the <strong>Assistant Editor</strong>.&#160; Drag a new <strong>View Controller </strong>on to your storyboard.&#160; Then <strong>control + click and drag </strong>from the second button to the new <strong>View Controller</strong>.&#160; In the <strong>Action Segue</strong> modal that pops up when you release, choose <strong>push</strong>.&#160; When you’re done, the storyboard should look like this:</p>  <p align="center"><img title="Storyboard with segue" alt="Storyboard with segue" src="http://storage.chrisrisner.com/images/31iosday30-storyboard-2.jpg" /></p>  <p>Now we’re finally ready to start adding analytics.</p>  <p><strong>Adding the Google Analytics SDK</strong></p>  <p>The first thing we need to do is download the <a title="Google Analytics SDK for iOS" href="https://developers.google.com/analytics/devguides/collection/ios/">Google Analytics SDK for iOS</a>.&#160; As of writing, the <em>recommended</em> version is the 2.0 beta 4.&#160; This may be different when you read this but unless the version is drastically different, everything here should be pretty much the same. After you unzip the library into your apps directory, expand the <strong>Frameworks</strong> group in the Xcode <strong>Project Navigator</strong>.&#160; Right click on <strong>Frameworks</strong> and choose <strong>New Group</strong> and name it <strong>GoogleAnalytics</strong>.&#160; Right click on that group then and choose <strong>Add Files</strong>.&#160; Navigate to the <strong>Library </strong>folder in what you unzipped.&#160; Select the following files: <strong>GAI.h</strong>, <strong>GAITracker.h</strong>, <strong>GAITrackerController.h</strong>, <strong>GAITransaction.h</strong>, <strong>GAITranscationItem.h</strong>, and <strong>libGoogleAnalytics.lib</strong>.&#160; When you’re done, your project will look like this:</p>  <p align="center"><img title="Added GAI files" alt="Added GAI files" src="http://storage.chrisrisner.com/images/31iosday30-added-gai-files.jpg" /></p>  <p>Since Google Analytics makes use of <strong>CoreData</strong> and <strong>SystemConfiguration</strong>, we need to do one more thing for our project.&#160; Click the project in the <strong>project navigator</strong> so you pull up the <strong>target</strong> properties.&#160; Click on <strong>Build Phases</strong> and expand <strong>Link Binary with Libraries</strong>.&#160; Choose <strong>CoreData.framework</strong> and <strong>SystemConfiguration.framework</strong>.&#160; Your libraries will then look like this:</p>  <p align="center"><img title="Libraries for Google Analytics" alt="Libraries for Google Analytics" src="http://storage.chrisrisner.com/images/31iosday30-libraries.jpg" /></p>  <p>Now before we can proceed with the code, we need to do a couple things in the Google Analytics portal.&#160; </p>  <p><strong>Creating a Google Analytics account and app</strong></p>  <p>Go to <a href="http://www.google.com/analytics">http://www.google.com/analytics</a> and sign in or create an account if you don’t already have one.&#160; Once signed in, click the <strong>Admin </strong>button near the top right.&#160; If you already have an account you want to add your mobile app to, choose that one, otherwise, create an account using the <strong>+ New Account </strong>button and then select the account.&#160; If you are creating a new account, make sure you select <strong>App</strong> when asked what you would like to track.&#160; If you already have an account, click the <strong>+ New Property (web or app) </strong>button and fill out the information needed.&#160; When you’re done, you should be presented with a <strong>Tracking ID</strong> that will look like this:</p>  <p align="center"><img title="Google Analytics Tracking ID" alt="Google Analytics Tracking ID" src="http://storage.chrisrisner.com/images/31iosday30-tracking-id.jpg" /></p>  <p>Now we can start working with our code.</p>  <p><strong>Setting up the tracker</strong></p>  <p>Return to Xcode and open the <strong>AppDelegate.m</strong> file.&#160; First import the <strong>GAI.h</strong> class in the file, and then we’re going to make some changes to <strong>application: didFinishLaunchingWithOptions</strong>:</p>  <p><script src="https://gist.github.com/4583489.js?file=applicationLaunch1.m"></script></p>  <p>Here all we’re doing is setting up the tracker to use the tracking ID we have above.&#160; This is all we <em>have</em> to do before we start tracking things, however, there are a few additional options we’re going set (as Google recommends in their docs):</p>  <p><script src="https://gist.github.com/4583489.js?file=applicationLaunch2.m"></script></p>  <p>The first thing we’re setting is <strong>trackUncaughtExceptions</strong>.&#160; This makes it so our tracker will track and log any uncaught exceptions.&#160; Next we have <strong>dispatchInterval</strong>.&#160; This controls how often tracking information is sent to the analytics servers&#160; If it’s 20, as we’ve set it, then at the most frequent, tracking information will be sent every 20 seconds.&#160; If this is set to zero, then tracking information will be sent immediately.&#160; If it’s a negative value, the tracker will never automatically send over information, but will require you to call it’s <strong>dispatch</strong> method on it.&#160; Lastly, the default value is <strong>120 </strong>so if you don’t set it to anything, that’s what will be used.&#160; The last thing we’re setting is the <strong>debug</strong> property.&#160; Setting this means that messages will also be sent to the debugger using <strong>NSLog</strong> which is helpful for debugging your calls to the tracker.</p>  <p><strong>Logging screen views</strong></p>  <p>The first thing we’re going to look at is how to log screen views.&#160; Fortunately, Google has provided a built in way to do this with <strong>ViewController</strong>s.&#160; First, open up <strong>ViewController.h</strong> and import that <strong>GAITrackedViewController.h </strong>class.&#160; Next, replace the class your view controller subclasses from <strong>UIViewController</strong> to <strong>GAITrackedViewController</strong>.&#160; When you’re done, your class header will look like this:</p>  <p><script src="https://gist.github.com/4583489.js?file=ViewController2.h"></script></p>  <p>Now before switching over to the implementation, try running your app.&#160; You should see a debug message show up in the debug console:</p>  <blockquote>   <p>2013-01-22 21:41:34.535 DayThirty[6740:c07] GoogleAnalytics 2.0b4 -[GAITrackedViewController viewDidAppear:] (GAITrackedViewController.m:26) DEBUG: Tracked view controller missing view name.      <br /></p> </blockquote>  <p>When you use a <strong>GAITrackedViewController</strong> it automatically tracks the view whenever it appears.&#160; However, in order to do this, you also need to specify the view’s name.&#160; Open up <strong>ViewController.m</strong> and set the controller’s <strong>trackedViewName</strong> in the <strong>viewDidLoad </strong>method like this:</p>  <p><script src="https://gist.github.com/4583489.js?file=viewDidLoad.m"></script></p>  <p>Now run your app again.&#160; Now you’ll see a different message:</p>  <blockquote>   <p>2013-01-22 21:44:58.903 DayThirty[6788:c07] GoogleAnalytics 2.0b4 -[GAIDispatcher internalCreateTimer] (GAIDispatcher.m:195) DEBUG: Created timer to fire every 20.0s      <br /></p> </blockquote>  <p>And then a little bit later:</p>  <blockquote>   <p>2013-01-22 21:45:19.094 DayThirty[6788:c07] GoogleAnalytics 2.0b4 -[GAIDispatcher dispatchComplete:withStartTime:withRetryNumber:withResponse:withData:withError:] (GAIDispatcher.m:394) DEBUG: Hit /GAIHit/p1 dispatched (182ms): HTTP status 200      <br />2013-01-22 21:45:19.096 DayThirty[6788:c07] GoogleAnalytics 2.0b4 -[GAIDispatcher dispatchComplete:withStartTime:withRetryNumber:withResponse:withData:withError:] (GAIDispatcher.m:415) DEBUG: Successfully dispatched hit /GAIHit/p1 (0 retries).       <br />2013-01-22 21:45:19.097 DayThirty[6788:c07] GoogleAnalytics 2.0b4 -[GAIDispatcher dispatchComplete:withStartTime:withRetryNumber:withResponse:withData:withError:] (GAIDispatcher.m:422) DEBUG: Pending hit queue drained.       <br />2013-01-22 21:45:19.097 DayThirty[6788:c07] GoogleAnalytics 2.0b4 -[GAIDispatcher cancelTimer] (GAIDispatcher.m:224) DEBUG: Canceled timer with interval 20.0s</p> </blockquote>  <p>So after the 20 seconds, the tracking message is dispatched to the server.&#160; We received a 200 response code and then the timer was turned off because we didn’t have any other messages.&#160; Now if you go to the <a title="Google Analytics" href="https://www.google.com/analytics/">analytics website</a> for your app and expand the <strong>Engagement </strong>section and look at <strong>Screens</strong>, you’ll see one hit against <strong>My First Screen</strong>:</p>  <p align="center"><img title="Tracking our frist screen" alt="Tracking our frist screen" src="http://storage.chrisrisner.com/images/31iosday30-first-screen.jpg" /></p>  <p>If you want to track a screen view without using the <strong>GAITrackedViewController </strong>class, you could do so by getting a reference to the tracker and calling this:</p>  <blockquote>   <p><strong>[tracker sendView:@”Home Screen”];</strong></p> </blockquote>  <p><strong>Tracking events</strong></p>  <p>Now that we’ve seen how to track screen views let’s look at how to track events.&#160; Events could be anything from a button press or data entry / selection, use of an item in a game, use of a feature or anything else.&#160; There are four values you can track when an event occurs: <strong>Category</strong>, <strong>Action</strong>, <strong>Label</strong>, and <strong>Value</strong>.&#160; All but the <strong>Value</strong> are strings and <strong>Value </strong>is a number.&#160; Let’s return to <strong>ViewController.m</strong> and track a button press:</p>  <p><script src="https://gist.github.com/4583489.js?file=tappedButtonOne.m"></script></p>  <p>Now when you run the app and tap the first button, a few minutes later we’ll see the info show up in the analytics portal.&#160; Under <strong>Engagement</strong>, go to <strong>Events </strong>and then <strong>Overview</strong>:</p>  <p align="center"><img title="Events in the Analytics site" alt="Events in the Analytics site" src="http://storage.chrisrisner.com/images/31iosday30-events.jpg" /></p>  <p>This is where you start to see some of the amazing power (and complication) with using something like Google Analytics.&#160; We can choose whatever standard or format we want for the data we send over for events.&#160; Here I’ve used the screen as the category, what the user did (press a button) as the action, and the name of the button for the label.&#160; However, I could choose to do whatever I want.&#160; For example, since I have a label on my screen, I could pull the text value out and send that over as one of the properties.&#160; You’re not bound to do anything specific, but that does mean you need to pick your own format for what you’re going to send over.</p>  <p><strong>Other tracking</strong></p>  <p>There is a lot of other options when it comes to tracking with Google Analytics.&#160; We aren’t going to cover any of them in depth, but now that you’ve seen the basics, you should be able to figure them out from the documentation:</p>  <ul>   <li><a title="Custom Dimensions and Metrics" href="https://developers.google.com/analytics/devguides/collection/ios/v2/customdimsmets">Custom dimensions and metrics</a> </li>    <li><a title="Tracking in-app purchases" href="https://developers.google.com/analytics/devguides/collection/ios/v2/ecommerce">Tracking in-app purchases</a> </li>    <li><a title="Session management" href="https://developers.google.com/analytics/devguides/collection/ios/v2/sessions">Session management</a> </li>    <li><a title="Social Interactions" href="https://developers.google.com/analytics/devguides/collection/ios/v2/social">Social interactions</a> </li>    <li><a title="User timings" href="https://developers.google.com/analytics/devguides/collection/ios/v2/usertimings">User timings</a> </li> </ul>  <p><strong>Other platforms</strong></p>  <p>We’ve only looked at using Google Analytics today but there are many other providers you can use for iOS app analytics including (just some of them):</p>  <ul>   <li><a title="Flurry" href="http://www.flurry.com/">Flurry</a> </li>    <li><a title="Localytics" href="http://www.localytics.com/">Localytics</a> </li>    <li><a title="Adobe Marketing" href="http://www.adobe.com/solutions/digital-analytics.html">Adobe Marketing (formally / still Omniture)</a> </li>    <li><a title="Crashalytics" href="http://try.crashlytics.com/">Crashalytics (primarily for crash tracking but still useful)</a> </li> </ul>  <p><strong>Conclusion</strong></p>  <p>Today we looked at implementing Google Analytics into your iOS apps.&#160; Using GA, you can get insight into how your application is used, what features aren’t used, and what users are doing.&#160; Even if you’re just building an app for fun, putting in analytics is a great idea so you understand what’s going on in your app.&#160; Even more so, many of the providers have some sort of crash reporting which is really useful in making sure you know if your app is having problems.&#160; You can <a title="iOS Day 30" href="http://storage.chrisrisner.com/codesamples/iOSDayThirty.zip">download the completed code from today’s walkthrough here</a>.&#160; Remember that you’ll need to change the tracking ID in <strong>AppDelegate.h</strong>.</p>