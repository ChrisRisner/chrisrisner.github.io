---
layout: post
title: "Unwinding with iOS and Storyboards"
date: Wed Apr 03 2013 13:39:00 GMT-0700 (PDT)
comments: true
status: publish
type: post
published: true
categories: [Objective-C, XCode, iOS]
excerpt: "This walkthrough talks about two ways to return to a root (or other) view controller.  One of the ways is code based and available for older versions of iOS while the second version demonstrates how to use Unwind Segues which were a new feature in iOS6."
logoUrl: null
keywords: iOS,unwind,view controller,move back,stack,navigation controller,modal,pop,dismiss,dismissViewController,popToRootViewController,unwind segue,exit,IBAction,UIStoryboardSegue, canPerformUnwindSegueAction
filepath: 2013-04-03-Unwinding-with-iOS-and-Storyboards.html
disqus_identifier: Unwinding-with-iOS-and-Storyboards
---
<p>Last night and today I was running into an issue where I wanted to jump from one position in an iOS app back to the start.&#160; Essentially I had something that looked a lot like this:</p>  <p align="center"><img title="several view controllers" alt="several view controllers" src="http://storage.chrisrisner.com/images/iOS-5-view-controllers.jpg" /></p>  <p>Several View Controllers lined up in a row.&#160; In this case, the view controller at the far left (so the second “item”) is the root.&#160; There is a button on that VC that pushes you to the second (or middle item).&#160; The second VC has another button that pushes you to the third VC (fourth item).&#160; That VC has two buttons: one that should return you back to the beginning and one that opens another VC in a modal.&#160; That last VC has a single button which should also push you back to the beginning.&#160; I did it this way so I could test out both returning from a modal and returning through a pushed stack of VCs.&#160; Basically, I wanted to be able to do this:</p>  <p align="center"><img title="View Controllers with Arrows" alt="View Controllers with Arrows" src="http://storage.chrisrisner.com/images/ios-view-controllers-with-arrows.jpg" /></p>  <p>This isn’t very uncommon and a quick search of the internet will review quite a few posts on Stack Overflow and other sites.&#160; It’s important to point that here I’m going to each “next” view controller via a segue.&#160; Now the “old” or common way of returning back definitely wasn’t as nice as just going back via a segue or anything like that.&#160; The steps you used to take were to:</p>  <ul>   <li>Create a delegate on the destination View Controller. </li>    <li>Implement that delegate on the source View Controller. </li>    <li>In the <strong>prepareForSegue</strong> method, set the destination VC’s delegate to be the source VC. </li>    <li>When you want to “bounce back” you’d have to keep firing methods up the delegate ladder until you got to where you wanted to be. </li> </ul>  <p>I don’t want to say that I’m lazy but putting all of this code into a sample didn’t make much sense.&#160; It clutters up the code and takes the focus away from what I want to actually demonstrate.&#160; I put a <a title="My question on Twitter" href="https://twitter.com/chrisrisner/status/319497852424441857">question out on Twitter</a> asking how people would suggest pulling this off and received one <a title="Sasha&#39;s response" href="https://twitter.com/goldshtn/status/319498460623691777">interesting response</a> from my fellow polyglot <a title="Sasha&#39;s blog" href="http://blog.sashag.net">Sasha</a>.&#160; His suggestion was to use something called an <strong>unwind segue</strong>.&#160; Right before he posted that response, I actually found a different, fairly straightforward, solution so I figured I would post about them both.&#160; I ran into a funny issue with the <strong>unwind segue</strong> that I didn’t find documented anywhere so I thought it would be a smart idea to put it up here.</p>  <p><strong>Doing it in code</strong></p>  <p>The first technique I found for doing this came about as I was messing around with different ways to pop and dismiss view controllers.&#160; Essentially what I wanted to do was return to the root view controller and from any controller, it’s possible to access the root VC.&#160; From there you just need a way to dismiss any modals and then pop any VCs on top of the navigation stack.&#160; Let’s take a look at how you do this by first looking at the source view controller (i.e. one of the VCs on the right):</p>  <p><script src="https://gist.github.com/ChrisRisner/5304762.js?file=performSelector.m"></script></p>  <p>Here we’re getting a reference to the root <strong>UINavigationController</strong>.&#160; After that we access the actual <strong>Root View Controller</strong>.&#160; Lastly, we say we want to call the <strong>returnToRoot</strong> method on the root view controller using the <strong>performSelector</strong> method.&#160; Now we can hop over to the root VC and implement that method:</p>  <p><script src="https://gist.github.com/ChrisRisner/5304762.js?file=returnToRoot.m"></script></p>  <p>The first thing we do is call <strong>dismissViewController</strong> on the VC which will remove any modals.&#160; Next, we call the <strong>popToRootViewControllerAnimated</strong> method on the VC’s <strong>navigationController</strong> property.&#160; This removes all of the pushed VCs from the navigation stack.&#160; This all seems to work fine.&#160; I will point out that this might not work if you have several modals mixed in with different NavigationControllers.&#160; Though if you are doing that, you probably have a bigger problem on your hands.</p>  <p><strong>Unwind Segues</strong></p>  <p>Prior to Sasha mentioning it in response to my tweet, I’m pretty sure I had not heard the term <strong>Unwind Segue</strong> before.&#160; I’m pretty happy I have now.&#160; I had to do a little looking online before I was pointed at a video from WWDC 2012 (session 407 if you have access to watch).&#160; In that video they talk mostly about storyboards and combining storyboards with XIB files.&#160; However, for the last 10 or so minutes, they cover a new to iOS 6 concept called <strong>Unwind Segues</strong>.&#160; The idea is that instead of you needing to do the delegate ladder steps mentioned above, Interface Builder can take care of it for you.&#160; This is done by doing two things.&#160; First you need to add a method to your destination VC.&#160; So for example, in the layout above, I’m returning to my root which is tied to the <strong>ViewController </strong>class (the same class you get with any default single page application).&#160; So, inside that class I’ve added this method:</p>  <p><script src="https://gist.github.com/ChrisRisner/5304762.js?file=reset.m"></script></p>  <p>This method returns an <strong>IBAction </strong>and takes in a <strong>UIStoryboardSegue</strong>.&#160; Using this method format will tell Xcode that this is a method that can be <em>unwound</em> to.&#160; Inside of that method I can cast the source VC from the <strong>segue</strong> object.&#160; So if there was information on the source VC that I want to pull out, I can do so inside of my <strong>reset</strong> method here.&#160; As it is, I’m not doing anything, just adding the empty method.&#160; The next step happens in the storyboard so open that.&#160; From the button I want to use to return to the first VC, I <strong>control + click and drag</strong> from the button to the green Exit icon below my view controller:</p>  <p align="center"><img title="Connecting exit actions" alt="Connecting exit actions" src="http://storage.chrisrisner.com/images/ios-connect-exit.jpg" /></p>  <p>When I let go on Exit, I’ll see all of the methods in my code base that match the format I mentioned above:</p>  <p align="center"><img title="Exit Methods" alt="Exit Methods" src="http://storage.chrisrisner.com/images/ios-exit-actions.jpg" /></p>  <p>Here I can select the reset method I created before.&#160; Now when I run my app and tap on the button I connected, iOS will look back through my stack and call a method named <strong>canPerformUnwindSegueAction</strong> on each VC up the stack until it finds one that will respond.&#160; So in other words, it’s going to travel up the stack and say “can this view controller respond to the <strong>reset</strong> selector?&#160; No? ok I’ll keep going.&#160; Yes? Ok I’ll execute it and remove the other VCs in between!”.&#160; So when I tap the button, it will go back to the first VC.&#160; </p>  <p><strong>What’s the catch?</strong></p>  <p>When I did this with the simple app I outlined above, everything worked fine.&#160; When I fired my <strong>reset</strong> Exit method from the VCs on the right side, things were returned to my root VC.&#160; All was good (and arguably better than what I outlined above).&#160; However, when I implemented the same thing in my more complex sample, it didn’t work.&#160; At first I thought it had something to do with the fact that I was trying to unwind from a Modal down through some pushed VCs to the root.&#160; However, even when I tried&#160; from somewhere that was just 3 pushed VCs in (i.e. no Modals) it didn’t work.&#160; In fact, each time, whether I was exiting from a modal or a pushed VC, only one VC was dismissed or popped.&#160; I was racking my brains until I thought, maybe I need to implement the <strong>canPerformUnwindSegueAction</strong> myself.&#160; So sure enough, after adding this method to all of the custom View Controllers I had implemented “in between” and returned <strong>NO</strong>&#160; (i.e. this VC won’t respond to the <strong>reset</strong> selector) things worked and it returned to the root VC properly.&#160; </p>  <p><strong>Conclusion</strong></p>  <p>Today we looked at two different methods to return to a root view controller from somewhere down the navigation stack in your iOS apps.&#160; The first technique was all code based and required us calling a method on the root VC which then dismisses any models and then popping any pushed VCs.&#160; The second method uses a new technique called <strong>Unwind Segues</strong> which enables you to connect an action in Interface Builder to a Exit method in another VC.&#160; iOS will then handle traversing the stack and figuring out what VC to return to (with potentially a little help from you and the <strong>canPerformUnwindSegueAction</strong> method).&#160; Remember that the <strong>Unwind Segues</strong> are iOS 6 and up.&#160; Hopefully this helps some developers out there as much as it helped me.</p>