---
layout: post
title: "Deploying WordPress on Azure and using MySQL in a VM"
date: Tue Jun 17 2014 11:20:00
commentsOn: true
status: publish
type: post
published: true
categories: [Blogging, Azure, Boats, PHP, Open Source]
excerpt: "This post describes how to deploy a WordPress site on Microsoft Azure and then create a VM for hosting your MySQL database and connect WordPress to that database."
logoUrl: null
keywords: Azure,WordPress,blog,MySQL,VM,virtual machine,MySQL on azure
filepath: 2014-06-17-Deploying-WordPress-on-Azure-and-using-MySQL-in-a-VM.html
disqus_identifier: Deploying-WordPress-on-Azure-and-using-MySQL-in-a-VM
---
<p>Recently I sold my <a title="The old boat" href="http://chrisrisner.com/I'm-on-a-Boat">old sailboat</a> and purchased a new (to me) one.&#160; With this new, larger, and older boat, I wanted somewhere for my wife and I to post about working on the boat as well as our (hopefully awesome) sailing adventures.&#160; While I wrote and continue to maintain the <a title="Veritas Blogging Engine" href="http://chrisrisner.com/Category/Veritas">blogging engine that powers this site</a>, I really wanted to play around with a more mainstream blogging engine for the new site.&#160; I <a title="Tweeting about blog engines" href="https://twitter.com/chrisrisner/status/468954056321695744">asked</a> the Twitter community for suggestions on engines to check out and received quite a few: Ghost, GitHub Pages, Tumblr, Squarespace, Jekyll, Ghost, and WordPress.&#160; </p>  <p>Some of the requirements I had for the new site included:</p>  <ul>   <li>Minimal coding needed to get going (I already code enough on this engine) </li>    <li>Theming support with publically available themes (I’m terrible at art) </li>    <li>Support for multiple authors (my wife wants to be able to post as well) </li>    <li>A decent web based post editor      <ul>       <li>Back when I started with <a title="Veritas Blogging Engine" href="http://chrisrisner.com/Category/Veritas">Veritas</a>, the options for web based HTML editors that you could embed was pretty weak (the one I had been using produced really poor HTML / CSS).&#160; I know this is something that has gotten better and I’d like to not be tied to Windows Live Writer like I am with this site. </li>     </ul>   </li>    <li>Good URL SEO (I don’t want URLs to contain a year and a month and a blood type) </li>    <li>Rich plug-in support (this goes back to me not wanting to code a lot) </li>    <li>Mobile support (this was a stretch but being able to admin the site from my phone would be nice) </li>    <li>Custom domain support </li>    <li>Runs on Azure (why would I put it anywhere else?) </li> </ul>  <p>After figuring out what I wanted and taking a look at all of the suggested solutions, and a few others, I came down to one winner.&#160; Before we get to the winner, let’s talk about the non-winners.</p>  <ul>   <li>GitHub Pages      <ul>       <li>This is essentially free web hosting inside of your GitHub repo.&#160; You can create a page for your organization and / or for a specific project.&#160; Additionally you can do custom domains.&#160; Where this appears to fall apart is the theming, plug-ins, and more advanced features.&#160; I know a lot of people using GitHub pages and think they’re great for things that are either more simple or if you have more resources (i.e. a designer) but I have neither. </li>     </ul>   </li>    <li>Tumblr      <ul>       <li>I probably spent the least time evaluating Tubmlr but it didn’t seem to fit my needs based off of what I’ve seen whenever I view someone else’s Tubmlr site. </li>     </ul>   </li>    <li>Squarespace      <ul>       <li>This is a newer service that I had not heard of before.&#160; They have some really great templates to select from but it really seems more intended for either a company’s site or maybe a celebrity’s.&#160; I’m neither and the real nail in the coffin is that they charge.&#160; They were kind enough to tweet back to my above mentioned message and say there is a free trial but I’m not interested in paying for the site today. </li>     </ul>   </li>    <li>Jeykll      <ul>       <li>Jeykll is a static-site generator that is written in Ruby and is used for many blogs including my friend Justin’s site, <a title="Carpeaqua" href="http://carpeaqua.com/">Carpeaqua</a>.&#160; Additionally this plugs into GitHub Pages for free hosting.&#160; This gets into some of the same issues with GitHub Pages.&#160; I don’t want to deal with the code or CSS or figuring that stuff out. </li>     </ul>   </li>    <li>Ghost      <ul>       <li>Ghost is another new blogging platform that seems to be getting a lot of attention as of late.&#160; There are lots of themes available, you can easily deploy a Ghost blog to Microsoft Azure, it’s used on some heavily visited sites, and is gaining in popularity.&#160; Unfortunately it’s still new so plug-in support and extensibility might be an issue.&#160; I could probably extend anything not there myself but, (are you sensing a recurring theme) I don’t really want to deal with the code. </li>     </ul>   </li> </ul>  <p><strong>WordPress</strong></p>  <p>At the end of the day, WordPress ended up being the winner.&#160; I’ve played with WordPress before but it’s been a few years since I looked at it in any depth.&#160; Some of the factors that lead to WordPress’s winning (aside for everything else not winning) included:</p>  <ul>   <li>Completely open source.&#160; This is a solution that can be hosted anywhere including… </li>    <li>Super easy deployment to Azure.&#160; WordPress is in the Azure Web Sites gallery so you can deploy a new WordPress blog on Azure in a couple minutes. </li>    <li>Multiple author support </li>    <li>Mobile app support (even if the site isn’t running on wordpress.com). </li>    <li>Themes (tons of themes as well as info on customizing those themes). </li>    <li>Custom domain support (which Azure also supports (outside of free mode)). </li>    <li>URL SEO options </li>    <li>Plug-ins.&#160; There are tons and tons of plug-ins. </li>    <li>A good web-based HTML editor (in addition to an editor in the mobile app). </li> </ul>  <p><strong>Deploying WordPress on Azure</strong></p>  <p>Once you’ve signed up for a <a title="Free Azure Trial" href="http://www.windowsazure.com/en-us/pricing/free-trial/?WT.mc_id=A3F51C28C">FREE Azure account</a>, it really is super fast deploying WordPress.&#160; After logging into the <a title="Azure Management" href="https://manage.windowsazure.com">Azure Portal</a>, click the New button at the bottom left.&#160; Under <strong>Compute</strong>, select <strong>WEB SITE</strong>, and then <strong>FROM GALLERY</strong>.&#160; A new window will appear with all of the different options for web site apps that you can deploy.&#160; At the bottom you’ll find WordPress.&#160; You’ll next get to the Configure page where you can specify the URL of your site, what database to use (more on this soon), and a bunch of deployment settings (Auth key, Secure Auth Key, Logged In Key, etc):</p>  <p><img title="Wordpress Azure Configuration" style="float: none; margin-left: auto; display: block; margin-right: auto" src="https://crcomcstorage.blob.core.windows.net/images/wordpress-azure-configure.jpg" width="452" height="422" /></p>  <p>To fill all of the deployment settings, it’s useful to use <a title="WordPress&#39;s SALT Generator" href="https://api.wordpress.org/secret-key/1.1/salt/">WordPress.com’s provided value generator</a>.&#160; The last step before deployment is to create a new database or select an existing database.&#160; We’ll talk more about that shortly.&#160; After that the deployment starts.&#160; After a minute, you can then browse to the site and complete WordPress’s initial configuration.&#160; From there, you’re done.&#160; You can do any theming you want or add any additional plug-ins or just start blogging.</p>  <p><strong>The MYSQL Database</strong></p>  <p>Out of the box, WordPress relies on MySQL for it’s data storage.&#160; Microsoft Azure doesn’t provide MySQL like it provides SQL Database (based off of MS SQL Server) but relies upon a partner, <a title="ClearDB" href="http://www.cleardb.com/">ClearDB</a>, to provide MySQL databases on Azure.&#160; From a developer perspective, this is all abstracted away from you when you generate your WordPress blog.&#160; A MySQL DB is generated that is running in Azure and is tied to your WordPress site.&#160; However, when you are looking at cost and size of the DB, this system becomes a bit more of an issue.&#160; ClearDB has their own <a title="ClearDB pricing for Azure" href="https://www.cleardb.com/store/azure">pricing</a> for your MySQL databases running on Azure.&#160; The one generated when you create your first WordPress site is free and will continue to be free up to 20 MB.&#160; When you want to go above that, the first plan (up to 1 GB a month) is $9.99.&#160; That’s more than I want to pay.&#160; Additionally, I don’t like having complete control over my database.&#160; </p>  <p><strong>Other Options</strong></p>  <p>I still wanted to stick with WordPress on Azure, but I wanted another option for my database.&#160; The first thing I stumbled upon was this <a title="WordPress using Azure SQL" href="http://blogs.msdn.com/b/africaapps/archive/2013/07/30/using-wordpress-on-windows-azure-with-sql-server-instead-of-mysql.aspx">post</a> on connecting WordPress on Azure to SQL Server instead of MySQL.&#160; This seemed great.&#160; I’m already using a SQL Database in Azure for this site.&#160; All I would need to do is generate a new database on my server and point my WordPress site to it (after porting the data / schema).&#160; I was pretty excited about how easy that sounded but, not being super comfortable with WordPress or the underlying PHP code, I wanted to ask someone that knew these things a bit better first.&#160; Thankfully, <a title="Cory&#39;s site" href="http://blog.syntaxc4.net/">Cory Fowler</a>, is super knowledgeable at all of these things.&#160; Cory let me know that while it would indeed work, the issue was that while the WordPress code itself would work fine with SQL, any plug-ins would potentially have to be tested or recoded to work with SQL.&#160; This strongly violated my “I don’t want to code a lot” requirement.&#160; Thankfully there was another option: running MySQL on a VM!</p>  <p><strong>MySQL on a VM</strong></p>  <p>I’m far from an IT admin, but I’ve worked enough with Windows Server and Windows to be comfortable moving around it.&#160; This meant that my fear of dealing with a Virtual Machine was low.&#160; I quickly found this <a title="Installing MySQL on a VM running in Azure" href="http://azure.microsoft.com/en-us/documentation/articles/virtual-machines-mysql-windows-server-2008r2/">guide on Installing MySQL on a Virtual Machine Running Windows Server 2008 R2 in Azure</a>.&#160; I choose to use Windows Server 2012 instead of 2008 but it was very easy to go from this guide to 2012 without much work.&#160; I had already setup my WordPress site and didn’t want to reconfigure it, so I really needed to get a backup of my ClearDB database and restore that to my MySQL server in the VM.&#160; To do so, I first downloaded the <a title="MySQL Workbench" href="http://www.mysql.com/products/workbench/">MySQL Workbench tool</a>.&#160; You can write all of the queries yourself but Workbench makes it much easier.&#160; Next, go to the Azure portal and navigate to your WordPress site’s <strong>Linked Resources </strong>tab.&#160; Clicking on the name of your database will take you to the ClearDB portal.&#160; Here you can click on the <strong>Endpoint Information </strong>tab:</p>  <p><img title="ClearDB MySQL Connection Info" style="float: none; margin-left: auto; display: block; margin-right: auto" src="https://crcomcstorage.blob.core.windows.net/images/cleardb-mysql-db-config.jpg" width="298" height="289" /></p>  <p>Take this information and open MySQL Workbench.&#160; From the home screen, you should see <strong>Server Administration</strong> on the right side.&#160; Select <strong>New Server Instance </strong>below that.&#160; Enter the <strong>Hostname</strong> from above into the <strong>Remote Host Address</strong> in Workbench and click Continue.&#160; At the next screen, copy over the <strong>Username </strong>and click Continue.&#160; After finishing the wizard, double click the new instance and you should be taken to an Admin page.&#160; Select <strong>Data Export</strong> from the left side, select your database, ensure all tables are checked, select a place for the output file and start the export:</p>  <p><img title="MySQL Workbench Export" style="float: none; margin-left: auto; display: block; margin-right: auto" src="https://crcomcstorage.blob.core.windows.net/images/mysql-workbench-export.jpg" width="735" height="423" /></p>  <p>Once the export is complete.&#160; You can go back to the home screen and add the MySQL server on your VM as a new instance.&#160; After getting to the admin screen for your new MySQL server, go to the <strong>Data Import / Restore </strong>section and import from the local file you generated with the export.&#160; Start the import and your new DB will be available.&#160; </p>  <p><strong>Changing the WordPress Config</strong></p>  <p>The last change you have to make is to the WordPress source code.&#160; The easiest way I’ve found to do this is to return to your site in the Azure portal and go to the <strong>Dashboard</strong> tab.&#160; On the right hand side under <strong>QUICK GLANCE</strong>, you should see an <strong>FTP Host Name</strong> link.&#160; Open this link in FTP and use the <strong>DEPLOYMENT/FTP_USER</strong> username and the password you’ve set up (you should see a link to set or reset your credentials if you don’t have them) to connect.&#160; Once you’ve connected, open the <strong>site</strong> directory and then <strong>wwwroot</strong>.&#160; You’ll want to pull down the <strong>wp-config.php</strong> file.&#160; Once you do, open that file and enter the correct values in the <strong>db_name</strong>, <strong>db_user</strong>, <strong>db_password</strong>, and <strong>db_host</strong>.&#160; Save these changes and copy the file back to your site via FTP and that’s it, you’re done.</p>  <p><strong>Summary</strong></p>  <p>It’s amazingly easy to get WordPress running in Microsoft Azure via the Web Sites gallery and ClearDB’s MySQL service.&#160; Today we’ve seen that if you really want as much control as possible, you can roll your own MySQL server in a virtual machine running on Azure.&#160; I should add that this VM usage isn’t free (not like the free 20 MB ClearDB MySQL server).&#160; That said, with the low usage I’m expecting for the site I’m running on a super small VM which even with the additional cost of storage, is a bit over $10 / month.&#160; I’ve scaled the site up (it’s on the same hosting plan as this site) so there’s a separate cost for that, but at the end of the day, I’m paying very little for a super reliable site.&#160; That’s all there is to it, you can check out the new blog at <a title="Sailing Makai" href="http://sailingmakai.com/">SailingMakai.com</a>.</p>