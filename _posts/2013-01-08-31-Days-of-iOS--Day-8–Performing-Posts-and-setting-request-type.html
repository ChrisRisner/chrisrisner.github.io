---
layout: post
title: "31 Days of iOS: Day 8–Performing Posts and Setting Request Type"
date: Tue Jan 08 2013 07:49:00 GMT-0800 (PST)
comments: true
status: publish
type: post
published: true
categories: [Mobile, Objective-C, iOS, XCode]
excerpt: "In day 8 of the 31 Days of iOS we expand our coverage of making http requests from an iOS application.  This article reviews how to move from a GET request to a POST and how to change the request type, pass data, and set other properties on a web request."
logoUrl: null
keywords: iOS,31 days of iOS,Apple,Apple iOS,Network request,NSURLConnection,NSUrlRequest,synchronous,asynchronous,NSURLRequest,NSURLConnection,NSMutableURLRequest,setHttpBody,How to develop iOS,iOS intro,iOS Introduction,iOS Tutorial,iOS for Beginners,Beginners,walkthrough
filepath: 2013-01-08-31-Days-of-iOS--Day-8–Performing-Posts-and-setting-request-type.html
disqus_identifier: 31-Days-of-iOS--Day-8–Performing-Posts-and-setting-request-type
---
<p align="left"><img style="margin: 0px 0px 5px 5px; display: inline; float: right" align="right" src="http://chrisrisner.com/upload/200px-Apple-logo.png" width="170" height="208" />Welcome to Day 8 in the <a title="31 Days of iOS" href="http://chrisrisner.com/31-Days-of-iOS">31 Days of iOS</a>.&#160; In <a title="Day 7: Making Network Requests" href="http://chrisrisner.com/31-Days-of-iOS--Day-7%E2%80%93Making-Network-Requests">yesterday’s article</a>, we discussed how to perform network requests using the <strong>NSURLRequest </strong>and <strong>NSURLConnection </strong>classes.&#160; We showed two different methods of making these requests: one of which required us to implement several delegate methods and the other made use of a new technique called a <strong>block</strong>.&#160; Today we’re going to continue where we left off and talk about how to change from doing a GET request to doing a POST request.&#160; We’ll also look at how to change the content type and post JSON data.&#160; You can start out with the <a title="Day 7 Source Code" href="https://crcomcstorage.blob.core.windows.net/codesamples/Day7.zip">code we finished up with yesterday</a> or, if you’d like to follow along with the completed code, you can <a title="iOS Day 8 Source Code" href="https://crcomcstorage.blob.core.windows.net/codesamples/iOSDayEight.zip">access it here</a>.</p>  <p align="left"><strong>Changing the HTTP Method</strong></p>  <p align="left">In order to make any modifications to the request we’re sending to the server (including changing the HTTP method from GET to POST, posting data, or changing the content type of the data being posted, we need to change the type of request we’re using.&#160; Previously we were initializing a <strong>NSURLRequest</strong>, but like other <strong>NS* </strong>objects that aren’t <strong>NSMutable* </strong>objects, these objects aren’t mutable and therefore can’t be changed.&#160; To fix this, we can convert our <strong>NSURLRequest </strong>to a <strong>NSMutableURLRequest</strong>.&#160; This will allow us to change properties after the request has been initialized.&#160; The first method we’re going to use on our <strong>NSMutableURLRequest </strong>is <strong>setHTTPMethod</strong>.&#160; This allows us to change the HTTP method:</p>  <p align="left"><script src="https://gist.github.com/3921647.js?file=fetchdata1.m"></script></p>  <p align="left">When we run the app now, nothing will be different from yesterday.&#160; This is because the web page we’re posting to is capable of handling both GET and POST requests.&#160; Frequently you’ll find that&#160; when you need to post data to a web service, a GET request will not work at all.&#160; </p>  <p align="left"><strong>Posting data</strong></p>  <p align="left">In order to post data, we’ll use another method on the <strong>NSMutableURLRequest </strong>object: <strong>setHTTPBody</strong>.&#160; However, before we can call that method, we need to get the post values into a format we can use.&#160; Specifically we need either <strong>NSData</strong> or <strong>NSMutableData</strong>.&#160; We can create one of those objects by taking a <strong>NSString</strong> and calling it’s <strong>dataUsingEncoding</strong> method:</p>  <p align="left"><script src="https://gist.github.com/3921647.js?file=fetchdata2.m"></script></p>  <p align="left">Here we’re putting the value we want to post into a string where it’s being set to a post value named <strong>postedValue</strong>.&#160; We put that into a <strong>NSData </strong>object and then finally call <strong>setHTTPBody</strong>.&#160; Now when we run our app, we’ll see that the posted value is now showing up:</p>  <p align="center"><img title="Day 8 Posted Values" alt="Day 8 Posted Values" src="https://crcomcstorage.blob.core.windows.net/images/31iosday8-posted-value.jpg" /></p>  <p align="left">While that works, what we really want to do is figure out how to post JSON or XML.</p>  <p align="left"><strong>Changing the content type and posting JSON</strong></p>  <p>Posting either JSON or XML data ends up being very simple.&#160; We first change the HTTP method to POST as we did above.&#160; We then call another method which allows us to set the <strong>Content-Type </strong>header on the HTTP request.&#160; Sending JSON data is something that could be complicated and require us to pull down a third party library.&#160; Thankfully, with the release of iOS 5, Apple introduced the <strong>NSJSONSerialization</strong> class to help us with JSON.&#160; Let’s look at that now:</p>  <p><script src="https://gist.github.com/3921647.js?file=serializationOfJson.m"></script></p>  <p>First we need to generate a <strong>NSDictionary</strong> with the key-value pairs that will go in our JSON.&#160; We then use <strong>NSJSONSerialization</strong> to convert the <strong>NSDictionary </strong>into <strong>NSData</strong>.&#160; That object is then used to set the HTTP body of our request.&#160; Notice the use of the <strong>NSJSONWritingPrettyPrinted</strong> option.&#160; Using that causes the JSON that is generated to be “pretty” or contain whitespace.&#160; This is useful for debugging, however, it isn’t the most efficient way to send data over the wire.&#160; To get the most minimal JSON possible, this flag should be removed so unneeded whitespace isn’t generated.&#160; </p>  <p><strong>Conclusion</strong></p>  <p>Today we continued to look at how to perform network requests from iOS apps.&#160; Now we know how to do different HTTP requests as well as send data over the wire (in addition to as part of the query string).&#160; We also looked at how to send JSON data over the wire as that is a very common practice when communicating from mobile clients to web servers.&#160; The knowledge from these two posts should prepare you for doing just about any network communication.&#160; You can <a title="iOS Day 8 Source Code" href="https://crcomcstorage.blob.core.windows.net/codesamples/iOSDayEight.zip">access the finished source code from this article here</a>.</p>