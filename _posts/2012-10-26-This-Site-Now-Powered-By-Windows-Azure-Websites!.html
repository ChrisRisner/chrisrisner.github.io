---
layout: post
title: "This Site Now Powered By Windows Azure Websites!"
date: Fri Oct 26 2012 12:35:00 GMT-0700 (PDT)
comments: true
status: publish
type: post
published: true
categories: [Azure, Blogging, SQL, Veritas, Web]
excerpt: "This article talks about some of the challenges I faced moving my site to Windows Azure Websites.  As of now this site is now running from the cloud."
logoUrl: null
keywords: Windows Azure,Websites,Windows Azure Websites,Cloud,IIS,ASP .NET,Veritas,Running in the cloud
filepath: 2012-10-26-This-Site-Now-Powered-By-Windows-Azure-Websites!.html
disqus_identifier: This-Site-Now-Powered-By-Windows-Azure-Websites!
---
<p><img style="margin: 0px 0px 5px 5px; display: inline; float: right" align="right" src="https://crcomcstorage.blob.core.windows.net/images/windowsazurevertical.jpeg" width="249" height="107" />I’m extremely excited to announce that this site is now being hosted by Windows Azure Websites!&#160; Despite how easy it actually was to move my site over to Windows Azure, it’s taken me quite a long time due to how busy I’ve been with other things.&#160; I’m very happy to report that the site is loading faster and handling load much better now that it’s been moved to the cloud.&#160; I did run into a few issues moving over all of the code and content that I’d like to share in case anyone else out there runs into them.</p>  <p><strong>CNAME’s and a records</strong></p>  <p>With Windows Azure Websites, you get 10 free websites running in a multitenant virtual machine.&#160; This means that the server hosting your site(s) is also hosting other sites.&#160; One of the limitations of this is that you don’t get the option to use custom domain names.&#160; However, if you upgrade to either a <strong>Shared</strong> or <strong>Reserved </strong>instance (<a title="Windows Azure Pricing" href="https://www.windowsazure.com/en-us/pricing/calculator/">pricing information is here</a>), on top of getting upgraded specs (better quotas on CPU, memory, and network usage), you are able to set custom domain names.&#160; Changing from the free mode to either <strong>Shared </strong>or <strong>Reserved</strong> is super easy and can be done from your site’s <strong>Scale</strong> tab in the <a title="Windows Azure Portal" href="http://manage.windowsazure.com">Windows Azure Portal</a>:</p>  <p align="center"><img title="Changing Scale of a Windows Azure Website" alt="Changing Scale of a Windows Azure Website" src="https://crcomcstorage.blob.core.windows.net/images/running-on-azure-scale.jpg" width="523" height="218" /></p>  <p>All you have to do is tap whichever one you want.&#160; Once you’ve done that, you’ll be able to set custom domains from the <strong>Configure </strong>tab in the portal.&#160; The next step can be very easy depending on how your site is set up.&#160; If you’re not using a “naked domain” (meaning there is a “www.” or “blog.” before your domain) then all you need to do is add a CNAME record in your DNS settings to direct from <strong>www</strong> or <strong>blog</strong> (whatever your subdomain is) to <strong>sitename.azurewebsites.net</strong>.&#160; According to the custom domain documentation, you can also set up a CNAME record for <strong>awverify</strong> and have it redirect to <strong>awverify.sitename.azurewebsites.net</strong>.&#160; To be safe, I had done both in my DNS records:</p>  <p align="center"><img title="CNAME records" alt="CNAME records" src="https://crcomcstorage.blob.core.windows.net/images/running-on-azure-cnames.jpg" /></p>  <p>You’ll need to remove (or replace) any existing records that match the subdomains you’re using.&#160; Now, if your site was using a subdomain like <strong>www </strong>or <strong>blog</strong>, you could be fine and go back to the portal and add in your custom domain, however, if your site is using a “naked domain” like mine is (I redirect everything for <a href="http://www.chrisrisner.com">www.chrisrisner.com</a> to chrisrisner.com) you need to take one more step and add an <strong>a record</strong>.&#160; In order to do this, you first need to get the IP address you should point your <strong>a records </strong>at.&#160; Return to the portal and click on the <strong>Manage Domains</strong> button on the bottom of the screen (when in your site setup):</p>  <p align="center"><img title="Manage domains" alt="Manage domains" src="https://crcomcstorage.blob.core.windows.net/images/azure-manage-domain.jpg" /></p>  <p>In the modal that pops up, when you scroll to the bottom, you’ll see the IP address you should use:</p>  <p align="center"><img title="IP address for a record" alt="IP address for a record" src="https://crcomcstorage.blob.core.windows.net/images/azure-websites-custom-domain-ip-address.jpg" /></p>  <p>Once you have that, you can then add <strong>a records</strong> for your site:</p>  <p align="center"><img title="a records for site" alt="a records for site" src="https://crcomcstorage.blob.core.windows.net/images/running-on-azure-a-records.jpg" /></p>  <p>It’s important to note that your domain will likely already have these records in it’s DNS settings.&#160; You’ll need to alter the existing ones and use the new IP address.&#160; Now you can return to the portal and go to the <strong>Manage Domains</strong> button again and add your custom domains.&#160; Once you do this, it takes effect immediately.&#160; This meant that my site was not down at all (with the exception of a few minutes while I sorted out the next issue).</p>  <p><strong>Websites and connection strings</strong></p>  <p>One of the great things about Windows Azure Websites is the ability to set connection strings and app keys in the portal so you don’t have to put sensitive information in the web.config.&#160; It also allows you to make changes to these values on the fly from the portal instead of having to modify your web.config.&#160; To see and edit these, you’ll need to go into the <strong>Configure</strong> tab for your website in the portal.&#160; Scroll down and you should see<strong> app settings </strong>and <strong>connection strings</strong>:</p>  <p align="center"><img title="app settings and connection strings in azure portal" alt="app settings and connection strings in azure portal" src="https://crcomcstorage.blob.core.windows.net/images/azure-app-settings-connection-strings.jpg" width="610" height="219" /></p>  <p>My uses <a title="Entity Framework" href="http://msdn.microsoft.com/en-us/data/ef.aspx">Entity Framework</a> for the database connections so I have an Entity Framework connection string in my web.config.&#160; If you’ve never seen a SQL connection string and compared it to one for EF, they look a little different.&#160; Here’s a normal SQL connection string that you’d see in a web.config file:</p>  <blockquote>   <p>&lt;add name=&quot;ConnectionStringName&quot; providerName=&quot;System.Data.SqlClient&quot;     <br />&#160;&#160;&#160; connectionString=&quot;Server=myServerAddress;Database=myDataBase;User Id=myUsername;Password=myPassword;&quot; /&gt;</p> </blockquote>  <p>Now let’s look at one for EF:</p>  <blockquote>   <p>&lt;add name=&quot;ConnectionStringName&quot; providerName=&quot;System.Data.EntityClient&quot;     <br />connectionString=&quot;metadata=res://*/Models.Name.csdl|res://*/Models.Name.ssdl|res://*/Models.Name.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=qnc1dmpuuz.database.windows.net;Initial Catalog=databaseName;User Id=userName;Password=password;MultipleActiveResultSets=True&amp;quot;&quot; /&gt;</p> </blockquote>  <p>The actual <strong>connectionString</strong> attribute is quite different, however, this is not an issue when adding a connection string in the portal.&#160; There is a connection string type drop down and you can choose <strong>custom</strong> to enter the EF value:</p>  <p align="center"><img title="azure websites connection string types" alt="azure websites connection string types" src="https://crcomcstorage.blob.core.windows.net/images/azure-connection-string-types.jpg" width="616" height="176" /></p>  <p>However, there is an issue with the different <strong>providerName</strong> attribute.&#160; EF specifically looks for a connection string with a provider name of <strong>System.Data.EntityClient</strong>.&#160; However, if you add your EF string using the portal, it won’t have this provider type.&#160; This means that, as of right now you can’t put an EF connection string in the portal.&#160; The <a title="Issue with EF connection string in Windows Azure Website portal" href="http://social.msdn.microsoft.com/Forums/da-DK/windowsazurewebsitespreview/thread/4b598d5f-13ab-429b-9314-ca158e716b85">team is aware of this</a> though I’m not sure when a fix will be out.</p>  <p><strong>Moving files through GIT</strong></p>  <p>The second issue I ran into was with pushing all of my files up to Windows Azure Websites using GIT.&#160; The markup and code files for my site don’t actually rack up that much space, however, I am hosting a lot of image and archive files within my site’s folders (I’ve since started serving up files through <a title="Windows Azure Storage" href="https://www.windowsazure.com/en-us/home/features/data-management/">Windows Azure Storage</a>).&#160; When I tried to do the push, I received this error:</p>  <blockquote>   <p>Unable to rewind rpc post data - try increasing http.postBuffer     <br />error: RPC failed; result=65, HTTP code = 0      <br />fatal: The remote end hung up unexpectedly</p> </blockquote>  <p>The essence of the issue is that the buffer size being used to push the files was too small.&#160; I did some searching and found out how to increase the <strong>postBuffer</strong> value:</p>  <blockquote>   <pre><code>git config http.postBuffer 524288000</code></pre>
</blockquote>

<p>I still ended up with issues the push of all the data files would stall.&#160; To solve this, I only pushed a few files up to the server at a time.&#160; Another solution would have been to have moved these files using FTP, though, that would mean the files wouldn’t be in the GIT history for my site.</p>

<p><strong>Cloud Powered</strong></p>

<p>With the exception of those two issues, the move to Windows Azure Websites so seamless and super easy.&#160; Since I moved my site I’ve noticed a significant decrease in load times and less data throughput (since more and more of the images are being served up by Windows Azure Storage and not my website).&#160; Additionally, thanks to the ease of scaling Windows Azure Websites, if my site ever gets ridiculously busy, I can easily change the number of instances running my site (from the <strong>Scale</strong> tab) to support the increased load.</p>