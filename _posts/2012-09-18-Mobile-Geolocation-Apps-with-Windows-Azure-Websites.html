---
layout: post
title: "Mobile Geolocation Apps with Windows Azure Websites"
date: Tue Sep 18 2012 07:17:00 GMT-0700 (PDT)
comments: true
status: publish
type: post
published: true
categories: [Azure, Android, Mobile, Objective-C, Java, Open Source, PHP, iOS]
excerpt: "This article will summarize a backend and service sample showing how to connect iOS and Android applications to a PHP backend running in Windows Azure Websites.  The backend will host a few different services which enable us to make client side apps taking advantage of geospatial abilities including tagging a location with a picture or video. We'll store the files in Windows Azure Storage and securely upload them from the client using Shared Access Signatures and the PHP service."
logoUrl: null
keywords: Windows Azure,Mobile Backend,Web API,iOS,Android,Windows Azure and Mobile Clients,Mobile Clients,Windows Azure Toolkits,PHP,PHP on Azure,Tutorial,Walkthrough
filepath: 2012-09-18-Mobile-Geolocation-Apps-with-Windows-Azure-Websites.html
disqus_identifier: Mobile-Geolocation-Apps-with-Windows-Azure-Websites
---
<p><img style="margin: 0px 0px 5px 5px; display: inline; float: right" title="Windows Azure" alt="Windows Azure" align="right" src="http://chrisrisner.com/upload/windowsazurevertical.jpg" />As mentioned in my wrap up of the <a title="URL Shortener Mobile Client Wrap Up" href="http://chrisrisner.com/Windows-Azure-Websites-and-Mobile-Clients--Wrap-Up">URL Shortener with mobile clients</a>, I gave a presentation a little while ago at a DevCamp in London on connecting mobile clients to <a href="https://www.windowsazure.com/en-us/home/scenarios/web-sites/">Windows Azure Websites</a>.&#160; The last <a title="URL Shortener Series" href="http://chrisrisner.com/Windows-Azure-Websites-and-Mobile-Clients--Wrap-Up">series</a> went over how to implement the URL Shortener demo I went through during my presentation.&#160; Today, I’d like to start talking about the second demo which involved geolocation.&#160; In this demo, a mobile app loads up a map centered on the user’s current location.&#160; It then polls the server to see if there are any “points of interest” within a certain radius.&#160; If the server returns anything, pins are dropped on the map.&#160; When the user taps a pin, a popup appears with information on the point of interest, including a URL to the picture or video that was uploaded there.&#160; </p>  <p>Initially the mobile apps connected to a .NET service written using <a title="ASP .NET Web API" href="http://www.asp.net/web-api">Web API</a> by my teammate <a title="Nick Harris" href="http://www.nickharris.net/">Nick</a>.&#160; Prior to sharing this out to everyone, I wanted to rewrite this backend to make it a bit more usable by people developing on OSX or Linux.&#160; Happily I can say that I was successful in rewriting the service layer into PHP.&#160; Now, with a Windows Azure account (<a title="Windows Azure free trial" href="http://aka.ms/MobileGeolocationWithWindowsAzureWebsites">sign up for a free trial here</a>) you will be able to push out this site and use it as a backend with ease.&#160; </p>  <p>This series will be split into 5 different articles:</p>  <ol>   <li><a href="http://chrisrisner.com/Mobile-Geolocation-Apps-with-Windows-Azure-Websites-Part-1--The-PHP-Code">The PHP Service code</a> </li>    <li><a href="http://chrisrisner.com/Mobile-Geolocation-Apps-with-Windows-Azure-Websites-Part-2--Displaying-Points-of-Interest-in-iOS">Displaying the map and points of interest in iOS</a> </li>    <li><a href="http://chrisrisner.com/Mobile-Geolocation-Apps-with-Windows-Azure-Websites-Part-3--Adding-New-Points-of-Interest-in-iOS">Adding new points of interest in iOS</a> </li>    <li><a href="http://chrisrisner.com/Mobile-Geolocation-Apps-with-Windows-Azure-Websites-Part-4--Displaying-Points-of-Interest-in-Android">Displaying the map and points of interest in Android</a> </li>    <li><a href="http://chrisrisner.com/Mobile-Geolocation-Apps-with-Windows-Azure-Websites-Part-5--Adding-New-Points-of-Interest-in-Android">Adding new points of interest in Android</a> </li> </ol>  <p>In addition, I’m happy to say that all of the source code for these samples is available on GitHub under the Apache 2 license.&#160; You can find the Git repos for each of the samples here:</p>  <ul>   <li><a title="GitHub repo for PHP Service" href="https://github.com/WindowsAzure-Samples/Geolocation-PHP-Service">PHP Service</a> </li>    <li><a title="GitHub repo for iOS Client" href="https://github.com/WindowsAzure-Samples/Geolocation-iOS-Client">iOS Client</a> </li>    <li><a title="GitHub repo for Android Client" href="https://github.com/WindowsAzure-Samples/Geolocation-Android-Client">Android Client</a> </li> </ul>  <p><strong><font size="4">How it Works</font></strong></p>  <p>The service exposes three different methods to the clients.&#160; The first returns a JSON array of points of interest that are within a certain meter distance of a given latitude and longitude.&#160; This data is stored in a MySQL database which the PHP service connects to.&#160; In the first article for each client, we’ll focus on using this method to show these points on a map.&#160; The second and third methods are both used to upload a new point of interest (the focus of the second article for each client).&#160; We’re using <a title="Windows Azure Blob Storage" href="https://www.windowsazure.com/en-us/home/features/data-management/">Windows Azure Blob Storage</a> to store out photos and videos.&#160; Normally, in order to add new files to blob storage, you would need to have the account name and the key.&#160; However, if we put the account name and key in our mobile apps, someone could find them and then abuse our storage.&#160; So instead of using the account directly, our clients request a Shared Access Signature from the PHP service.&#160; When this happens, the PHP service (which DOES have the account name and key) talks to blob storage and says “I want to add a file named &lt;this&gt; and I want my window of uploading this file to expire X seconds from now”.&#160; That URL is returned to the clients.&#160; The client can then do an HTTP Post to that URL with the image or video data.&#160; When that completes successfully, we’ll use the third method to tell our PHP service that we’ve added a new point at X latitude and Y longitude with name Z and HTTP URL path Q.&#160; When the PHP service receives this data, it writes it to the MySQL database mentioned earlier and the next time we poll for points, our new point will come back.</p>  <p><strong><font size="4">Conclusion</font></strong></p>  <p>Hopefully this series will give you a good idea of how you can use <a title="Windows Azure Websites" href="https://www.windowsazure.com/en-us/home/scenarios/web-sites/">Windows Azure Websites</a> as a backend for your mobile applications that require geolocation to display information.</p>