---
layout: post
title: "31 Days of iOS: Day 29-Advertising with iAd"
date: Tue Jan 29 2013 08:57:00 GMT-0800 (PST)
comments: true
status: publish
type: post
published: true
categories: [Apple, Mobile, Objective-C, XCode, iOS]
excerpt: "Day 29 in the 31 Days of iOS talks about how to use advertisements in your applications.  Specifically, we'll go over adding iAd, Apples ad network, to your applications."
logoUrl: null
keywords: iOS,31 days of iOS,Apple,Apple iOS,iAd,Advertise,Advertising,AdBannerView,iAd Framework,AdBannerViewDelegate,,iOS Introduction,iOS Tutorial,iOS for Beginners,Beginners,walkthrough
filepath: 2013-01-29-31-Days-of-iOS--Day-29-Advertising-with-iAd.html
disqus_identifier: 31-Days-of-iOS--Day-29–Advertising-with-iAd
redirect_from:
  - /2013-01-29-31-Days-of-iOS--Day-29%E2%80%93Advertising-with-iAd/
  - /2013-01-29-31-Days-of-iOS--Day-29–Advertising-with-iAd/
  - /31-Days-of-iOS--Day-29–Advertising-with-iAd/
  - /31-Days-of-iOS--Day-29–Advertising-with-iAd
---
<p><img style="margin: 0px 0px 5px 5px; display: inline; float: right" align="right" src="http://chrisrisner.com/upload/200px-Apple-logo.png" width="170" height="208" />Welcome to Day 29 of the <a title="31 Days of iOS" href="http://chrisrisner.com/31-Days-of-iOS">31 Days of iOS</a>.&#160; <a title="Day 28: Activity Indicators" href="http://chrisrisner.com/31-Days-of-iOS--Day-28%E2%80%93Activity-Indicators">Yesterday</a>, we discuss a few different ways you can indicate to users that there is some background or network activity occurring with your application.&#160; Today, we’re going to talk about how to monitize your app with advertisements using <a title="iAd" href="https://developer.apple.com/iad/">iAd</a>.&#160; There are alternatives to iAd (such as <a title="adwhirl" href="https://www.adwhirl.com/">adwhirl</a>) but we’re going to focus on Apple’s own advertising implementation.&#160; When you use iAd, you’ll get 70% (as of posting) of the revenue generated from user clicks.&#160; We’ll be starting with a brand new project, but if you’d like to follow along with the completed code, you can <a href="http://storage.chrisrisner.com/codesamples/iOSDayTwentyNine.zip">access it here</a>.</p>  <p><strong>Creating our project and handling the UI</strong></p>  <p>Open up Xcode and choose <strong>File</strong>, <strong>New</strong>, <strong>Project</strong>.&#160; We’ll use a <strong>Single View Application</strong> and name it <strong>DayTwentyNine</strong>:</p>  <p align="center"><img title="Day 29 New project" alt="Day 29 New project" src="http://storage.chrisrisner.com/images/31iosday29-new-project.jpg" /></p>  <p>Now open the <strong>MainStoryboard.storyboard</strong> and drag a <strong>Ad BannerView</strong> from the UI element selector in the bottom right of Xcode onto the bottom of the view.&#160; When you’re done, it will look like this:</p>  <p align="center"><img title="Ad BannerView in Storyboard" alt="Ad BannerView in Storyboard" src="http://storage.chrisrisner.com/images/31iosday29-ad-bannerview-in-storyboard.jpg" /></p>  <p>While you are in the storyboard, open the <strong>Assistant Editor</strong> from the top right of Xcode and <strong>control + click and drag</strong> from the <strong>ADBannerView </strong>to your code behind to create a new outlet.&#160; Your code should now look like this:</p>  <p><script src="https://gist.github.com/4536746.js?file=ViewController1.h"></script></p>  <p>Now try running your app in the simulator.&#160; It’s going to crash right away and if you look in the debug console, you’ll see this error:</p>  <blockquote>   <p>'NSInvalidUnarchiveOperationException', reason: 'Could not instantiate class named ADBannerView'</p> </blockquote>  <p>We’ll solve this problem by adding the <strong>iAd framework</strong>.</p>  <p><strong>Adding the iAd Framework</strong></p>  <p>Click on your project in the <strong>Project Navigator </strong>to bring up your project and target properties.&#160; Click on the <strong>Build Phases </strong>tab and expand the <strong>Link Binary with Libraries</strong> section and then click the <strong>+</strong>:</p>  <p align="center"><img title="Linking binaries" alt="Linking binaries" src="http://storage.chrisrisner.com/images/31iosday29-add-binary.jpg" /></p>  <p>From that, select <strong>iAd.framework</strong> and click <strong>Add</strong>:</p>  <p align="center"><img title="iAd.framework" alt="iAd.framework" src="http://storage.chrisrisner.com/images/31iosday29-add-iad-framework.jpg" /></p>  <p>Now if you run your app, you’ll crash again, but with a different error.</p>  <blockquote>   <p>[AppDeveloper]: ADBannerView: Unhandled error (no delegate or delegate does not implement didFailToReceiveAdWithError:): Error Domain=ADErrorDomain Code=4 &quot;The operation couldn’t be completed. Application has iAd Network configuration error&quot; </p> </blockquote>  <p>and:</p>  <blockquote>   <p>[AppDeveloper]: ADBannerView: Unhandled error (no delegate or delegate does not implement didFailToReceiveAdWithError:): Error Domain=ADErrorDomain Code=5 &quot;The operation couldn’t be completed. Banner view is visible but does not have content&quot;</p> </blockquote>  <p>The reason we’re seeing the errors is that to use an <strong>Ad BannerView</strong> you must implement the <strong>ADBannerViewDelegate</strong>.</p>  <p><strong>Implementing the delegate</strong></p>  <p>Open the <strong>ViewController.h</strong> and add an import statement for <strong>iAd/iAd.h</strong>.&#160; Next make the class implement the <strong>ADBannerViewDelegate</strong>.&#160; Now your header file should match this:</p>  <p><script src="https://gist.github.com/4536746.js?file=ViewController2.h"></script></p>  <p>Now switch over to the <strong>ViewController.m</strong> file.&#160; First we need to set the banner’s delegate to be our View Controller:</p>  <p><script src="https://gist.github.com/4536746.js?file=viewDidLoad.m"></script></p>  <p>With that done, we can add the methods needed to actually implement the <strong>ADBannerViewDelegate</strong> protocol:</p>  <p><script src="https://gist.github.com/4536746.js?file=AdBannerViewDelegate1.m"></script></p>  <p>Now you can run your app successfully.</p>  <p><strong>Checking out the test ad</strong></p>  <p>When you run your app in the iPhone simulator, you’ll see a test ad appear at the bottom of the app:</p>  <p align="center"><img title="App with Test Ad showing up" alt="App with Test Ad showing up" src="http://storage.chrisrisner.com/images/31iosday29-ad-showing-up.jpg" /></p>  <p>If you tap on the ad, you’ll be taken to a full page version of the ad:</p>  <p align="center"><img title="Full Screen iAd" alt="Full Screen iAd" src="http://storage.chrisrisner.com/images/31iosday29-full-screen-iad.jpg" width="184" height="289" /></p>  <p>After that loads, you’ll see a multi-page ad for putting iAds into your app.&#160; Tap the <strong>X </strong>to return to the app so you can see the ad at the bottom again.&#160; Now if you rotate your simulator, you’ll see that the ad doesn’t quite look right:</p>  <p align="center"><img title="Lanscape ad screwed up" alt="Lanscape ad screwed up" src="http://storage.chrisrisner.com/images/31iosday29-landscape-messed-up.jpg" /></p>  <p>The ad is showing up properly sized, but there is some white space beneath it.&#160; Let’s fix this now.</p>  <p><strong>Handling rotation</strong></p>  <p>We’re going to need to do a little bit of code to handle the rotation of our ad.&#160; Open back up <strong>ViewController.m</strong>.&#160; We’re going to implement the <strong>viewDidLayoutSubviews</strong> method:</p>  <p><script src="https://gist.github.com/4536746.js?file=viewDidLayoutSubviews.m"></script></p>  <p>Here we’re checking to make sure the banner has been loaded by checking it’s <strong>bannerLoaded</strong> property.&#160; If it is loaded, we can then set the y coordinate of the <strong>banner</strong>’s <strong>frame</strong> to the size of the <strong>contentFrame</strong> (which we get from the <strong>view.bounds</strong>) and subtract the height of our banner.&#160; So when the iPhone simulator goes into landscape, it’s dimensions will&#160; be 480x300.&#160; So the y coordinate of the banner’s frame ends up being set to 268 (300 height of the frame – 32 height of the banner).&#160; Now when we run, we get a proper looking landscape banner:</p>  <p align="center"><img title="Landscape ad looking good" alt="Landscape ad looking good" src="http://storage.chrisrisner.com/images/31iosday29-landscape-good.jpg" /></p>  <p><strong>Why aren’t my ads showing up?</strong></p>  <p>If you’ve already ran your app a few times, you may notice that you’re not seeing an ad every once in a while.&#160; This is because when you’re in development mode and are testing (i.e. your app wasn’t installed from the store), Apple’s ad servers will sometimes deliver errors to your app. This is so that you can test correctly handling ads not being appropriately delivered to your app.&#160; You can test this out by putting a <strong>NSLog</strong> call in the <strong>bannerView: didFailToReceiveAdWithError</strong>.&#160; The idea being that if this occurs, you wouldn’t show the ad and would resize any other views, if necessary.&#160; </p>  <p><strong>Other Important Methods</strong></p>  <p>In order to quickly implement the <strong>ADBannerViewDelegate</strong> we added a few methods earlier but didn’t explain them.&#160; Let’s talk about them now.&#160; First we have <strong>bannerViewActionShouldBegin: willLeaveApplication</strong> which is called when the user taps an ad.&#160; This method can be used to override whether the action triggered by the ad should be performed.&#160; Where we’re returning <strong>YES</strong> no matter what right now, if you instead return <strong>NO</strong>, you’d never be taken to the full screen ad when tapping on the ad.&#160; Remember, though, that users will expect whatever action the ad does to occur when they tap it.&#160; Be careful when deciding not to proceed with the ad action.&#160; This method also receives a boolean parameter that indicates if the ad action is going to leave your application.&#160; If the ad is not going to leave the application (which it won’t right now) you should consider that an indicator that your user interface is going to be obscured.&#160; When that happens you should disable any sounds or animations.&#160; You should also pause any activities that require user input (such as in a video game).</p>  <p>If the ad does cover your user interface, when the user returns to your app then another method (we haven’t yet seen) is called.&#160; That method is <strong>bannerViewActionDidFinish</strong>.&#160; This method is also called if the user does something inside the advertisement that causes them to leave your application.&#160; So you should return quickly from this method (remember, your app could be getting backgrounded).&#160; You should also not think of this as a method to “unpause” your application.</p>  <p>The <strong>bannerViewDidLoadAd</strong> method is called when an ad is ready to be displayed.&#160; In our app, if you put a log statement or a breakpoint in this method, you will have to pay attention to see it, but the ad will actually show up in the simulator before this method is called.&#160; However, this method will be called on your banner ad even if it isn’t part of the current view hierarchy.&#160; You can use this to hide the ad until it’s been loaded and then display or animate it in.&#160; </p>  <p><strong>Full-Screen Ads for iPads</strong></p>  <p>Full-screen advertisements were made available in iOS 4.3 and are specific to the iPad platform.&#160; We wont talk about these ad types today but you can <a title="Full-screen iPad Ad Documentation" href="https://developer.apple.com/library/ios/#documentation/UserExperience/Conceptual/iAd_Guide/Full-ScreenAdvertisements/Full-ScreenAdvertisements.html#//apple_ref/doc/uid/TP40009881-CH5-SW1">read more about full-screen ads in the Apple documentation</a>.</p>  <p><strong>Enabling ads for app launch</strong></p>  <p>When you’re ready to launch your app to the App Store, you need to log into <a title="iTunes Connect" href="https://itunesconnect.apple.com">iTunes Connect</a>.&#160; After logging in, click on the <strong>Manage Your Applications </strong>link on the right side, then select the app you are launching.&#160; There is then a button to <strong>Set Up iAd Network</strong>.&#160; <a title="Signing up for iAds" href="http://developer.apple.com/library/mac/#documentation/LanguagesUtilities/Conceptual/iTunesConnect_Guide/16_iAdNetwork/iAdNetwork.html">This documentation</a> will walk you through the rest of the process of signing up for iAds.&#160; Essentially you need to agree to a contract (unless you’ve already done so) and then select an age rating for the ads that will be delivered to your app (essentially, will children use your app or not).&#160; After that, you’re done and you’re app, when installed from the App Store, will feature ads.</p>  <p><strong>Best practices from Apple</strong></p>  <p>Apple includes a few best practices in your application which I’ll explain here.</p>  <p>First, don’t create a banner view unless you plan on displaying it.&#160; Once you’ve created your banner view, ads start being cycled through it.&#160; If those ads aren’t actually being displayed, the ones available will be depleted.</p>  <p>Along the lines of the last tip, if your user navigates away from the screen with the banner view on it, set the delegate to nil and stop displaying ads so you’re not continuing to cycle through ads.</p>  <p>It can take a while to go from creating a banner view to having an ad ready to display.&#160; For that reason, you shouldn’t try to show a banner on a screen that is only visible for a short period of time (like a splash screen on launch).&#160; However, if you do want to do this on short lived screens, you should create a single banner view and use the same one throughout your application.&#160; You can read more about how to do this sort of thing with <a title="Singletons" href="http://chrisrisner.com/31-Days-of-iOS--Day-10%E2%80%93Singletons-and-the-AppDelegate">singletons here</a>.</p>  <p>If your app features a rich media experience (such as video), iAd will consume additional memory to display the ad to the user.&#160; This means other areas of your application may need to be released to increase the amount of memory available.&#160; Plan accordingly.</p>  <p><strong>Conclusion</strong></p>  <p>Today we took a look at how to use advertisements in your app with iAd.&#160; Remember that iAd isn’t the only option (unless Apple decides to not certify apps using other ad providers).&#160; Ads are a great way to monetize your application.&#160; Many developers will release a free version of their app which features ads and then a paid version that doesn’t use ads.&#160; Fortunately, its very simple to put iAd into your applications.  You can download the completed source code from this sample <a href="http://storage.chrisrisner.com/codesamples/iOSDayTwentyNine.zip">here</a>.</p>