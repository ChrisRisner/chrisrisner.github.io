---
layout: post
title: "Announcing Notification Hubs General Availability"
date: Fri Aug 23 2013 13:50:00 GMT-0700 (PDT)
comments: true
status: publish
type: post
published: true
categories: [Android, Azure, Mobile Services, Objective-C, Java, iOS]
excerpt: "This article talks about the recent release of Windows Azure Notification Hubs.  Notification Hubs is a service that can be used to do broadcast style push notifications to mobile applications with ease.  Notification Hubs currently has support for Android, iOS, Windows Phone, and Windows Store apps."
logoUrl: null
keywords: azure,windows azure,notification hubs,push notifications,apns,gcm,wns,mpns,push,broadcast
filepath: 2013-08-23-Announcing-Notification-Hubs-General-Availability.html
disqus_identifier: Announcing-Notification-Hubs-General-Availability
---
<p><img style="float: right; margin: 0px 0px 5px 5px; display: inline" align="right" src="http://storage.chrisrisner.com/images/logo_notification_hubs.jpg" width="146" height="143" />Last week we announced that <a title="Notification Hubs" href="http://www.windowsazure.com/en-us/documentation/services/notification-hubs/">Notification Hubs</a> had reached General Availability (GA).&#160; GA means that if you had any doubts before about the production ready-ness of the service, you can stop worrying and start using!&#160; Notification Hubs enables you to deliver broadcast push notifications to Android, iOS, Windows 8, and Windows Phone applications with ease.&#160; </p>  <p><strong>Notification Hubs vs Mobile Services for Push Notifications</strong></p>  <p>If you’ve been paying attention to Windows Azure over the past year, you’ll know that we also have a great service called <a title="Mobile Services" href="http://windowsazure.com/mobile">Mobile Services</a>.&#160; Mobile Services is a great Backend-as-a-Service offering that offers lots of great features for anyone building a mobile application (whether it’s Android, iOS, Windows, or Windows Phone).&#160; One of these features is push notifications to all of those platforms using APNS, GCM, MPNS, and WNS.&#160; The obvious question one would have knowing that Mobile Services supports push notifications and that Notifications Hubs do as well is when should I use which?&#160; Thankfully I have a pretty handy table which will help you understand things:</p>  <blockquote>   <table cellspacing="0" cellpadding="2" width="630" border="0"><tbody>       <tr>         <td valign="top" width="286">&#160;</td>          <td valign="top" width="164">           <p align="center">Mobile Services</p>         </td>          <td valign="top" width="178">           <p align="center">Notification Hubs</p>         </td>       </tr>        <tr>         <td valign="top" width="286">           <p align="center">APNS, GCM, MPNS, WNS</p>         </td>          <td valign="top" width="164">           <p align="center">Yes</p>         </td>          <td valign="top" width="178">           <p align="center">Yes</p>         </td>       </tr>        <tr>         <td valign="top" width="286">           <p align="center">Turnkey event-triggered push</p>         </td>          <td valign="top" width="164">           <p align="center">Yes</p>         </td>          <td valign="top" width="178">           <p align="center">No</p>         </td>       </tr>        <tr>         <td valign="top" width="286">           <p align="center">Device registration management</p>         </td>          <td valign="top" width="164">           <p align="center">No</p>         </td>          <td valign="top" width="178">           <p align="center">Yes</p>         </td>       </tr>        <tr>         <td valign="top" width="286">           <p align="center">Interest tags for routing messages to a subset of users</p>         </td>          <td valign="top" width="164">           <p align="center">No</p>         </td>          <td valign="top" width="178">           <p align="center">Yes</p>         </td>       </tr>        <tr>         <td valign="top" width="286">           <p align="center">Templates for formatting messages to user preferences including language</p>         </td>          <td valign="top" width="164">           <p align="center">No</p>         </td>          <td valign="top" width="178">           <p align="center">Yes</p>         </td>       </tr>        <tr>         <td valign="top" width="286">           <p align="center">Broadcast to &gt;= 1 million devices at once within minutes</p>         </td>          <td valign="top" width="164">           <p align="center">No</p>         </td>          <td valign="top" width="178">           <p align="center">Yes</p>         </td>       </tr>     </tbody></table> </blockquote>  <p>In short, if you want to do an event-triggered push notification, Mobile Services can handle this very easily.&#160; If you want to trigger push notifications to a large group of users, Notification Hubs will handle things better.&#160; It’s entirely possible for there to be overlap (you <em>could</em> trigger a push to an individual device or user with Notification Hubs and you <em>could</em> push to many users with a Mobile Service) but in general, they each have a scenario they are better for.&#160; What’s great is that there is nothing to stop you from using both with your applications.&#160; I’m working on a sample right now that uses Mobile Services to trigger a push when one user sends a message to another but uses Notification Hubs when I want to deliver a message to all of the users (to let them know there is a new version of the app for example).&#160; </p>  <p><strong>Subscribing to Notification Hubs</strong></p>  <p>Subscribing to a Notification Hub is very easy work no matter which platform you’re working with (well, in the case of APNS, you do need to sort out the certificate / App ID stuff first).&#160; If you haven’t set up push notifications on whichever platform you’re working with, I would recommend taking a look at the extensive walkthrough provided for each platform here:</p>  <ul>   <li><a title="Notification Hubs and Android" href="http://www.windowsazure.com/en-us/manage/services/notification-hubs/get-started-notification-hubs-android/">Android</a> </li>    <li><a title="Notification Hubs and iOS" href="http://www.windowsazure.com/en-us/manage/services/notification-hubs/get-started-notification-hubs-ios/">iOS</a> </li>    <li><a title="Notification Hubs and Windows Phone" href="http://www.windowsazure.com/en-us/manage/services/notification-hubs/get-started-notification-hubs-wp8/">Windows Phone</a> </li>    <li><a title="Notification Hubs and Windows Store" href="http://www.windowsazure.com/en-us/manage/services/notification-hubs/getting-started-windows-dotnet/">Windows Store</a> </li> </ul>  <p>Because the steps required just to set up push notifications for each platform don’t really have to do with Notification Hubs, I would look at those tutorials if you aren’t familiar with how to get an API Key for GCM, a push cert for APNS, or a client secret and package SID for WNS.&#160; Provided you already know how to deal with those steps, I’ll detail the actual code involved with subscribing to a hub.</p>  <p><strong>Subscribing from Android</strong></p>  <p>After you’ve created a Notification Hub in the Windows Azure portal and put your API key into it’s configuration settings, the next step is to do the work on your client side.&#160; First, make sure you’ve installed the <strong>Google Cloud Messaging for Android Library </strong>and <strong>Google Play services </strong>using the <strong>Android SDK Manager</strong>.&#160; This library shows up under the <strong>Extras</strong> folder as opposed to under a specific API level.&#160; Once that is installed, copy the <strong>gcm.jar</strong> file from <strong>/your-android-sdk-directory/extras/google/gcm/gcm-client/dist/</strong> and place it in your project’s<strong> libs </strong>folder.&#160; You’ll then need to copy <strong>google-play-service.jar </strong>from <strong>/android-sdk-directory/extras/google/googleplayservices/libproject/google-play-services_lib/libs </strong>into your <strong>libs </strong>folder.&#160; Also, remember that when testing this, your emulator (or device) must be running with Google APIs.&#160; Otherwise it can’t work with GCM.&#160; The last library we will need is the Notification Hubs Android SDK which you can download from <a title="Android Notification Hubs SDK" href="https://go.microsoft.com/fwLink/?LinkID=280126&amp;clcid=0x409">here</a>.&#160; After downloading, open the zip and copy the <strong>notification-hubs-sdk.jar</strong> over to your <strong>libs </strong>directory.</p>  <p>Once that is done, open your project’s <strong>AndroidManifest.xml</strong> file.&#160; You’ll need to add the following inside of the <strong>manifest</strong> element:</p>  <p><script src="https://gist.github.com/ChrisRisner/6321731.js?file=android-manifest-one.xml"></script></p>  <p>Make sure you replace the <strong>&lt;your package&gt;</strong> with the name of your app’s package (just look up in the <strong>manifest </strong>attributes to find it).&#160; With that done, hop over to whatever activity runs when your app launches.&#160; This is where we are going to start the registration process for Push Notifications.&#160; Add the following private variables to your activity class:</p>  <p><script src="https://gist.github.com/ChrisRisner/6321731.js?file=android-private-vars.java"></script></p>  <p>Make sure you replace the <strong>&lt;Project ID from Google API Console&gt;</strong> with your project ID.&#160; You can get this by going to the Google API Console and selecting your project from the drop down in the top left.&#160; Your project will then be in the URL (in the address bar) next to <strong>project:</strong>.&#160; Next go to your activity’s <strong>onCreate </strong>method and add the following:</p>  <p><script src="https://gist.github.com/ChrisRisner/6321731.js?file=android-hub.java"></script></p>  <p>Here you’ll need to enter the name of the notification hub where you see <strong>&lt;Notification Hub Name&gt;</strong> and the <strong>DefaultListenSharedAccessSignature </strong>where you see <strong>&lt;Notification Hub Listen Access Connection String&gt;</strong>.&#160; You can get this connection string by going into the Windows Azure portal and going into your Notification Hub (your Notification Hub will be under the Service Bus area on the left side of the portal).&#160; Then click on the <strong>Dashboard</strong> link for your hub.&#160; At the bottom of the next screen will be a button with a key that says <strong>Connection Information</strong>.&#160; Click that and you’ll see the two connection strings you’ll need (the one you need now is the <strong>Listen</strong> signature, later we’ll use the <strong>Full</strong> one):</p>  <p align="center"><img title="Notification Hub Signatures" alt="Notification Hub Signatures" src="http://storage.chrisrisner.com/images/notification-hubs-signatures.jpg" /></p>  <p>After you’ve copied and replaced those values, you can then add the <strong>registerWithNotificationHubs</strong> method:</p>  <p><script src="https://gist.github.com/ChrisRisner/6321731.js?file=android-register.java"></script></p>  <p>This method will start up a background task that will first register with GCM.&#160; When GCM get’s back to our application with a <strong>RegistrationId</strong> (which is how GCM identifies our device and app) we can then send it up to our hub by calling <strong>hub.register(regid)</strong>.&#160; The last step we need to handle on the client side is specify what should handle the notifications sent to our app.&#160; To handle this, let’s first go to the Manifest file and drop this xml in beneath the Activity but in the Application element:</p>  <p><script src="https://gist.github.com/ChrisRisner/6321731.js?file=android-manifest-two.xml"></script></p>  <p>Again, make sure you replace the <strong>&lt;Package Name&gt;</strong> with the package of your app.&#160; This xml basically tells Android that when we receive a push notification, the <strong>MyBroadcastReceiver </strong>method should handle it.&#160; Now add a new class to your source code named <strong>MyBroadcastReceiver</strong>.&#160; Make it’s superclass <strong>android.content.BroadcastReceiver</strong>.&#160; Now we implement it’s <strong>onReceive</strong> method to handle displaying a notification to the user:</p>  <p><script src="https://gist.github.com/ChrisRisner/6321731.js?file=android-receive.java"></script></p>  <p>Here, depending on what is received, we call the <strong>sendNotification</strong> method with a specific message.&#160; The <strong>sendNotification </strong>method then handles displaying a toast notification to the user.&#160; Now we’re ready to register for and receive push notifications from our hub.&#160; Before we talk about how to deliver them.&#160; Let’s take a quick look at registering with your hub on iOS.</p>  <p><strong>Subscribing from iOS</strong></p>  <p>Setting up push notifications for iOS is both easier and harder than Android.&#160; Within our app, there is less code we need to do.&#160; However, the steps involved in creating an App ID, a push certificate, a provisioning profile, etc are fairly complex.&#160; If you haven’t done it before, I highly recommend going through the full documentation found <a title="Full documentation on iOS and Notification Hubs" href="http://www.windowsazure.com/en-us/manage/services/notification-hubs/get-started-notification-hubs-ios/">here</a>.&#160; Once you’ve done that, start by downloading the Mobile Services iOS SDK <a title="Mobile Services iOS SDK" href="http://go.microsoft.com/fwlink/?linkid=266533&amp;clcid=0x409">here</a>.&#160; This zip contains both the Mobile Services SDK (which we don’t need to use for Notification Hubs) and the <strong>WindowsAzureMessaging.framework</strong>.&#160; Copy that framework into your app’s <strong>Frameworks</strong> folder.&#160; After that, open up your <strong>AppDelegate.m</strong>.&#160; We’ll start by adding the following import statement near the top of the file:</p>  <blockquote>   <p>#import &lt;WindowsAzureMessaging/WindowsAzureMessaging.h&gt;</p> </blockquote>  <p>Now, add the following code into the <strong>didFinishLaunchingWithOptions</strong> method:</p>  <p><script src="https://gist.github.com/ChrisRisner/6321731.js?file=ios-didFinishLaunchingWithOptions.m"></script></p>  <p>This will trigger our app to talk to APNS and request a token for push notifications.&#160; Now we’ll add a new method which will handle the call back when APNS responds to our app:</p>  <p><script src="https://gist.github.com/ChrisRisner/6321731.js?file=ios-didRegisterForRemoteNotificationsWithDeviceToken.m"></script></p>  <p>Here you’re going to need to replace <strong>&lt;Connection String&gt;</strong> with the <strong>Listen</strong> signature I mentioned earlier on.&#160; You’ll also need to put your hub’s name into <strong>&lt;Notification Hub Name&gt;</strong>.&#160; This will take the token, which identifies our app and device to APNS, and sends it up to our hub.&#160; Finally we need to put another method into our AppDelegate which will handle displaying the notification if our app is in the foreground when it’s received (if our app is in the background, iOS decides how it’s going to display it):</p>  <p><script src="https://gist.github.com/ChrisRisner/6321731.js?file=ios-didReceiveRemoteNotification.m"></script></p>  <p>Here we’re just going to log whatever information was received and then present it using a <strong>UIAlertView</strong>.&#160; You’ll need to make sure the correct provisioning profile is also selected in your app’s <strong>Build Settings</strong> but refer to the earlier link if you’re not sure how to do that.</p>  <p><strong>Triggering Push Notifications</strong></p>  <p>You’ve got a few different options for actually triggering push notifications down to your applications.&#160; First, there is a <a title="Notification Hubs REST Interface" href="http://msdn.microsoft.com/en-us/library/windowsazure/dn223264.aspx">REST interface</a> exposed by Notification Hubs.&#160; This effectively means that anything capable of doing an HTTP Request could be used to trigger a push.&#160; There is also a <strong><a title="WindowsAzure.ServiceBus NuGet" href="http://nuget.org/packages/WindowsAzure.ServiceBus/">WindowsAzure.ServiceBus NuGet</a> </strong>package which can be used to trigger a push from just about any form of .NET Client (console app, website, etc).&#160; We won’t be looking at either of these two options today but you can research them more if you’d like to see how they work.&#160; Instead, today we’ll be using Mobile Services to trigger our push notifications.&#160; Specifically, we’re going to trigger the push with a scheduled script in our Mobile Service.&#160; If you’re not familiar with Mobile Services or scheduled scripts, take a look at <a title="Scheduler Scripts in Mobile Services" href="http://chrisrisner.com/Announcing-Scheduled-Scripts-with-Windows-Azure-Mobile-Services">this post</a> I put up a while back.&#160; For today, we’ll create a Scheduler script named <strong>testNotificationHub</strong> and we’ll define that script as so:</p>  <p><script src="https://gist.github.com/ChrisRisner/6321731.js?file=testNotificationHub.ja"></script></p>  <p>First we require the <strong>azure </strong>module.&#160; This is what gives us access to <strong>Service Bus </strong>and <strong>Notification Hubs</strong>.&#160; We then use that module to create a <strong>Notification Hub Service</strong> accessor.&#160; Make sure you replace the <strong>&lt;Notification Hub Name&gt;</strong> and&#160; <strong>&lt;Full Signature Connection String&gt; </strong>parameters.&#160; This is when you want to use the second signature from your hub and not the <strong>Listen</strong> one.&#160; We then make two calls:&#160; one to push to GCM and one to push to APNS.&#160; I’m doing that like this here because they both expect different payloads.&#160; If all of our configuration went correctly, we should see a new notification in the Notification Manager in Android and either a toast in iOS (if our app is backgrounded) or a <strong>UIAlertView</strong> if our app is running in the foreground.</p>  <p><strong>Tags and Templates</strong></p>  <p>One thing I’m not covering in any detail today is the ability to register with tags as well as the ability to push using templates.&#160; With tags, you’re able to say “this device / app is interested in tag X”.&#160; Then on your server side, you can, when desired, trigger pushes to any apps that have registered with that tag.&#160; An easy to understand scenario is sport teams.&#160; Let’s say I’m building an application which delivers news about sports teams to it’s users.&#160; Well if I get some news on the Detroit Tigers and want to inform all of the users that care about the Tigers, I could do it with tags.&#160; On the client side, I would just need some way for a user to say “I’m interested in the Tigers” then I would make another call to my hub and say “This app wants Tigers news”.&#160; Then on the server I would just push to the “Tigers” tag.&#160; </p>  <p>Templates allow you to define how a push should be delivered given what platform it’s being sent to.&#160; In the above example, I made a different call for APNS and GCM because they expected different payloads.&#160; With templates, you can say “if I’m delivering to APNS, send this payload in this format but if I’m sending to GCM, deliver it in this format”.&#160; This allows you to make a single call to <strong>hub.send</strong>(…) where you specify some information that then gets put into those templates.&#160; You can read more about using templates <a title="Notification Hub Templates" href="http://www.windowsazure.com/en-us/manage/services/notification-hubs/notify-users-xplat-mobile-services/">here</a>.</p>  <p><strong>Videos</strong></p>  <p>In addition to this post and all of the content on the Windows Azure dev center.&#160; Both myself and Elio Damaggio (one of the Program Managers on Notification Hubs) have recorded videos showing Notification Hubs in action.&#160; My video focuses on connecting iOS to Notification Hubs and using Mobile Services to trigger pushes and can be <a title="Notification Hubs and iOS" href="http://channel9.msdn.com/Series/Windows-Azure-Service-Bus-Tutorials/Notifications-Hubs-with-iOS">watched here</a>.&#160; Elio’s video focuses more on the Windows Store side of using Notification Hubs and can be <a title="Windows Store and Notification Hubs" href="http://channel9.msdn.com/Blogs/Windows-Azure/Windows-Azure-Notification-Hubs">watched here</a>.</p>  <p><strong>Summary</strong></p>  <p>With Notification Hubs, developers have a great way to combine targeted push notifications with push notifications on a massive scale.&#160; Just think of millions of push notifications going out to all the different device platforms without you having to worry about how it works, or making sure it will work.&#160; We’re going to continue to enhance the functionality and capabilities of Notification Hubs and would love your ideas.&#160; If there is a feature of Notification Hubs you’d like to see, please suggest it on the <a title="My great notification hubs idea" href="http://www.mygreatwindowsazureidea.com/forums/218849-notification-hubs">My Great Windows Azure Idea for Notification Hubs</a>.&#160; If you start using Notification Hubs, I’d love to hear about it!</p>