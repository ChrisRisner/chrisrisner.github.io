---
layout: post
title: "31 Days of iOS: Day 11-Saving data using NSUserDefaults"
date: Fri Jan 11 2013 10:52:00 GMT-0800 (PST)
comments: true
status: publish
type: post
published: true
categories: [Mobile, Objective-C, iOS, XCode]
excerpt: "This is day 11 in the 31 Days of iOS.  In this article we start talking about how to save data to the device from your application using NSUserDefaults."
logoUrl: null
keywords: iOS,31 days of iOS,Apple,Apple iOS,NSUserDefaults,saving data,defaults,setValue,synchronize,How to develop iOS,iOS intro,iOS Introduction,iOS Tutorial,iOS for Beginners,Beginners,walkthrough
filepath: 2013-01-11-31-Days-of-iOS--Day-11-Saving-data-using-NSUserDefaults.html
disqus_identifier: 31-Days-of-iOS--Day-11–Saving-data-using-NSUserDefaults
redirect_from:
  - /2013-01-11-31-Days-of-iOS--Day-11%E2%80%93Saving-data-using-NSUserDefaults/
  - /2013-01-11-31-Days-of-iOS--Day-11–Saving-data-using-NSUserDefaults/
---
<p align="left"><img style="margin: 0px 0px 5px 5px; display: inline; float: right" align="right" src="http://chrisrisner.com/upload/200px-Apple-logo.png" width="170" height="208" />Welcome to Day 11 in the <a title="31 Days of iOS" href="http://chrisrisner.com/31-Days-of-iOS">31 Days of iOS</a>.&#160; Today we’re continuing a subset of articles that deal with data storage.&#160; The <a title="Day 10: Singletons and the AppDelegate" href="http://chrisrisner.com/31-Days-of-iOS--Day-10%E2%80%93Singletons-and-the-AppDelegate">last article</a> focused on using the <strong>AppDelegate</strong> or a <strong>singleton</strong> to make data and functionality accessible between different view controllers.&#160; Today we’ll start looking at how to persist data between runs of your application.&#160; This will allow you to save and restore data even if your application stops running or the user restarts their device.&#160; The technique we’ll look at today is using <strong>NSUserDefaults</strong>.&#160; We’ll be starting with a brand new project, but if you’d like to <a title="iOS Day 11 Source Code" href="https://crcomcstorage.blob.core.windows.net/codesamples/iOSDayEleven.zip">follow along with the completed code, you can access it here</a>.</p>  <p><strong>Creating our project and handling the UI</strong></p>  <p>Open up Xcode and choose <strong>File</strong>, <strong>New</strong>, <strong>Project</strong>.&#160; We’ll use a <strong>Single View Application </strong>and name it <strong>DayEleven</strong>:</p>  <p align="center"><img title="Day 11 New Project" alt="Day 11 New Project" src="https://crcomcstorage.blob.core.windows.net/images/31iosday11-new-project.jpg" /></p>  <p>Let’s start by putting some simple controls on our UI for testing.&#160; Open <strong>MainStoryboard.storyboard</strong> and drop two <strong>Round Rect Buttons</strong> and a <strong>Label</strong> on the view.&#160; When you’re done, your app will look like this:</p>  <p align="center"><img title="Day 11 UI" alt="Day 11 UI" src="https://crcomcstorage.blob.core.windows.net/images/31iosday10-ui.jpg" width="253" height="232" /></p>  <p>Once that is done, open the <strong>Assistant Edtior</strong> in the <strong>Utilities </strong>panel on the right side of Xcode.&#160; <strong>Control + Click and drag</strong> from the buttons to your <strong>View Controller</strong> and create actions for them.&#160; Do the same for the label and create an outlet.&#160; When you’re done, your code will look like this:</p>  <p><script src="https://gist.github.com/4015281.js?file=ViewController.h"></script></p>  <p>Now that our UI is done, let’s look at how to use <strong>NSUserDefaults</strong>.&#160; </p>  <p><strong>Writing to and reading form NSUserDefaults</strong></p>  <p><strong>NSUserDefaults</strong> gives you a way to save key value pairs in a way that will persist even when your application closes.&#160; You can think of <strong>NSUserDefaults </strong>as being very similar to a <strong>NSDictionary</strong> but one that has plumbing in place to write and read to storage.&#160; The easiest way to use <strong>NSUserDefaults </strong>is to call the class method <strong>standardUserDefaults</strong> like this:</p>  <blockquote>   <p>NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];</p> </blockquote>  <p>If you read the last article, this should look familiar.&#160; The call to <strong>standardUserDefaults</strong> is essentially returning a singleton instance of <strong>NSUserDefaults</strong>.&#160; Any future calls to <strong>standardUserDefaults</strong> will return the same thing.&#160; Note that you don’t have to use the standard and you can create custom instances using <strong>initWIthUser</strong> or <strong>init</strong>, however, unless you have a specific reason not to, I’d recommend sticking with the default.&#160; Once you have an instance of <strong>NSUserDefaults</strong> you can set and read values just like when using an <strong>NSDictionary</strong>.&#160; So here, we’re saving an <strong>NSString</strong>:</p>  <p><script src="https://gist.github.com/4015281.js?file=SavingData.m"></script></p>  <p>When it comes to loading the data, we again get a reference using <strong>standardUserDefaults</strong> and then use <strong>objectForKey </strong>to pull our data back out:</p>  <p><script src="https://gist.github.com/4015281.js?file=LoadingData.m"></script></p>  <p>If you run your app now and tap the Save and then Load buttons, you’ll see the <strong>My saved data</strong> string is loaded back into the UI.&#160; However, if you kill the app, or the simulator, immediately after saving the data and then rerun your app and tap the <strong>Load Data</strong> button, nothing will show up.&#160; Let’s look at why.</p>  <p><strong>Staying in Sync</strong></p>  <p>When you save and load data using <strong>NSUserDefaults</strong>, it doesn’t write it directly to file storage to prevent having to do file IO each time you access the defaults. This is fine when loading data, but when you save data, you may want to ensure it’s written to the file system right away.&#160; Doing so will ensure that if your app crashes or the phone turns off, or the user leaves your app, the defaults are saved right away.&#160; This is easy to accomplish by calling the <strong>synchronize </strong>method on the defaults:</p>  <p><script src="https://gist.github.com/4015281.js?file=Syncing.m"></script></p>  <p>Now if you kill the app immediately after tapping the <strong>Save Data</strong> button, you’ll be able to tap <strong>Load Data</strong> and see <strong>My saved data</strong> show up in the UI.&#160; You don’t have to call <strong>synchronize </strong>yourself.&#160; <strong>NSUserDefaults</strong> will periodically synch itself if you don’t need to guarantee that the data has been written to storage.</p>  <p><strong>What can you save?</strong></p>  <p>Today we've just seen a simple example of saving a <strong>NSString</strong>.&#160; As you might imagine, you can save many other data types.&#160; In fact, the majority of simple data types can be written to defaults including:</p>  <ul>   <li>NSString </li>    <li>NSNumber </li>    <li>NSDate </li>    <li>NSArray </li>    <li>NSDictionary </li>    <li>NSData </li> </ul>  <p>What’s really great are the last three items listed.&#160; If you’re already keeping data in a <strong>NSArray </strong>or a <strong>NSDictionary</strong> you can put them into defaults without changing anything.&#160; The nice thing about being able to store <strong>NSData</strong> is that you can encode any custom object types you’ve created into <strong>NSData</strong> and then store that into defaults.&#160; </p>  <p><strong>When should you use NSUserDefaults</strong></p>  <p>Depending on the application you are building, you can get very far with <strong>NSUserDefaults</strong>.&#160; In fact, it can be used to save quite a bit of data for a single application.&#160; There are other options such as saving <strong>plist</strong> files and <strong>core data</strong> which you can look at if you need to have data in a format you can query or want it to be relational.&#160; We’ll look at some of these methods but if your data is in types easily put into defaults and you don’t need a more relational database approach, <strong>NSUserDefaults</strong> should work for you.</p>  <p><strong>Conclusion</strong></p>  <p>Today we took our first look at how to persist data between runs of your application.&#160; <strong>NSUserDefaults</strong> allows you to save data very easily and in several different formats.&#160; You can <a title="iOS Day 11 Source Code" href="https://crcomcstorage.blob.core.windows.net/codesamples/iOSDayEleven.zip">look at the finished source code here</a>.</p>