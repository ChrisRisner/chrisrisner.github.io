---
layout: post
title: "31 Days of iOS: Day 19–Showing the User’s Location with Maps"
date: Fri Jan 18 2013 22:25:00 GMT-0800 (PST)
comments: true
status: publish
type: post
published: true
categories: [Mobile, Objective-C, XCode, iOS]
excerpt: "This is day 19 of the 31 Days of iOS.  In this article we'll walk through adding maps into your application.  We'll also talk about showing the user's current location and getting their latitude and longitude."
logoUrl: null
keywords: iOS,31 days of iOS,Apple,Apple iOS,UIMapView,Map view,map,MKMapView,MapKit,ShowUserLocation,current,longitude,latitude,CoreLocation,CLLocation,,How to develop iOS,iOS intro,iOS Introduction,iOS Tutorial,iOS for Beginners,Beginners,walkthrough
filepath: 2013-01-19-31-Days-of-iOS--Day-19–Showing-the-User's-Location-with-Maps.html
disqus_identifier: 31-Days-of-iOS--Day-19–Showing-the-User%27s-Location-with-Maps
---
<p><img style="margin: 0px 0px 5px 5px; display: inline; float: right" align="right" src="http://chrisrisner.com/upload/200px-Apple-logo.png" width="170" height="208" />Welcome to Day 19 of the <a title="31 Days of iOS" href="http://chrisrisner.com/31-Days-of-iOS">31 Days of iOS</a>.&#160; <a title="Day 18: Opening your App from a Website or URL" href="http://chrisrisner.com/31-Days-of-iOS--Day-18%E2%80%93Opening-your-App-from-a-Website">Yesterday</a>, we talked about how to launch your application from a custom URL scheme.&#160; Today we’re going to start talking about how to use maps in your application.&#160; Specifically, we’ll cover how to show a map to the user and then how to display the user’s current location on it.&#160; We’ll continue the discussion around maps tomorrow when we show how to annotate the map.&#160; We’ll be starting with a brand new project, but if you’d like to <a title="iOS Day 19 Source Code" href="http://storage.chrisrisner.com/codesamples/iOSDayNineteen.zip">follow along with the completed code, you can access it here</a>.</p>  <p><strong>Creating our project and handling the UI</strong></p>  <p>Open up Xcode and choose <strong>File</strong>, <strong>New</strong>, <strong>Project</strong>.&#160; We’ll use a <strong>Single View Application </strong>and name it <strong>DayNineteen</strong>:</p>  <p align="center"><img title="Day nineteen new project" alt="Day nineteen new project" src="http://storage.chrisrisner.com/images/31iosday19-new-project.jpg" width="476" height="388" /></p>  <p>Open up the <strong>MainStoryboard.storyboard</strong> and let’s handle our UI.&#160; Find the <strong>Map View</strong> in the element selector in the bottom right of Xcode and drag it on to your view.&#160; We don’t actually want the map to take up the whole screen so we’re going to drag the top down and leave room for two labels above the map.&#160; Once you’ve added the labels, your UI should look like this:</p>  <p align="center"><img title="Day nineteen UI" alt="Day nineteen UI" src="http://storage.chrisrisner.com/images/31iosday19-app-ui.jpg" /></p>  <p>Now open the <strong>Assistant Editor</strong> in the top right of Xcode and <strong>control + click and drag</strong> from each of the labels and the map view over to your code behind.&#160; We want to create outlets for them all.&#160; You may notice that as soon as you create the map view outlet, your code file will show an error.&#160; We’ll solve this in just a minute.&#160; Go ahead and close the <strong>Assistant Editor</strong>.&#160; Before leaving the storyboard, we need to handle one more thing: the map view delegate.&#160; <strong>Control + click and drag </strong>from the map view down to the view controller object beneath it:</p>  <p align="center"><img title="Setting the map view delegate" alt="Setting the map view delegate" src="http://storage.chrisrisner.com/images/31iosday19-setting-mapview-delegate.jpg" width="306" height="348" /></p>  <p>In the popup that appears, select the <strong>delegate</strong> option.&#160; Now let’s handle the header file.</p>  <p><strong>The header file</strong></p>  <p>Open up <strong>ViewController.h</strong>.&#160; If you hover over the red error indicator, you’ll see it’s complaining about <strong>Unknown type name ‘MKMapView’</strong>.&#160; In order to fix this, we first need to open our project file and go to the target’s <strong>Build Phases</strong>.&#160; Expand the <strong>Link Binary With Libraries</strong> section and hit the <strong>+</strong> button.&#160; From this, we want to select the <strong>MapKit.framework</strong>:</p>  <p align="center"><img title="adding the mapkit framework" alt="adding the mapkit framework" src="http://storage.chrisrisner.com/images/31iosday19-mapkit.jpg" /></p>  <p>Select the framework and click <strong>Add</strong>.&#160; Now return to <strong>ViewController.h</strong> and add an import for <strong>MapKit/MapKit.h</strong>.&#160; Now your app should compile and the source code should look like this:</p>  <p><script src="https://gist.github.com/4157744.js?file=ViewController1.h"></script></p>  <p>Now if you run your app, you should see an actual map:</p>  <p align="center"><img title="showing a map" alt="showing a map" src="http://storage.chrisrisner.com/images/31iosday19-map.jpg" width="272" height="405" /></p>  <p><strong>Displaying the current location</strong></p>  <p>Showing the current location of the device is actually incredibly easy.&#160; We can accomplish this with a single line of code.&#160; Open up <strong>ViewController.m </strong>and add the line <strong>self.mapView.showsUserLocation = YES;</strong> into the <strong>viewDidLoad</strong> method<strong> </strong>so it looks like this:</p>  <p><script src="https://gist.github.com/ChrisRisner/4157744.js?file=viewDidLoad.m"></script></p>  <p>Now if you run the application, you should first be asked if you’d like to allow the app to display your current location:</p>  <p align="center"><img title="Permissions for user&#39;s location" alt="Permissions for user&#39;s location" src="http://storage.chrisrisner.com/images/31iosday19-can-use-location.jpg" /></p>  <p align="left">After you hit the <strong>OK </strong>button, you should see a blue sonar like indicator wherever your device is at (if you’re on the simulator, it may default to Apple headquarters in Cupertino or show you your actual current location):</p>  <p align="center"><img title="Showing current user&#39;s location" alt="Showing current user&#39;s location" src="http://storage.chrisrisner.com/images/31iosday19-current-location.jpg" /></p>  <p><strong>Getting the current latitude and longitude</strong></p>  <p>Showing the location on the map was super easy.&#160; Now we’ll finish things up by showing how to get the current longitude and latitude.&#160; This isn’t too tough, but does involve a bit of code.&#160; The first thing we’re going to do is right click on our project and add a new file.&#160; Pick an <strong>Objective-C class</strong>, name it <strong>CoreLocationController</strong>, and make it subclass <strong>NSObject</strong>.&#160; This class is going to contain the logic we’ll nee to interface with <a title="Core Location reference" href="http://developer.apple.com/library/ios/#documentation/CoreLocation/Reference/CoreLocation_Framework/_index.html">Core Location</a> to get the device’s location.&#160; In the <strong>CoreLocationController.h</strong> file, we first need to <strong>import </strong>the <strong>CoreLocation/CoreLocation.h</strong> file.&#160; This will give us a reference to all of the core location classes we need.&#160; Inside this class, we’ll first implement a delegate so that we can get triggered when the location changes.&#160; We’ll then tell our class that it’s going to implement the <strong>CLLocationManagerDelegate</strong>.&#160; Finally, we add a property for <strong>CLLocationManager</strong> and a <strong>delegate</strong> property.&#160; When we’re done, the header file will look like this:</p>  <p><script src="https://gist.github.com/4157744.js?file=CoreLocationController.h"></script></p>  <p>Before we can handle the implementation for our location controller, we need to add another library to our project.&#160; Return to the <strong>Build Phases </strong>tab of our project’s target settings and expand the <strong>Link Binary With Libraries</strong> section.&#160; Click the <strong>+ </strong>button to add a new library and select <strong>CoreLocation.framework</strong>:</p>  <p align="center"><img title="CoreLocation Framework" alt="CoreLocation Framework" src="http://storage.chrisrisner.com/images/31iosday19-core-location-framework.jpg" /></p>  <p>Now switch over to <strong>CoreLocationController.m</strong>.&#160; Here we’ll create an i<strong>nit </strong>method to handle setting up our <strong>locationManager</strong>, as well as methods from the <strong>CLLocationManagerDelegate</strong> to receive updates on the location (which will then be passed to whatever is set to the <strong>CoreLocationController</strong>’s delegate):</p>  <p><script src="https://gist.github.com/4157744.js?file=CoreLocationController.m"></script></p>  <p>Now we can use this class in our view controller.&#160; Open up <strong>ViewController.h</strong> and start by making it import <strong>CoreLocationController.h</strong>.&#160; Then, make the class implement the <strong>CoreLocationControllerDelegate</strong> (so we can send location updates back to the view controller).&#160; Finally, we need to add a property to our class to contain a <strong>CoreLocationController</strong>.&#160; When we’re done, the class will look like this:</p>  <p><script src="https://gist.github.com/4157744.js?file=CoreLocationController2.h"></script></p>  <p>Now we can implement those changes.&#160; Switch over to <strong>ViewController.m</strong>.&#160; First, in the <strong>viewDidLoad</strong> method we need to set up our location controller, set it’s delegate, and get it going it by passing in the <strong>startUpdatingLocation</strong> message:</p>  <p><script src="https://gist.github.com/4157744.js?file=ViewController3.m"></script></p>  <p>Now we can implement the location update and error methods:</p>  <p><script src="https://gist.github.com/4157744.js?file=ViewController4.m"></script></p>  <p>The <strong>update</strong> method takes in a <strong>CLLocation</strong> variable which has a<strong> coordinate</strong> property.&#160; We can use that property to pull out the <strong>latitude </strong>and <strong>longitude </strong>to set the text labels each time there is a location update.&#160; If there is an error, we’re setting the <strong>latitude</strong> label to display the error’s description.&#160; Now when we run our app, we get the current location as well as the latitude and longitude written out on the screen:</p>  <p align="center"><img title="Current latitude and longitude" alt="Current latitude and longitude" src="http://storage.chrisrisner.com/images/31iosday19-current-location-with-lat-long.jpg" /></p>  <p><strong>Conclusion</strong></p>  <p>Today we covered a lot of ground with maps.&#160; We went through how to put a map into your app, how to show the current user’s location, as well as how to get the actual latitude and longitude out of the user’s current location.&#160; That opens up a lot of possibilities for doing geolocation apps (apps like FourSquare or Facebook Check-ins) which are always popular.&#160; Tomorrow we’ll talk about how to display data points on top of the map.&#160; You can <a title="iOS Day 19 Source Code" href="http://storage.chrisrisner.com/codesamples/iOSDayNineteen.zip">download the final source code from today’s app here</a>.</p>