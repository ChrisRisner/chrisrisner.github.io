---
layout: post
title: "31 Days of iOS: Day 7-Making Network Requests"
date: Mon Jan 07 2013 00:50:00 GMT-0800 (PST)
comments: true
status: publish
type: post
published: true
categories: [Mobile, Objective-C, XCode, iOS]
excerpt: "This is day 7 of the 31 Days of iOS.  In this article we start to address how to make network requests from an iOS application to a web server.  Specifically we go over two methods to handle this in iOS: asynchronously and synchronously. "
logoUrl: null
keywords: iOS,31 days of iOS,Apple,Apple iOS,Network request,NSURLConnection,NSUrlRequest,synchronous,asynchronous,How to develop iOS,iOS intro,iOS Introduction,iOS Tutorial,iOS for Beginners,Beginners,walkthrough
filepath: 2013-01-07-31-Days-of-iOS--Day-7-Making-Network-Requests.html
disqus_identifier: 31-Days-of-iOS--Day-7–Making-Network-Requests
redirect_from:
  - /2013-01-07-31-Days-of-iOS--Day-7%E2%80%93Making-Network-Requests/
  - /2013-01-07-31-Days-of-iOS--Day-7–Making-Network-Requests/
---
<p align="left"><img style="margin: 0px 0px 5px 5px; display: inline; float: right" align="right" src="http://chrisrisner.com/upload/200px-Apple-logo.png" width="170" height="208" />Welcome to Day 7 in the <a title="31 Days of iOS" href="http://chrisrisner.com/31-Days-of-iOS">31 Days of iOS</a>.&#160; In <a title="Day 6: The Delegate Pattern" href="http://chrisrisner.com/31-Days-of-iOS--Day-6%E2%80%93The-Delegate-Pattern">yesterday’s article</a>, we discussed the delegation pattern and how it allows you to specify an object to handle the execution of code.&#160; Today we’re going to make use of this pattern to help us make network requests.&#160; We’re actually going to discuss two different methods of making network requests.&#160; The first is a bit more work and requires using delegates.&#160; The second method will allow us to cover a new topic in objective-C development, <strong>blocks</strong>.&#160; We’ll start today with a brand new project, but if you’d like to <a title="iOS Day 7 Source Code" href="https://crcomcstorage.blob.core.windows.net/codesamples/Day7.zip">follow along with the completed code, you can access it here</a>.</p>  <p><strong>Creating a new project</strong></p>  <p>Open up Xcode and go to <strong>File</strong>, <strong>New</strong>, <strong>Project</strong>.&#160; For today we’re just going to choose a <strong>Single View Application</strong>.&#160; I’ll name the project <strong>Day7 </strong>and make this an iPhone only project:</p>  <p align="center"><img src="http://chrisrisner.com/upload/31iosday7-new-project.jpg" width="481" height="390" /></p>  <p>After that, choose where you want to save your project and you’ll have a new app ready to go.</p>  <p><strong>The UI</strong></p>  <p>We don’t need very much for our user interface today since we’re going to be doing most of the work on the backend.&#160; Specifically we’re going to add a text field, two buttons, and a label.&#160; Open up the <strong>MainStoryboard.storyboard </strong>file and edit the UI so it ends up looking like this:</p>  <p align="center"><img title="iOS Day 7 UI" alt="iOS Day 7 UI" src="http://chrisrisner.com/upload/31iosday7-ui.jpg" /></p>  <p>The next thing we need to do is wire up our UI elements to the view controller it’s tied to.&#160; Open the <strong>Assistant Editor</strong> in the utilities pane and <strong>control + click and drag</strong> from each element over to the view controller code behind:</p>  <p align="center"><img title="ios day 7 connecting the UI" alt="ios day 7 connecting the UI" src="http://chrisrisner.com/upload/31iosday7-click-drag.jpg" /></p>  <p>Do this and create outlets for the label and textfield.&#160; Create actions for both buttons.&#160; Before we take a look at the code, we’re going to make one more change.&#160; We need to make the <strong>ViewController </strong>class implement the <strong>NSURLConnectionDelegate</strong>.&#160; This means that our class is capable of handling the delegate callbacks used by a <strong>NSURLConnection</strong>.&#160; Lastly, we need to add a private <strong>NSMutableData </strong>field named <strong>_receivedData</strong>.&#160; When you’re done, your view controller’s header file should look like this:</p>  <p><script src="https://gist.github.com/3915526.js?file=ViewController.h"></script></p>  <p>Now that we’re done connecting the UI, we can switch over to <strong>ViewController.m</strong> and start doing some work.</p>  <p><strong>Coding our first network connection</strong></p>  <p>We’re going to make our first request in the method that we created for the first button press, <strong>btnFetchData1</strong>.&#160; The first thing we need to do is create a <strong>NSURLRequest</strong>.&#160; This object is initialized with the URL we want to connect to.&#160; Additionally we specify a cache policy and a timeout interval.&#160; After that is done we create a <strong>NSURLConnection</strong> with the request as a parameter as well as telling it that it’s delegate, is the <strong>ViewController</strong> instance we’re in (so <strong>self</strong>).&#160; Creating this request also starts it going.&#160; Provided it was created successfully, we will instantiate the <strong>_receivedData</strong> object we added to the header.&#160; </p>  <p><script src="https://gist.github.com/3915526.js?file=ViewControllerStartRequest.m"></script></p>  <p>Now we need to handle the delegate methods associated with <strong>NSURLConnectionDelegate</strong>.&#160; Specifically the methods we need to implement are <strong>connection:didReceiveResponse</strong>, <strong>connection:didReceiveData</strong>, <strong>connection:didFailWithError</strong>, and <strong>connectionDidFinishLoading</strong>.&#160; <strong>didReceiveResponse</strong> is called when a the response first starts to come in.&#160; <strong>didRecieveData</strong> may be called once, or may be called multiple times depending on how much data is returned and how it is split up.&#160; <strong>didFailWithError</strong> is called if there was an issue with the request.&#160; <strong>connectionDidFinishLoading</strong> is called when the response has fully come over.&#160; </p>  <p><script src="https://gist.github.com/3915526.js?file=ViewControllerDelegateMethods.m"></script></p>  <p>In the <strong>didReceiveData </strong>method you’ll see we’re appending whatever data is received to the <strong>_receivedData</strong> variable.&#160; In <strong>connectionDidFinishLoading</strong>, we’re converting the data that came across to a <strong>NSString</strong> and then using that to set the text property of the label in our UI.&#160; We’re also converting any HTML line breaks (<strong>&lt;br /&gt;</strong>) into new lines that a label will understand.&#160; The other two methods should make sense as they are.&#160; Now when we run our app and tap the <strong>Fetch Data 1 </strong>button, we’ll see this:</p>  <p align="center"><img title="iOS App After Fetching Data" alt="iOS App After Fetching Data" src="http://chrisrisner.com/upload/31iosday7-fetch-data-1.jpg" /></p>  <p>That’s great, however, the web page we’ve deployed is capable of pulling out a query string parameter and then displaying that.&#160; Let’s take a look at doing that next.</p>  <p><strong>Adding a query string parameter</strong></p>  <p>We’re going to add a query parameter to our request string by changing the <strong>btnFetchData1</strong> method:</p>  <p><script src="https://gist.github.com/3915526.js?file=ViewControllerFetchData1-2.m"></script></p>  <p>Notice that here we’re creating a new <strong>NSString</strong> with the URL we used before but are then appending whatever text is in our textview as a query string parameter named <strong>name</strong>.&#160; Now when we run our app, we’ll see that the name has been inserted after the <strong>Name:</strong> text:</p>  <p align="center"><img title="fetching data with query string parameter" alt="fetching data with query string parameter" src="http://chrisrisner.com/upload/31iosday7-fetch-data-1-with-name.jpg" /></p>  <p>So now we’ve seen how to do a request and pass in query string parameters.&#160; Let’s now take a look at a less complicated way to do the web request.</p>  <p><strong>Skipping the delegate</strong></p>  <p>Thankfully, we can skip all of the <strong>NSURLConnectionDelegate</strong> methods if we want to.&#160; There is a class method on the <strong>NSURLConnection </strong>class named <strong>sendAsyNchronousRequest</strong> which we can use.&#160; This method requires that we pass in the <strong>NSURLRequest </strong>object, a <strong>NSOperationQueue </strong>(we’ll just use the <strong>mainQueue</strong>), and a completion block.&#160; We haven’t encountered blocks yet but let’s see what how it looks before we discuss them:</p>  <p><script src="https://gist.github.com/3915526.js?file=ViewControllerAsynch.m"></script></p>  <p>The bulk of this method is the same as the <strong>btnDidFetchData1</strong> call we saw before.&#160; However, where before we <strong>init</strong>ed the <strong>NSURLConnection, </strong>now we’re calling the previously mentioned class method.&#160; This method takes in a <strong>completionHandler</strong> or <strong>block</strong>.&#160; This <strong>block</strong> is a method or function of code that will be called when the connection finishes (or gets an error). Notice that the block takes in a <strong>NSURLResponse</strong>, a <strong>NSData </strong>object, and a <strong>NSError</strong>.&#160; If the <strong>NSError</strong> is nil, we can assume we succeeded.&#160; From there, we can proceed as we did earlier in the <strong>connectionDidFinishLoading</strong> method by processing the <strong>data</strong> parameter.&#160; </p>  <p><strong>Conclusion</strong></p>  <p>Today we looked at two different ways to make HTTP requests from an iOS application.&#160; We also looked at how to pass in query string parameters.&#160; The first method which used the <strong>NSURLConnectionDelegate </strong>method required more coding but also gave us a finer grained ability to handle the request.&#160; The latter required less code and is much more readable.&#160; You’ll only be able to use the latter, delegate-free, method if you’re targeting iOS 5 and above (which by now shouldn’t really be an issue).&#160; You can <a title="iOS Day 7 Source Code" href="https://crcomcstorage.blob.core.windows.net/codesamples/Day7.zip">download the final source code from today’s walkthrough here</a>.</p>