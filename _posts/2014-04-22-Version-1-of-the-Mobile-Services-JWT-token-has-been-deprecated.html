---
layout: post
title: "Version 1 of the Mobile Services JWT token has been deprecated"
date: Tue Apr 22 2014 11:39:00 GMT-0700 (PDT)
comments: true
status: publish
type: post
published: true
categories: [Azure, Mobile Services]
excerpt: "This post details the depreciation of Version 1 of the JWT used for Azure Mobile Services.  If you're doing custom auth, this will affect your JWT creation script and will require changing."
logoUrl: null
keywords: Azure Mobile,Mobile Services,auth,custom auth,jwt,token,version,depreciated
filepath: 2014-04-22-Version-1-of-the-Mobile-Services-JWT-token-has-been-deprecated.html
disqus_identifier: Version-1-of-the-Mobile-Services-JWT-token-has-been-deprecated
---
<p><img style="float: right; margin: 0px 0px 5px 5px; display: inline" src="http://storage.chrisrisner.com/images/WAMobileServicesblue.png" align="right" />If you’ve been using Azure Mobile Services lately, you may have noticed a warning appearing in your logs with the following message:</p>  <blockquote>   <p>Version 1 of the Mobile Services JWT token has been deprecated.&#160; Please contact <a href="mailto:mobileservices@microsoft.com">mobileservices@microsoft.com</a> to find out how to update your code.</p> </blockquote>  <p>First, don’t freak out.&#160; There’s a pretty good chance this doesn’t affect you at all.&#160; Due to an unfortunate misstep, this warning has been showing up for some people that aren’t actually affected.&#160; Read on to see if you need to make any changes.</p>  <p><strong>Custom auth</strong></p>  <p>Essentially, you only need to worry about this message if you’re doing custom auth with your Mobile Service.&#160; If you are, you most likely found it in one of these locations:</p>  <ul>   <li><a title="Custom Auth with Mobile Services and LensRocket" href="http://chrisrisner.com/Custom-Authentication-with-Azure-Mobile-Services-and-LensRocket">Custom Auth with Mobile Services and LensRocket</a> </li>    <li><a title="Authentication with Azure Mobile Services" href="http://chrisrisner.com/Authentication-with-Windows-Azure-Mobile-Services">Authentication with Azure Mobile Services</a> </li>    <li><a title="Custom Identity in Mobile Services" href="http://www.thejoyofcode.com/Exploring_custom_identity_in_Mobile_Services_Day_12_.aspx">Custom Identity in Mobile Services</a> (from Josh Twist) </li> </ul>  <p>The reason that you’re affected if you’re doing custom auth is that you’re generating your own JWT tokens.&#160; If you’re using any of the built in auth (Facebook, Google, Microsoft, Twitter) than your Mobile Service generates the JWT for you and your service is already updated.&#160; If you are doing custom auth, read on for the instructions on how to update your code.</p>  <p><strong>Updating the auth code</strong></p>  <p>Thankfully, the changes required to move to version 2 are very simple and they can all be done in the server side scripts.&#160; Here we have the code <strong>previously </strong>used to specify the contents of the JWT (note I’ve left off the code to make this URL friendly, merge it, etc):</p>  <p><script src="https://gist.github.com/ChrisRisner/11187565.js?file=OldJwtCreation.js"></script></p>  <p>We need to make two alterations to this code.&#160; First the <strong>kid</strong> value needs to change from an integer to a string, so “<strong>0”</strong>.&#160; Second, the <strong>ver</strong> value needs to change to <strong>2</strong>.&#160; Our updated code will look like this:</p>  <p><script src="https://gist.github.com/ChrisRisner/11187565.js?file=NewJwtCreation.js"></script></p>  <p>There is one other change you’ll have to make if you’re also doing custom claims.&#160; If you’re specifying a <strong>urn:microsoft:credentials</strong> as part of the <strong>j2</strong> value above, you’ll need to change it to match this shape:</p>  <p><script src="https://gist.github.com/ChrisRisner/11187565.js?file=NewClaim.js"></script></p>  <p><strong>Summary</strong></p>  <p>Version 1 tokens will continue to work for some time though you’ll see that warning pop up in your logs if you continue to issue V1 tokens.&#160; Thankfully the changes are small.&#160; As always, I would advise making your changes against a test service prior to making the changes against a service backing a production app.&#160; You can read more about the changes on the <a title="Azure Mobile Services blog" href="http://blogs.msdn.com/b/azuremobile/archive/2014/03/19/changes-in-the-azure-mobile-services-jwt-token.aspx">Azure Mobile Services blog</a>.</p>