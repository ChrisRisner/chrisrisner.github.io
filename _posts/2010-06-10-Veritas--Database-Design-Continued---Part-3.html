---
layout: post
title: "Veritas: Database Design Continued - Part 3"
date: Wed Jun 09 2010 21:00:00
commentsOn: true
status: publish
type: post
published: true
categories: [.Net, SQL, Veritas, Web]
excerpt: "Vertias,Blog,Blog Engine,MVC,ASP,ASP .Net 4, .Net 4, Blog Series, How to, Make Blog,Database,SQL,Database Design,DBA"
logoUrl: null
keywords: Vertias,Blog,Blog Engine,MVC,ASP,ASP .Net 4, .Net 4, Blog Series, How to, Make Blog,Database,SQL,Database Design,DBA
filepath: 2010-06-10-Veritas--Database-Design-Continued---Part-3.html
disqus_identifier: Veritas--Database-Design-Continued---Part-3
redirect_from:
  - /Veritas--Database-Design-Continued---Part-3/
---
<p>In the <a title="Veritas Database Design Part 1" href="http://chrisrisner.com/Veritas--Database-Design-%E2%80%93-Part-2">last entry in this series</a>, we went over the “non-blog” tables in our database.&#160; Now it’s time to cover the tables that store data specific to posts or entries.&#160; We’re going to dive right into it and take a look at the most important table, BlogEntry:     <br /><a onclick="return hs.expand(this)" class="highslide" href="http://chrisrisner.com/upload/BlogEntry2.jpg"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="BlogEntry" border="0" alt="BlogEntry" src="http://chrisrisner.com/upload/BlogEntry2.jpg" width="244" height="201" /></a> </p>  <p>This table will contain the details specific to an entry.&#160; So Text will be the html or the text for the post.&#160; Keywords will fill the meta keywords for the entry.&#160; Short will be used if we only want to display a shortened version of the html (in order to get more click throughs on RSS feeds for example).&#160; Our entry name will match our title with the exception that it will be HTML encoded (mostly).&#160; Lastly, the BlogAuthorId has a Foreign Key (FK) constraint to the BlogUser table (as mentioned in the previous post).&#160; In addition, BlogConfigId is a FK back to the BlogConfig table as per usual.&#160; Finally, PostType is a value we might use down the road to distinguish between live posts, drafts, or anything else we might store in the table.&#160; Moving along, we’ll look at the BlogViewEntryCount table:</p>  <p><a onclick="return hs.expand(this)" class="highslide" href="http://chrisrisner.com/upload/blogentryviewcount.jpg"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="BlogEntryViewCount" border="0" alt="BlogEntryViewCount" src="http://chrisrisner.com/upload/blogentryviewcount.jpg" width="244" height="104" /></a> </p>  <p></p>  <p>For now the only real point of this table is the WebCount column.&#160; This table just keeps track of the number of times this entry has been loaded via the web.&#160; Down the road, we might add additional columns to see how many times the entry was loaded from an RSS feed or linked from Facebook, or anything else we might want to track.&#160; Each entry will (hopefully) get some comments or feedback but before we can store the feedback, we need a table to store the author of each comment.&#160; Since we’ll likely have repeat commentators we don’t want to have to store their info for every comment, so we’ll have a BlogFeedbackAuthor table:</p>  <p><a onclick="return hs.expand(this)" class="highslide" href="http://chrisrisner.com/upload/BlogFeedbackAuthor.jpg"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Blog Feedback Author" border="0" alt="Blog Feedback Author" src="http://chrisrisner.com/upload/BlogFeedbackAuthor.jpg" width="244" height="134" /></a> </p>  <p>This table will store the name, email, URL fields that we’ll ask for in every comment.&#160; Then we’ll store a total number of feedbacks for the people that enter the same info repeatedly.&#160; Simple enough.&#160; Now we’ll go to the BlogFeedback table:</p>  <p><a onclick="return hs.expand(this)" class="highslide" href="http://chrisrisner.com/upload/BlogFeedback2.jpg"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Blog Feedback" border="0" alt="Blog Feedback" src="http://chrisrisner.com/upload/BlogFeedback2.jpg" width="244" height="233" /></a> </p>  <p>First we have FKs to the BlogEntry table and the BlogFeedbackAuthor table.&#160; From there we are storing details on the actual feedback such as the body, the IP address of the user that entered it, the status it’s in (we’ll tie this to an enum in the code), the title of the feedback, and the user agent of the user.&#160; The NotifyAuthorOnFeedback column will be used to figure out if we should email the feedback author when someone comments after them on the same entry.&#160; Lastly we have Feedback Type which we might use down the road to distinguish between types of feedback.&#160;&#160; Only 4 tables left (for now) so let’s go to the BlogCategory:</p>  <p><a onclick="return hs.expand(this)" class="highslide" href="http://chrisrisner.com/upload/BlogCategory.jpg"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Blog Category" border="0" alt="Blog Category" src="http://chrisrisner.com/upload/BlogCategory.jpg" width="244" height="118" /></a> </p>  <p>Nothing really special here.&#160; The important things are the Title and the IsActive field.&#160; Now we have our BlogEntryCategory table to tie entries to categories:</p>  <p><a onclick="return hs.expand(this)" class="highslide" href="http://chrisrisner.com/upload/BlogEntryCategory.jpg"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Blog Entry Category" border="0" alt="Blog Entry Category" src="http://chrisrisner.com/upload/BlogEntryCategory.jpg" width="244" height="75" /></a> </p>  <p>This table is straight FKs.&#160; Now we’ll get to BlogPage:</p>  <p><a onclick="return hs.expand(this)" class="highslide" href="http://chrisrisner.com/upload/BlogPage.jpg"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Blog Page" border="0" alt="Blog Page" src="http://chrisrisner.com/upload/BlogPage.jpg" width="244" height="173" /></a> </p>  <p>This table will be used to store pages we might want to host on our site with any sort of static comment.&#160; In the PageContent column we can put any html or javascript we want.&#160; Late we’ll make a way to render this so the user can add any static pages they want without having to get into code or anything like that.&#160; We’re also allowing the user to enter the Meta Keywords and Description.&#160; Finally we’ve got the Page Title (what we’ll actually put in the Title tag) and the Encoded Title (what we’ll use for the URL).&#160; Our last table (for now) will be the Blacklist table: </p>  <p><a onclick="return hs.expand(this)" class="highslide" href="http://chrisrisner.com/upload/BlackList.jpg"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Blacklist" border="0" alt="Blacklist" src="http://chrisrisner.com/upload/BlackList.jpg" width="244" height="80" /></a> </p>  <p>This table will just be used to store the addresses of anyone that wants to opt out of emails.&#160; So if someone comments with a bad address and says they want to be emailed when someone comments after them, the original person has the ability to say “I don’t want these emails!”.&#160; So we’re done (again for now) with our Database Schema.&#160; WOOT!&#160;&#160; Coming up we’ll go over the base project structure.&#160; So that you don’t have to go and create all of these tables yourself, you can download a <a title="Create Veritas Blog DB Script" href="http://chrisrisner.com/upload/CreateVeritasBlogDBScript.zip">SQL script to create all of these tables here (the SQL file is in a ZIP)</a>.
<br /> <br />
<strong>Update 6-27-2010:<br /> BlogCategory's IsActive field should have been a bit field but was incorrectly shown as a nvarchar.</strong></p>