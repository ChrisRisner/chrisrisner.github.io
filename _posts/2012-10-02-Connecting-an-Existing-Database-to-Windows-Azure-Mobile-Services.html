---
layout: post
title: "Connecting an Existing Database to Windows Azure Mobile Services"
date: Tue Oct 02 2012 08:43:00 GMT-0700 (PDT)
comments: true
status: publish
type: post
published: true
categories: [SQL, Azure, Mobile Services]
excerpt: "This article describes how to take a SQL database hosted locally and move it up to Windows Azure SQL Database as well as how to make it ready for, and connected to, Windows Azure Mobile Services.  Links are also provided to the original answer on MSDN and the data types supported by Mobile Services."
logoUrl: null
keywords: Windows Azure Mobile Services,Windows Azure,Mobile Services,SQL Database,Windows Azure SQL Database,Connecting Mobile Services to existing SQL Database,Existing,Walkthrough
filepath: 2012-10-02-Connecting-an-Existing-Database-to-Windows-Azure-Mobile-Services.html
disqus_identifier: Connecting-an-Existing-Database-to-Windows-Azure-Mobile-Services
---
<p><img style="margin: 0px 0px 5px 5px; display: inline; float: right" align="right" src="http://chrisrisner.com/upload/mobile-service-logo-3.png" />With all the excitement over Windows Azure Mobile Services, one of the questions we get frequently is how to connect Mobile Services to an existing database.&#160; It turns out that this isn’t very hard to do but may require some changes to your database.&#160; Today I’ll walk you through taking a database hosted locally in SQL Server, pushing into Windows Azure SQL Database, and connecting it using a Mobile Service.&#160; If you’d like the quick explanation with out all the pretty pictures and moving from a local DB to Windows Azure, you can <a title="Paul Batum explains how to connect your database to Windows Azure Mobile Services" href="http://social.msdn.microsoft.com/Forums/en-US/azuremobile/thread/60764eb6-17d0-4395-a887-2a793b44ce88">check out Paul Batum’s answer on the MSDN forums</a> (I didn’t find this until after I had figured out all of the below).</p>  <p>In order to use Mobile Services, you’ll need a Windows Azure account.&#160; You can <a title="Free Windows Azure Trial" href="http://aka.ms/o5a2rk">sign up for a free trial here</a>.&#160; While in preview, Mobile Services stay free even when the 3 month trial of the other features of Windows Azure expires.</p>  <p><strong>Changing our Local Database</strong></p>  <p>Let’s start by loading our local database and looking at the changes necessary.&#160; You can follow along by creating our sample database on your own server.&#160; You can <a title="Create Fake Blog DB Script" href="http://chrisrisner.com/upload/createfakeblogdb.sql">use this script</a> to do so.&#160; This database is meant to store the data for a blog website.&#160; Specifically, it has a table to store Users and a table to store entries.&#160; It’s a very simple database but it will suffice for what we want to do.&#160; </p>  <p align="center"><img title="Fake Blog DB" alt="Fake Blog DB" src="http://chrisrisner.com/upload/fake-blog-db.jpg" /></p>  <p>Notice that the tables begin with “dbo”.&#160; This is the schema of our database.&#160; When a table is created in Mobile Services, it sets the schema to be the name of the mobile service.&#160; Later in this walkthrough, we’ll create a mobile service named “fakeblog” so we’ll create a new schema here to match that.&#160; We can accomplish this in two ways: through the <a title="Creating a new Schema in SQL Management Studio" href="http://msdn.microsoft.com/en-us/library/dd207005.aspx">UI of SQL management Studio</a>, or executing a query.&#160; I’ve linked to instructions for creating the schema through the UI.&#160; Once that is done you’ll need to go into design mode on each table and change it’s <strong>Schema</strong> property.&#160; Alternatively, you can execute this SQL script:</p>  <p><script src="https://gist.github.com/3815715.js?file=updateschema.sql"></script></p>  <p>One thing to point out is that you’ll need to have <strong>CREATE SCHEMA</strong> permissions for this to work.&#160; With that done, there is one more change we need to make to both tables.&#160; If you look at the tables, you’ll see that both of them have a column named “id”.&#160; </p>  <p align="center"><img title="fake blog db tables" alt="fake blog db tables" src="http://chrisrisner.com/upload/fake-blog-db-tables.jpg" /></p>  <p>This is great because Mobile Services REQUIRES that each table have a column named “id”.&#160; However, we also need this column to be a<strong> Primary Key</strong> column (in addition to it being a non-null <strong>Identity</strong>) field.&#160; We can solve this with a quick script:</p>  <p><script src="https://gist.github.com/3815715.js?file=update_primary_keys.sql"></script></p>  <p>Now our DB is ready to be ported to Windows Azure SQL Database.</p>  <p>&#160;<strong>Moving the database to the cloud</strong></p>  <p>Thankfully, SQL Server Management Studio 2012 has a wizard to easily make this happen.&#160; In SQL Server Management Studio, right click on your database and <strong>Tasks</strong> and select <strong>Deploy Database to SQL Azure</strong>.&#160; The first screen that will appear (if this is the first time you’ve used it) will be informational and will explain what you’re doing.&#160; The next screen will look like this:</p>  <p align="center"><img title="Moving DB to SQL Database" alt="Moving DB to SQL Database" src="http://chrisrisner.com/upload/sql-management-move-to-azure.jpg" /></p>  <p>Clicking the “Connect” button will launch the usual connection wizard you see when first launching SQL Server Management Studio.&#160; For this to work, you’ll need to have already created a database in the <a title="Windows Azure Portal" href="http://manage.windowsazure.com">Windows Azure portal</a> as well as granting firewall access.&#160; Once in the portal, select your database and click the “Manage” button at the bottom:</p>  <p align="center"><img title="Manage SQL Database" alt="Manage SQL Database" src="http://chrisrisner.com/upload/sql-database-manage.jpg" /></p>  <p>When you do that, the first thing that happens is the server checks your IP address to see if it’s on the list of IPs that are allowed.&#160; You’ll see two popups show up at the bottom of the screen to add your current IP, go ahead and click yes on each.</p>  <p align="center"><img title="Alter Firewall Rules" alt="Alter Firewall Rules" src="http://chrisrisner.com/upload/sql-database-manage-ip-firewall.jpg" width="796" height="125" /></p>  <p>Once you’ve done that, you’ll be able to connect to your SQL Database server from your local SQL Server Management Studio client.&#160; Go back to the <strong>Deploy Database to SQL Azure </strong>wizard and connect to the server (you can click a link to view the credentials in the same screen in the portal).&#160; When you tap through, you should see the operation start and after a few seconds it should complete.</p>  <p align="center"><img title="SQL Database Operation Complete" alt="SQL Database Operation Complete" src="http://chrisrisner.com/upload/sql-database-operation-complete.jpg" width="475" height="448" /></p>  <p><strong>Connecting your mobile service</strong></p>  <p>Now let’s return to the <a title="Windows Azure Portal" href="http://manage.windowsazure.com">Windows Azure portal</a> and set up our new mobile service.&#160; Once you’re in, go to <strong>+ New</strong> at the bottom and select <strong>Compute –&gt; Mobile Service –&gt; Create</strong>.&#160; Make sure you enter a name that matches the schema you created for your database tables earlier (in our case <strong>fakeblog</strong>):</p>  <p align="center"><img title="new fake blog mobile service" alt="new fake blog mobile service" src="http://chrisrisner.com/upload/new-mobile-service-fake-blog.jpg" width="412" height="253" /></p>  <p>At the next screen in the wizard, select the database you uploaded and enter the credentials for it (these will be the creds for the database server):</p>  <p align="center"><img title="Database Credentials" alt="Database Credentials" src="http://chrisrisner.com/upload/new-mobile-service-database-creds.jpg" /></p>  <p>Now, go into your mobile service and select the <strong>Data</strong> tab at the top.&#160; When you do so, you’ll see that you don’t have any tables.&#160; This happens because we need to “tell” mobile services about the tables we already have.&#160; Go to the <strong>+ Create</strong> button at the bottom when on the <strong>Data</strong> tab and enter the names of your tables (<strong>Users</strong> and <strong>Entries</strong> for our fakeblog db).&#160; After you create the tables, they will initially show up in your table list and it will show 0 records:</p>  <p align="center"><img title="fake blog new tables" alt="fake blog new tables" src="http://chrisrisner.com/upload/fake-blog-new-tables.jpg" /></p>  <p>However, if you click into a table you’ll see the records that were previously inserted (by the create script) into your database:</p>  <p align="center"><img title="new table with records" alt="new table with records" src="http://chrisrisner.com/upload/new-blog-table-records.jpg" /></p>  <p>Now you can access your database from anything connected to mobile services.</p>  <p><strong>Conclusion</strong></p>  <p>Today we saw that it isn’t that difficult to put an existing database into a Mobile Service.&#160; This can also be done if you already had a database in SQL Database as well as long as you keep in mind the changes necessary for a table to work with Mobile Services (the <strong>id</strong> column and the schema).&#160; Additionally, not every data type is supported in Mobile Services at this time.&#160; For example as we saw when <a title="Uploading images into Mobile Services" href="http://chrisrisner.com/Storing-Images-from-Android-in-Windows-Azure-Mobile-Services">uploading images into Mobile Services</a>, binary data types don’t currently work.&#160; For more information on the supported data types, take a look at the <strong>CUD</strong> <a title="Dinesh talks about the supported data types" href="http://dineshthoughtstream.blogspot.com/2012/10/using-mobile-services-in-windows-8.html">section of this article on Dinesh’s website</a>.</p>