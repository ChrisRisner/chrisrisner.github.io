_id: 0faa8097-d1a4-4798-aac7-c2d560af40b7
_parent: /Custom-Authentication-with-Azure-Mobile-Services-and-LensRocket
message: "<p>hi! now i'm working on other things</p><p>but i had my custom jwt in c# with that code, hope helpful for you...</p><p>string privateKey = yourAzureMasterkey;</p><p>var issueTime = DateTime.Now;</p><p>var utc0 = new DateTime(1970, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc);</p><p>var exp = (int)issueTime.AddMinutes(60).Subtract(utc0).TotalSeconds;</p><p>var payload = new</p><p>{</p><p> exp = exp,</p><p> iss = \"urn:microsoft:windows-azure:zumo\",</p><p> ver = 1,</p><p> aud = \"urn:microsoft:windows-azure:zumo\",</p><p> uid = \"custom:123456\"</p><p>};</p><p>using System;</p><p>using System.Collections.Generic;</p><p>using System.IdentityModel.Tokens;</p><p>using System.Linq;</p><p>using System.Security.Cryptography;</p><p>using System.ServiceModel.Security.Tokens;</p><p>using System.Text;</p><p>using System.Threading.Tasks;</p><p>namespace ConsoleApplicationNotifiche</p><p>{</p><p>    class MyJwtGiorgio</p><p>    {</p><p>        public static string getToken(string privateKey, string uid)</p><p>        {</p><p>            var jwtSecurityTokenHandler = new System.IdentityModel.Tokens.JwtSecurityTokenHandler();</p><p>            byte[] signingKey = GetSigningKey(privateKey);</p><p>            BinarySecretSecurityToken binarySecretSecurityToken = new BinarySecretSecurityToken(signingKey);</p><p>            var signingCredentials = new SigningCredentials(</p><p>                new InMemorySymmetricSecurityKey(binarySecretSecurityToken.GetKeyBytes()),</p><p>                \"<a href=\"http://www.w3.org/2001/04/xmldsig-more#hmac-sha256\" rel=\"nofollow noopener\" title=\"http://www.w3.org/2001/04/xmldsig-more#hmac-sha256\">http://www.w3.org/2001/04/x...</a>\",</p><p>                \"<a href=\"http://www.w3.org/2001/04/xmlenc#sha256\" rel=\"nofollow noopener\" title=\"http://www.w3.org/2001/04/xmlenc#sha256\">http://www.w3.org/2001/04/x...</a>\");</p><p>            var claim_list = new List&lt;system.security.claims.claim&gt;();</p><p>            claim_list.Add(new System.Security.Claims.Claim(\"uid\", uid));</p><p>            var jwttoken = jwtSecurityTokenHandler.WriteToken(new System.IdentityModel.Tokens.JwtSecurityToken(</p><p>                \"urn:microsoft:windows-azure:zumo\",</p><p>                \"urn:microsoft:windows-azure:zumo\",</p><p>                claim_list,</p><p>                new System.IdentityModel.Protocols.WSTrust.Lifetime(DateTime.Now, DateTime.Now.AddYears(1)),</p><p>                signingCredentials)</p><p>            );</p><p>            return jwttoken.ToString();</p><p>        }</p><p>        private static  byte[] GetSigningKey(string secretKey)</p><p>        {</p><p>            if (string.IsNullOrEmpty(secretKey))</p><p>            {</p><p>                throw new ArgumentNullException(\"secretKey\");</p><p>            }</p><p>            UTF8Encoding uTF8Encoding = new UTF8Encoding(true, true);</p><p>            byte[] bytes = uTF8Encoding.GetBytes(secretKey + \"JWTSig\");</p><p>            byte[] result = null;</p><p>            using (SHA256Managed sHA256Managed = new SHA256Managed())</p><p>            {</p><p>                result = sHA256Managed.ComputeHash(bytes);</p><p>            }</p><p>            return result;</p><p>        }</p><p>    }</p><p>}</p>"
name: Giacomo
email: B6AA223C2002D1A3B0363A96800451E6
url: ''
replying_to: '1'
hidden: ''
date: '2014-06-13T15:31:01Z'